//-------------------------------------------------------------------------------------------------
//
//  Web Document Viewer object cross browser client-side script. 
//  Copyright 2003-2016 Atalasoft, Inc. All Rights Reserved.
//
//  This source code is property of Atalasoft, Inc. (http://www.atalasoft.com/)
//  Permission for usage and modification of this code is only permitted 
//  with the purchase of a source code license.
//-------------------------------------------------------------------------------------------------

!function(){function t(t){for(var e=0,o=(""+t).replace("_",".").replace(/[^0-9.]/g,"").split("."),n=0;n<o.length;++n)e+=Number(o[n])/Math.pow(10,3*n);return e}var e="1.7.1";if("undefined"==typeof jQuery)throw"jQuery not found. The WebDocumentViewer requires jQuery version "+e+" or later.";if(t(jQuery().jquery)<t(e))throw"Early jQuery version found: "+jQuery().jquery+", version expected: "+e;jQuery.isFunction(jQuery.fn.parseVersionFloat)||(jQuery.parseVersionFloat=t,jQuery.fn.parseVersionFloat=t)}();/**
* Main Atalasoft Namespace definition(s)
*/
var Atalasoft=jQuery.extend(!0,{},Atalasoft,{$:jQuery,Annotations:{},Controls:{},Document:{},Forms:{},Text:{},Utils:{}});!function(){var t={instanceCounter:0};/**
* Control that views, modifies, and saves documents, annotations and forms.
* @param settings Object of key value pairs representing initial settings
* @returns A new control with the given settings.
*/
Atalasoft.Controls.WebDocumentViewer=function(e,o){function n(){Atalasoft.Utils._scriptLoader=Atalasoft.Utils.__loadDependencies(An.scripturl,An.allowannotations,_);var t={_config:An,_id:un,_dom:mn,_document:mn.loadedImgs,_pages:mn.pageDivs,_state:zn,_internalEvents:_n,_controllers:vn,createDOM:v,createDiv:w,createDialog:P,createDropDownButton:A,createDropDownMenu:V,createMenu:T,drawAnnotation:_o,redrawVisiblePages:ko,adjustVisiblePages:so,startDomManipulation:Ke,endDomManipulation:Je,redrawPageFromIndex:Bo,makeHandlerRequest:Io,getPageScale:ho,getPageSize:ne,getSourcePageSize:oe,getPageRotation:go,getViewerTransform:po,isPageInView:Ne,findPageFromIndex:We,showPagePoint:Qe};vn.document=new Atalasoft.Document.ManipulationController(sn,t),An.allowannotations?vn.annotations=new Atalasoft.Annotations.AnnotationController(sn,t,cn):(sn.deselectAll=wo,sn.createAnnotationOnPage=wo,sn.getAnnotationsFromPage=wo,sn.deleteAnnotationOnPageAtIndex=wo,sn.setAnnotationDefaults=wo,sn.setImages=wo,sn.setStamps=wo),An.allowforms&&(vn.forms=new Atalasoft.Forms.FormController(sn,t)),An.allowtext&&!Atalasoft.Utils.Browser.Explorer8&&(vn.text=new Atalasoft.Text.TextController(sn,t,An.mousetool?An.mousetool.text:{}));var e="undefined"==typeof rn.easing||"undefined"==typeof rn.ui||An.allowannotations&&"undefined"==typeof Raphael;e?Atalasoft.Utils._scriptLoader&&Atalasoft.Utils._scriptLoader.bind({scriptsloaded:a}):a()}function a(){zn.initialized===!1&&(zn.initialized=!0,on({throwerror:m,pagedivsresized:c,documentchanged:To,pagesizechanged:u}),An.parent?(An.parent instanceof jQuery||(An.parent=rn(An.parent)),An.parent.length||_("InitError","Parent element not found.")):_("InitError","No parent element given."),mn.toolbar=x(An.toolbarparent||An.parent),mn.toolbar.addClass(Dn.atala_toolbar),mn.main=w(An.parent),mn.main.addClass(Dn.atala_main_container),mn.scroller=w(mn.main),mn.scroller.addClass(Dn.atala_scroller),mn.main.bind({selectstart:g}),mn.toolbar.attr("id",un+"_toolbar"),mn.main.attr("id",un+"_main"),mn.scroller.attr("id",un+"_scroller"),mn.main.css({height:"100%",width:"100%",position:"relative"}),mn.scroller.css({height:"100%",width:"100%",position:"relative"}),mn.viewport=w(mn.scroller,un+"_vp"),mn.viewport.css({overflow:"hidden"}),mn.viewport.addClass(Dn.atala_viewport),mn.viewport.attr("tabindex",-1),mn.edges[0]=L(mn.viewport,un+"_e0"),mn.content=w(mn.viewport,un+"_ct"),mn.content.css({"-ms-touch-action":"none"}),mn.content.addClass(Dn.atala_content),An.direction===bn.Horizontal&&mn.content.css({display:"inline-block"}),mn.edges[1]=L(mn.viewport,un+"_e1"),Atalasoft.Utils.Browser.Features.Compatibility&&_("InitError","Compatibility Mode is not supported."),Atalasoft.Utils.Browser.Mobile.Any()?mn.scroller.css({overflow:"hidden"}):An.showscrollbars?(mn.scroller.css({overflow:"auto"}),mn.scrollH=F(mn.main,bn.Horizontal),mn.scrollH.attr("id",un+"_sH"),mn.scrollH.addClass(Dn.atala_scroll_horizontal),mn.scrollV=F(mn.main,bn.Vertical),mn.scrollV.attr("id",un+"_sV"),mn.scrollV.addClass(Dn.atala_scroll_vertical)):mn.scroller.css({overflow:"hidden"}),vn.mouseTool=new Atalasoft.Controls.ToolController(sn,{_internalEvents:_n,_controllers:vn,zoomStart:Ye,zoom:to,zoomEnd:eo,getActivePage:Pe,raiseDrawLayer:bo,resetDrawLayer:xo,getViewerTransform:po},mn.viewport,mn.scroller,rn.extend({allowflick:An.allowflick},An.mousetool)),vn.memory=new Atalasoft.Document.MemoryTracker({highWaterMark:An.memorythreshold}),vn.memory.bind({exceededhighwatermark:s}),vn.annotations&&vn.annotations.setViewPort(mn.viewport),an("initialized"),l(),rn(document).ready(h))}function i(){var e=An.parent.attr("id")+"_wdv";for(++t.instanceCounter;document.getElementById(e+t.instanceCounter);)++t.instanceCounter;un=e+t.instanceCounter}function l(){Atalasoft.Utils.Browser.Explorer&&parseInt(Atalasoft.Utils.Browser.Version,10)<8?mn.viewport.css({"float":"left"}):(An.direction===bn.Horizontal&&mn.viewport.css({"white-space":"nowrap"}),mn.viewport.css({display:"table-cell"})),O(mn.scroller),mn.scrollH&&mn.edges[1].height(mn.scrollH.scrollbarHeight()),vn.mouseTool.setTool(xn.Pan,xn.None),(An.documenturl||An.annotationsurl||An.formurl)&&Jo(An.documenturl,An.annotationsurl,An.formurl,o)}/**
	* Removes all DOM elements, internal references, and empties memory intensive objects.
	* The WebDocumentViewer will no longer function after a call to this method.
	*/
function r(){if(Be(),Le(),mn.main&&mn.main.remove(),mn.toolbar&&(mn.toolbar.remove(),mn.toolbar.annoToolbar&&mn.toolbar.annoToolbar.remove()),mn.search&&mn.search.dispose(),mn.main=null,mn.toolbar=null,mn.scroller=null,mn.viewport=null,mn.content=null,mn.scrollH=null,mn.scrollV=null,mn.loadedImgs.length=0,mn.pageDivs.length=0,mn.pageLabel=null,mn.status=null,mn.search=null,mn.edges){for(var t=0;t<mn.edges.length;t++)mn.edges[t]=null;mn.edges=[]}for(var e in vn)vn.hasOwnProperty(e)&&null!==vn[e]&&(vn[e].dispose(),vn[e]=null);sn=null,yn=null,zn=null}function s(){var t=vn.memory.deallocateOldestEntry();q(t[0]),mn.loadedImgs[t._index]=null,t.remove(),t.length=0,t=null}function c(t){zn.newpagedivsize={height:t.height,width:t.width},zn.newpagedivfullzoom=t.fullzoom,An.minwidth=t.minwidth,An.zoom=t.fullzoom,To()}function u(t){var e=!1;(yn.smallest.width<=0||t.width<yn.smallest.width)&&(yn.smallest.width=t.width,e=!0),(yn.smallest.height<=0||t.height<yn.smallest.height)&&(yn.smallest.height=t.height,e=!0),cn||(we(t.dx,t.dy),e&&R(W())>mn.pageDivs.length&&To(t))}function d(t){var e=vn.document.getPageSize(t.index,un);if(!e){var o=uo(t.index),n=o,a={width:t.width,height:t.height};1===n&&An.forcepagefit&&(a.width!==yn.size.width||a.height!==yn.size.height)&&a.width>0&&a.height>0&&(n=a.width/yn.size.width>a.height/yn.size.height?yn.size.width/a.width:yn.size.height/a.height,vn.document.setPageFitMultiplier(t.index,n,un)),vn.document.setPageSize(t.index,rn.extend({},a),un),a.width*=An.zoom*n,a.height*=An.zoom*n,e=rn.extend({},yn.size),e.width*=An.zoom*o,e.height*=An.zoom*o,t.dx=a.width-e.width,t.dy=a.height-e.height,u(t)}}function h(){rn(window).on({resize:Xe,beforeunload:r}),mn.scroller.scroll(xe),U(yn.buffer)}function g(t){var e=t.target||t.srcElement;return Atalasoft.Utils.Browser.Explorer8?Atalasoft.Utils.__rf():"TEXTAREA"!==e.nodeName&&"INPUT"!==e.nodeName&&"text"!==e.type?Atalasoft.Utils.__rf():e.attributes.selectable&&"false"===e.attributes.selectable.value?Atalasoft.Utils.__rf():void 0}function p(t){return function(e){e.preventDefault(),an(t,arguments)}}function f(t,e){return function(o){try{o.currentTarget=e&&e.length>0?e[0]:o.currentTarget,t&&t(o)}catch(n){ue(n.message)}}}function _(t,e){if(An.showerrors)throw"undefined"==typeof e?t:t+": "+e;ue(t+": "+e),an({type:"error",name:t,message:e})}function m(t){_(t.name,t.msg)}function v(t,e,o,n){var a=rn("<"+t+"></"+t+">");return e&&e.append&&a.appendTo(e),o&&a.attr("id",o),n&&a.html(n),a}function w(t,e,o){return v("div",t,e,o)}function b(t){var e=rn('<div style="width:100%; height:100%; position:absolute; left: 0px; top: 0px; background: #F00; opacity:0.0;"></div>');if(Atalasoft.Utils.Browser.Explorer)if(parseInt(Atalasoft.Utils.Browser.Version,10)<=8)e.css({filter:"alpha(opacity=0)"});else if(10===parseInt(Atalasoft.Utils.Browser.Version,10)){var o=!1;e.reflow=function(){if(o)e.empty();else{var t=rn("<hr/>");e.append(t)}o=!o}}return e.toFront=function(){e.css({"z-index":"10"}),e.reflow&&e.reflow()},e.reset=function(){e.css({"z-index":""}),e.reflow&&e.reflow()},t&&t.prepend(e),e}function x(t){var e=y(t);return An.allowannotations&&(e.annoToolbar=z(t),e.annoToolbar.addClass(Dn.atala_annotation_toolbar)),An.showstatus&&(mn.status=rn('<div id="'+un+'_status" style="display:inline"></div>'),mn.status.addClass(Dn.atala_statusbar),e.append("Status:"),e.append(mn.status)),An.allowtext&&An.mousetool.text.allowsearch&&(mn.search=new E({parent:e})),e}function y(t){var e={id:un+"_toolbar",parent:t,children:[{type:"button",id:"Button_PagePrev",cls:Dn.atala_tool_button_page_prev,icon:"page-prev",tooltip:"Previous Page",text:null,onclick:function(){Xo()}},{type:"pagelabel",id:"Label_PageNumber",cls:Dn.atala_page_label},{type:"button",id:"Button_PageNext",cls:Dn.atala_tool_button_page_next,icon:"page-next",tooltip:"Next Page",text:null,onclick:function(){Go()}},{type:"button",id:"Button_ZoomOut",cls:Dn.atala_tool_button_zoom_out,icon:"zoom-out",tooltip:"Zoom Out",text:"",onclick:function(){Ko()}},{type:"button",id:"Button_ZoomIn",cls:Dn.atala_tool_button_zoom_in,icon:"zoom-in",tooltip:"Zoom In",text:"",onclick:function(){$o()}},{type:"button",id:"Button_FitNone",cls:Dn.atala_tool_button_fit_none,icon:"zoom-full",tooltip:"Full Size",text:"",onclick:function(){oo(1)}},{type:"button",id:"Button_FitBest",cls:Dn.atala_tool_button_fit_best,icon:"fit-best",tooltip:"Best Fit",text:"",onclick:function(){co(wn.Best)}},{type:"button",id:"Button_FitWidth",cls:Dn.atala_tool_button_fit_width,icon:"fit-width",tooltip:"Fit To Width",text:"",onclick:function(){co(wn.Width)}}]};return An.showselecttools&&e.children.splice(5,0,{type:"button",id:"Button_ZoomArea",cls:Dn.atala_tool_button_zoom_area,icon:"zoom-area",tooltip:"Zoom Area",text:"",onclick:k}),An.allowtext&&(e.children.splice(3,0,{type:"button",id:"Button_Text",cls:Dn.atala_tool_button_text_tool,icon:"text-tool",tooltip:"Text Selection",text:"",onclick:function(){vn.mouseTool.setTool(xn.Text)}}),e.children.splice(3,0,{type:"button",id:"Button_Text",cls:Dn.atala_tool_button_pan_tool,icon:"pan-tool",tooltip:"Pan",text:"",onclick:function(){vn.mouseTool.setTool(xn.Pan)}})),An.showrotatetools&&(e.children.push({type:"button",id:"Button_RotateLeft",cls:Dn.atala_tool_button_rotate_left,icon:"rotate-left",tooltip:"Rotate Left",text:"",onclick:B(270)}),e.children.push({type:"button",id:"Button_RotateRight",cls:Dn.atala_tool_button_rotate_right,icon:"rotate-right",tooltip:"Rotate Right",text:"",onclick:B(90)})),An.savepath.length>0&&e.children.unshift({type:"button",id:"Button_Save",cls:Dn.atala_tool_button_save,icon:"save",tooltip:"Save Changes",text:null,onclick:function(){Yo()}}),D(e)}function z(t){var e={id:un+"_toolbar",parent:t,children:[{type:"button",id:"Button_Ellipse",cls:Dn.atala_tool_button_ellipse_anno,icon:"ellipse",tooltip:"Draw Ellipse",text:"",onclick:_o},{type:"button",id:"Button_Highlight",cls:Dn.atala_tool_button_highlight_anno,icon:"highlight",tooltip:"Draw Highlight",text:"",onclick:_o},{type:"button",id:"Button_Line",cls:Dn.atala_tool_button_line_anno,icon:"line",tooltip:"Draw Line",text:"",onclick:_o},{type:"button",id:"Button_Lines",cls:Dn.atala_tool_button_lines_anno,icon:"lines",tooltip:"Draw Poly Lines",text:"",onclick:_o},{type:"button",id:"Button_Freehand",cls:Dn.atala_tool_button_freehand_anno,icon:"freehand",tooltip:"Draw Freehand",text:"",onclick:_o},{type:"button",id:"Button_Rectangle",cls:Dn.atala_tool_button_rect_anno,icon:"rectangle",tooltip:"Draw Rectangle",text:"",onclick:_o},{type:"button",id:"Button_Text",cls:Dn.atala_tool_button_text_anno,icon:"text",tooltip:"Draw Text",text:"",onclick:_o}]};return D(e)}function D(t){var e=w(t.parent),o=un+"_toolbar";e.buttons=[];for(var n=0;t.children&&n<t.children.length;n++){var a=null;switch(t.children[n].type){case"button":if(!Atalasoft.Utils.Browser.Features.Touch||"lines"!==t.children[n].icon){t.children[n].id=o+"_"+t.children[n].id;var i=M(t.children[n],e);i.addClass(Dn.atala_toolbar_button),a=i,e.buttons.push(i)}break;case"pagelabel":mn.pageLabel=v("span",e,o+"_"+t.children[n].id),a=mn.pageLabel}a&&t.children[n].cls&&a.addClass(t.children[n].cls)}return e}function T(t){var e=rn("<ul/>");for(var o in t)if(t.hasOwnProperty(o)){var n=parseFloat(rn.ui.version)>=1.12?"div":"a",a=rn("<li><"+n+' href="#">'+o+"</"+n+"></li>");Atalasoft.Utils.Browser.Features.Touch&&!Atalasoft.Utils.Browser.Mobile.iOS&&a.bind({touchend:t[o]}),a.click(t[o]),a.appendTo(e)}return e.menu(),e}function P(t,e,o){var n=rn('<div title="'+e+'" />');return o&&n.append(o),n.dialog(),n}function A(t){var e=v("span",mn.toolbar.annoToolbar);return M(t,e),C(e,t.id+"_Drop","ui-icon-triangle-1-s","Click To Choose",null,function(){var t=rn(this).next();if(t.is(":visible"))return t.hide(),!1;var e=t.prev().prev().parent();return t.menu().show().css({position:"absolute",top:0,left:0,"min-width":e.width()+"px","z-index":11}).position({my:"left top",at:"left bottom",of:e}),!1}),e.buttonset(),e}function V(t,e,o){for(var n=rn(t.children().first()),a={},i=0;i<o.length;i++)a[o[i].name]=H(n,e,o[i]);n.menu=T(a),t.append(n.menu),n.menu.hide()}function H(t,e,o){var n="menuselect"+e.icon+o.name,a=function(){return t.button("option","label","Draw "+o.name),t.data("_annoConfig",o),t.click(e.onclick),t.menu.hide(),t.trigger("click"),!1};return on(n,f(a,t)),a}function C(t,e,o,n,a,i){var l=rn('<button id="'+e+'" title="'+n+'">'+(a||n)+"</button>");return i&&l.click(i),l.button({icons:{primary:o},text:null!=a&&An.showbuttontext}),l.addClass("atala-ui-button"),t&&l.appendTo(t),l}function M(t,e){var o="menuclick"+t.icon,n=C(e,t.id,gn+" "+gn+"-"+t.icon,t.tooltip,t.text,p(o));return n.data("_config",t),on(o,f(t.onclick,n)),n}function E(t){function e(){f=w().addClass(Dn.atala_search_container),_=rn('<input type="text" placeholder="Search..." />').addClass(Dn.atala_search_input).addClass("ui-widget"),_.bind({keydown:a,"input propertychange":n});var t=v("span",f).css({width:"100%"});t.append(_);var e=v("span",f);m=C(e,null,gn+" "+gn+"-search-next","Next",null,d(i)).addClass(Dn.atala_search_next),b=C(e,null,gn+" "+gn+"-search-prev","Previous",null,d(l)).addClass(Dn.atala_search_prev),f.on("mousemove","."+x.clearable,g).on("touchstart click","."+x.onclear,p),y.append(f),y.append(rn('<div style="clear:both;"></div>'))}function o(){_.unbind({keypress:a,"input propertychange":n}),f.off("mousemove","."+x.clearable,g).off("touchstart click","."+x.onclear,p),z&&z.dispose(),f.remove()}function n(){var t=_.val();return t?_.addClass(x.clearable):_.removeClass(x.clearable),t&&z&&z.isValid()&&t===z.getQuery()?!0:(clearTimeout(D),z=null,t&&t.length>=3?(u(!0),D=setTimeout(function(){z=vn.text.search(t,tn(),s),c(!0)},An.mousetool.text.searchdelay),!1):(r(),void 0))}function a(t){var e=_.val();return 13===t.keyCode&&z&&e&&z.isValid()&&z.getQuery()===e?(t.shiftKey?l():i(),!1):13!==t.keyCode||z&&z.isValid()?27===t.keyCode?(r(),p(),!1):(Atalasoft.Utils.Browser.Explorer&&Atalasoft.Utils.Browser.Version<=9&&(8===t.keyCode||46===t.keyCode)&&(clearTimeout(D),D=setTimeout(function(){n()},An.mousetool.text.searchdelay)),void 0):(n(),!1)}function i(){z&&(c(!0),z.next(s))}function l(){z&&(c(!0),z.prev(s))}function r(){z=null,vn.text.search(""),c(!1),u(!0)}function s(t,e){t.isValid()&&(c(!1),t.wrap=An.mousetool.text.wrapsearch,e||u(e))}function c(t){h(x.loading,t)}function u(t){h(x.inputEmpty,!t)}function d(t){return function(e){e.preventDefault(),t&&t()}}function h(t,e){e?_.addClass(t):_.removeClass(t)}function g(t){h(x.onclear,this.offsetWidth-18<t.clientX-this.getBoundingClientRect().left)}function p(t){t&&t.preventDefault(),_.removeClass(x.clearable).removeClass(x.onclear).val("").change(),n()}var f,_,m,b,x={clearable:"atala_search_input_clearable",onclear:"atala_search_input_clear_hover",inputEmpty:"atala_search_input_empty",loading:"atala_search_input_loading"},y=t.parent||mn.toolbar,z=null,D=null;e(),this.dispose=o}function k(){An.allowannotations&&sn.annotations.cancelDraw(),vn.mouseTool.setTool(xn.ZoomArea)}function B(t){return function(){var e=yn.number-1;vn.document.rotatePage(e,vn.document.getPageRotation(e)+t,function(){var t=ho(e),o=ne(e),n=An.direction===bn.Vertical?o.height*t:0;Ze(An.pageselectlocation,Atalasoft.Utils.PageSelection.Center)||Ze(An.pageselectlocation,Atalasoft.Utils.PageSelection.MiddleLeft)?n/=2:Ze(An.pageselectlocation,Atalasoft.Utils.PageSelection.TopLeft)&&(n=0);var a={x:An.direction===bn.Vertical?0:n,y:An.direction===bn.Vertical?n:0};Qe(e,a,An.pageselectlocation,!0)})}}function L(t,e){var o=Atalasoft.Utils.Browser.Explorer&&parseInt(Atalasoft.Utils.Browser.Version,10)<8,n=w(t,e);return An.direction===bn.Vertical?(n.height(1),n.css({display:"block"})):An.direction===bn.Horizontal&&(n.width(1),n.css({display:"inline-block"})),n._zoom=1,o&&n.html("&nbsp;"),n}function U(t){function e(t){return function(){Ee(t)}}if("undefined"==typeof t){var o=R(W());yn.buffer<o&&(yn.buffer=o),yn.buffer=Math.min(yn.buffer,vn.document.getPageCount()),t=yn.buffer}if(mn.pageDivs.length<t)for(var n=mn.pageDivs.length;t>n;n++)mn.pageDivs[n]=w(),mn.pageDivs[n].addClass(Dn.atala_page_div),An.showselecttools&&(mn.pageDivs[n]._rubberband=new Atalasoft.Controls.RubberBandTool(sn,{},mn.pageDivs[n],{getViewportSize:ie,getMaxZoom:Q,getPageOffsets:Y,raiseDrawLayer:bo,resetDrawLayer:xo})),mn.pageDivs[n].bind({touchstart:e(mn.pageDivs[n]),mousedown:e(mn.pageDivs[n])}),vn.annotations&&vn.annotations.addDrawingSurface(mn.pageDivs[n]),(An.showselecttools||An.allowannotations||An.allowforms||An.allowtext)&&(mn.pageDivs[n]._draw=b(mn.pageDivs[n])),vn.forms&&!cn&&vn.forms.addFormLayer(mn.pageDivs[n]),vn.text&&!cn&&vn.text.addTextLayer(mn.pageDivs[n]);else if(mn.pageDivs.length>t)for(;mn.pageDivs.length>t&&0!==mn.pageDivs.length;){var a=mn.pageDivs.pop();a._rubberband&&a._rubberband.dispose(),vn.annotations&&vn.annotations.removeDrawingSurface(a),vn.forms&&!cn&&vn.forms.removeFormLayer(a),vn.text&&!cn&&vn.text.removeTextLayer(a),a&&Se(a),a=null}}function S(t,e,o){function n(){return U._page?U._page._index:-1}function a(){return U._domEl}function i(t){return vn.document.getPageFitMultiplier("undefined"!=typeof t?t:n(),un)}function l(t,e){return t="undefined"==typeof t?An.zoom:t,t*i(e)}function r(t){return vn.document.setPageFitMultiplier(n(),t,un)}function s(){var t=ne(n())||yn.size;return{height:t.height,width:t.width}}/**
        * Returns physical size of the image without client transformations applied(like view rotation)
        */
function c(){var t=s();return 90===U._viewrotation||270===U._viewrotation?B(t):t}function u(t,e){return e=e||s(),{height:Math.round(e.height*l(t)),width:Math.round(e.width*l(t))}}function d(){U.bind(F);var t=An.pageborderwidth,e={bottom:0,top:0,right:0,left:0};U._loaded=!1,U._reqzoom=-1,(An.direction===bn.Vertical||An.tabular)&&(e.bottom=An.pagespacing),(An.direction===bn.Horizontal||An.tabular)&&(e.right=An.pagespacing),An.showpageborder&&a().css({"border-bottom":t+"px solid black","border-right":t+"px solid black","border-top":t+"px solid silver","border-left":t+"px solid silver","margin-bottom":e.bottom+"px","margin-right":e.right+"px"}),a().css({display:"inline-block"}),h(U._index)}function h(){var t=n(),o=yn.vector&&"number"==typeof vn.document.getPageReference(t),a=o?l():Math.min(l(),1),i=vn.document.getPageRotation(t);if(a!==U._zoom||U._rotation!==i){var r={atala_docurl:e?e.uri:An.documenturl,atala_doczoom:a,atala_thumbpadding:!1};i&&(r.atala_angle=i),An.jpeg&&(r.atala_jpeg=!0);var s={type:"docpage",serverurl:An.serverurl,query:"?ataladocpage="+(null===e?U._index:void 0!==e.index?e.index:e),method:"GET",data:r,cancel:!1,info:U};U._reqzoom=a,Io(s,g,g)}}function g(){U._loaded=!0,U._zoom=U._reqzoom,n()>=0&&(U._rotation=vn.document.getPageRotation(n()),E(),U.parent().length>0?m():S&&U._page&&U._page.nullinserted&&(Fe(U._page,U,n(),!0),m()),k(0)),V()}function p(){U._loaded&&m()}function f(t){t&&(t.removeAttr("width height"),t.css({width:"auto",height:"auto"}))}function m(){f(U);var t=U.prop("naturalWidth")||0,e=U.prop("naturalHeight")||0,o=t||U.width(),i=e||U.height(),r=s(),d=l(),h=!1;if(0!==o&&0!==i){U._size.width=Math.round(o/U._zoom),U._size.height=Math.round(i/U._zoom),(90===U._viewrotation||270===U._viewrotation)&&(U._size=B(U._size)),(U._size.width!==yn.size.width||U._size.height!==yn.size.height)&&(j(U._size.width,r.width)&&j(U._size.height,r.height)||(h=!0,vn.document.setPageSize(n(),U._size,un))),An.forcepagefit?P():(U._zoom!==An.zoom||h||0!==U._viewrotation)&&D();var g=u();h&&U.trigger({type:"pagesizechanged",image:U,index:n(),width:U._size.width,height:U._size.height,dx:Math.round(g.width-r.width*d),dy:Math.round(g.height-r.height*d)}),U.trigger({type:"pageresize",image:U,index:n(),width:g.width,height:g.height})}else if(S){var p=c(),_=A(p);return p.width*=_,p.height*=_,a().css(p),U.trigger({type:"pageresize",image:U,index:n(),width:p.width,height:p.height}),void 0}}function v(){U.unbind(F),U._page=null,U=null}function b(t,e){"function"==typeof e&&L.push(e),x()&&!U._size.isEmpty()&&(U._prevzoom=U._reqzoom,t&&!zn.loading?U.animate({height:Math.round(U._size.height*l()),width:Math.round(U._size.width*l())},{duration:dn,easing:"easeOutQuad",complete:z,queue:!1}):(D(),z()))}function x(){var t=!yn.vector&&1===U._reqzoom&&1===U._prevzoom&&l()>1,e=j(U._reqzoom,l())||t;if(!e){var o=Math.abs(U._reqzoom*U._size.width-l()*U._size.width),n=Math.abs(U._reqzoom*U._size.height-l()*U._size.height);1>o&&1>n&&(e=!0)}return!e||y()}function y(){return!j(U._scaledzoom,l())}function z(){U.trigger({type:"pagezoom",index:n(),height:Math.round(U._size.height*l()),width:Math.round(U._size.width*l()),prevzoom:U._prevzoom,zoom:l()}),0===zn.prpr?h():V()}function D(){var t=u(void 0,c()),e=u();U.height(t.height),U.width(t.width),U._domEl.width(e.width),U._domEl.height(e.height),U._scaledzoom=l(),k(U._viewrotation),Ge(n(),e.width,e.height)}function T(){V();var t=n();_("ImageError","Image at frameIndex "+(t>0?t:U._index)+" failed to load.")}function P(){var t=A();r(t/An.zoom),D()}function A(t){var e=1;t=t||U._size;var o={width:An.forcepagesize.width*(cn?1:An.zoom),height:An.forcepagesize.height*(cn?1:An.zoom)};return(o.width<1||o.height<1)&&(o.width=yn.size.width*An.zoom,o.height=yn.size.height*An.zoom),e=t.width/o.width>t.height/o.height?o.width/t.width:o.height/t.height}function V(){L.length>0&&N(L,U)}function H(){var t=vn.document.getPageRotation(n());return 0===U._viewrotation&&t!==U._rotation||0!==U._viewrotation}function C(){var t=vn.document.getPageRotation(n());return 0===U._viewrotation&&t!==U._rotation||0!==U._viewrotation&&(U._viewrotation+U._rotation)%360!==t}function M(t){if("function"==typeof t&&L.push(t),H()){var e=vn.document.getPageRotation(n());if(C()&&U&&U._loaded&&U._page&&(e=(360+e-U._rotation)%360,k(e),m()),0===zn.prpr&&U._loaded)return h(),void 0}V()}function E(){U._viewrotation=0}function k(t){S&&0!==t&&(U.remove(void 0,!0),U._page.nullinserted=!0);var e=c(),o=u(void 0,e),n=0,i=0,l="";(90===t||270===t)&&(n=(o.height-o.width)/2,cn&&e.width<e.height&&(n=0),i=(o.width-o.height)/2,o=B(o)),0!==t?(l+=" translate("+n+"px,"+i+"px)",l+="rotate("+t+"deg)",U.css(Atalasoft.Utils.__htmlTransformStyle(l))):U.css(Atalasoft.Utils.__htmlTransformStyle("")),a().css({width:o.width,height:o.height}),U._viewrotation=t}function B(t){var e=t.width;return t.width=t.height,t.height=e,t}var L="function"==typeof o?[o]:[],U=rn(new Image),S=Atalasoft.Utils.Browser.Explorer&&parseInt(Atalasoft.Utils.Browser.Version,10)<=8;U._domEl=w(),U._domEl.addClass(Dn.atala_page_image_anchor),U.addClass(Dn.atala_page_image),S||U._domEl.append(U);var F={load:g,error:T,inserted:p};return U._binds=F,U._index=t,U._loaded=!1,U._size={width:0,height:0,isEmpty:function(){return 0===this.width&&0===this.height}},U._zoom=-1,U._prevzoom=U._zoom,U._scaledzoom=-1,U._rotation=0,U._viewrotation=0,U.dispose=v,U.zoom=b,U.needsZoom=x,U.getSize=s,U.getScaledSize=u,U.getFitZoom=l,U.getFitMultiplier=i,U.needsRotate=H,U.rotate=M,U.getDomElement=a,d(),U}function F(t,e){function o(t){h._pagenum=t}function n(){return h.height()-h[0].clientHeight}function a(t){h._scrollSize=t}function i(t){h._ratio=t}function l(){if(!h.propagationPaused()){clearTimeout(h._tooltip._timeout),mn.scroller.stop(),mn.scroller.pauseEventPropagation(!0);var t={};h._direction===bn.Vertical?(mn.scroller.scrollTop(h[0].scrollTop*h._ratio),h._pagenum=s(h,h[0].scrollTop),t.right=h.width()+10+"px",t.top=16+Math.round((h[0].offsetHeight-48)/h[0].scrollHeight*h[0].scrollTop)+"px"):h._direction===bn.Horizontal&&(mn.scroller.scrollLeft(h[0].scrollLeft*h._ratio),h._pagenum=s(h,h[0].scrollLeft),t.bottom=h.height()+10+"px",t.left=16+Math.round((h[0].offsetWidth-48)/h[0].scrollWidth*h[0].scrollLeft)+"px"),h._direction===An.direction&&("none"===h._tooltip.css("display")&&(h._tooltip.css(t),h._tooltip.show()),h._tooltip.html("Page "+h._pagenum),h._tooltip._timeout=setTimeout(r,1e3))}}function r(){h._tooltip.hide(),yn.number===h._pagenum||Ne(h._pagenum)||Ce(h._pagenum),ko()}function s(t,e){if(An.forcepagefit){e*=t._ratio;var o=t._direction===bn.Vertical?{x:0,y:e}:{x:e,y:0};return $(o.x,o.y)+1}return Math.floor(e/(t._max/vn.document.getPageCount()))+1}var c=Atalasoft.Utils.Browser.Explorer&&parseInt(Atalasoft.Utils.Browser.Version,10)<8,u="overflow:scroll; position:absolute; background-color:Transparent;",d=w(t);d.css({position:"absolute",display:"none","background-color":"white"});var h=null;return e===bn.Horizontal?(h=rn('<div style="'+u+'bottom:0px; left:0px; width:100%;z-index:10"></div>').appendTo(t),h._tray=rn('<div style="width:1000px; height:1px;"></div>').appendTo(h)):(c&&(u+="width:"+(ae()+1)+"px;"),h=rn('<div style="'+u+'top:0px; right:0px; height:100%;z-index:10"></div>').appendTo(t),h._tray=rn('<div style="width:1px; height:1000px;"></div>').appendTo(h)),O(h),h._ratio=1,h._direction=e,h._tooltip=d,h._pagenum=-1,h._scrollSize=0,h.pageNum=o,h.scrollbarHeight=n,h.scrollSize=a,h.ratio=i,h.bind({scroll:l}),h}function I(t){t&&t._tooltip&&(clearTimeout(t._tooltip._timeout),t._tooltip.hide())}function O(t){function e(){t.unbind(o),t.resumeEventPropagation()}var o={scroll:e};t._pauseEP=0,t.propagationPaused=function(){return t._pauseEP>0},t.pauseEventPropagation=function(e){t._pauseEP++,e&&t.bind(o)},t.resumeEventPropagation=function(){t._pauseEP>0&&t._pauseEP--}}function R(t){var e=ie(),o=Z(0,t);o.width=yn.smallest.width>0&&yn.smallest.width<o.width?yn.smallest.width:o.width,o.height=yn.smallest.height>0&&yn.smallest.height<o.height?yn.smallest.height:o.height;var n,a=Math.ceil(e.width/o.width)+2,i=Math.ceil(e.height/o.height)+2;return An.tabular?(An.direction===bn.Vertical&&An.columns>0?a=An.columns:An.direction===bn.Horizontal&&An.rows>0&&(i=An.rows),n=a*i):An.direction===bn.Vertical?n=i:An.direction===bn.Horizontal&&(n=a),n}function j(t,e){return t+.001>e&&e>t-.001}function q(t){try{t.parentNode&&t.parentNode.removeChild(t),pn.appendChild(t),pn.innerHTML=""}catch(e){}}function N(t){for(var e=Array.prototype.slice.call(arguments,1);t.length;)t.shift().apply(this,e)}function W(){return 0!==yn.size.width?An.minwidth/yn.size.width:1}function Q(){return 0!==yn.size.width?An.maxwidth/yn.size.width:1}function Z(t,e,o){if(o="undefined"==typeof o?!0:o,zn.newpagedivsize){var n={width:zn.newpagedivsize.width,height:zn.newpagedivsize.height},a=An.showpageborder&&o?2*An.pageborderwidth:0,i=(e||An.zoom)/zn.newpagedivfullzoom;return n.height=Math.round(n.height*i)+a,n.width=Math.round(n.width*i)+a,n}return G(t,e||An.zoom,An.showpageborder&&o)}function G(t,e,o){var n=rn.extend({},ne(t)),a=o?2*An.pageborderwidth:0;return e*=uo(t),n.height=Math.round(n.height*e)+a,n.width=Math.round(n.width*e)+a,n}function X(t,e){return Y(null,t,e).index}function $(t,e){var o=ie(),n={x:t+An.pageselectlocation.x*o.width,y:e+An.pageselectlocation.y*o.height};return X(n.x,n.y)}function K(t,e){for(var o={left:0,top:0},n=t;null!=n&&n!==e;n=n.offsetParent)o.left+=n.offsetLeft,o.top+=n.offsetTop;return o}function J(){if(Hn.isEmpty()||Hn.zoom!==An.zoom){var t=Y(null,null,null,An.zoom);Hn.height=t.height,Hn.width=t.width,Hn.zoom=An.zoom}return Hn}function Y(t,e,o,n){if(An.tabular)return te(t,e,o,n);var a=vn.document.getPageCount(),i={height:0,width:0,index:0};if(t=null==t?t=a:t,An.direction===bn.Vertical)for(var l=null,r=0;a>r&&t>r&&(i.height+(l=Z(r,n).height)<=o||null==o);r++)i.height+=l+An.pagespacing,i.index++;else if(An.direction===bn.Horizontal)for(var s=null,c=0;a>c&&t>c&&(i.width+(s=Z(c,n).width)<=e||null==e);c++)i.width+=s+An.pagespacing,i.index++;return i.index>=a&&a>0&&(i.index=a-1),i}function te(t,e,o,n){var a=vn.document.getPageCount(),i={height:0,width:0,index:0},l=ee(n);t=null==t?t=a:t;var r,s;An.direction===bn.Vertical?(r=l||1,s=Math.ceil(a/r)):An.direction===bn.Horizontal&&(s=l||1,r=Math.ceil(a/s));var c=Z(0,n);c.width+=An.pagespacing,c.height+=An.pagespacing;var u=null==o?Math.floor(t/r):Math.floor(o/c.height),d=null==e?t%r:Math.ceil(e/c.width);return i.height=u*c.height,i.width=d*c.width,i.index=u*r+d,i.index>=a&&a>0&&(i.index=a-1),i}function ee(t){var e=1;return An.tabular&&(An.direction===bn.Vertical?e=Math.floor(ie().width/Z(0,t).width):An.direction===bn.Horizontal&&(e=Math.floor(ie().height/Z(0,t).height))),e}function oe(t,e){var o=ne(t),n=go(t)+(e||0);return n%180===0?o:{width:o.height,height:o.width}}function ne(t){var e=vn.document.getPageSize(t,un);return e?e:yn.size}function ae(){var t=w(rn("body")),e=w(t);t.css({width:"50px",height:"50px",overflow:"hidden",position:"absolute",visibility:"hidden"}),e.css({width:"100px",height:"100px"});var o=t.width();t.css({"overflow-y":"scroll"});var n=o-t[0].clientWidth;return rn(t).remove(),n}function ie(){return mn.scrollH&&mn.scrollV?{width:mn.main.width()-mn.scrollV.width(),height:mn.main.height()-mn.scrollH.scrollbarHeight()}:{width:mn.main.width(),height:mn.main.height()}}function le(){var t=ie(),e=An.showpageborder?2*An.pageborderwidth:0,o={width:t.width-e,height:t.height-e};return An.tabular&&(An.columns>1&&(o.width=Math.floor((t.width-(An.pagespacing+e)*An.columns)/An.columns)),An.rows>1&&(o.height=Math.floor((t.height-(An.pagespacing+e)*An.rows)/An.rows))),o}function re(t,e){var o={status:"fail",started:!1,reason:t};return"function"==typeof e&&e.call(),o}function se(t,e,o,n,a,i){var l=K(t,e);return l.left<a&&l.left+t.clientWidth>o&&l.top<i&&l.top+t.clientHeight>n}function ce(t,e,o){return e<t.length?(t.splice(o,0,t.splice(e,1)[0]),!0):!1}function ue(t){An.showstatus&&mn.status&&mn.status.html(t),an({type:"statusmessage",message:t})}function de(t,e){var o;if(1===t.length&&"object"==typeof t[0])o=t[0];else if("string"==typeof t[0]){o={};var n=null;3===t.length?n=t[2]:2===t.length&&(n=t[1]);for(var a=t[0].indexOf(" ")>-1?t[0].split(" "):[t[0]],i=0;i<a.length;i++)o[a[i]]=n}for(var l in o)if(o.hasOwnProperty(l)){var r=null;if(l in Pn?r=Pn:sn&&l in sn.annotations.events?r=sn.annotations.events:sn&&l in sn.forms.events?r=sn.forms.events:sn&&l in sn.document.events&&(r=sn.document.events),null==r&&(r=Pn),null==r[l]&&e)r[l]=[o[l]];else if(e)r[l].push(o[l]);else if(o[l])for(var s=0;s<r[l].length;s++)r[l][s]===o[l]&&r[l].splice(s,1);else r[l].length=0}}function he(){An.direction=An.direction===bn.Vertical||An.direction===bn.Horizontal?An.direction:bn.Vertical,An.fitting=An.fitting===wn.None||An.fitting===wn.Best||An.fitting===wn.Width||An.fitting===wn.Height?An.fitting:wn.Width,An.pageborderwidth=pe(An.pageborderwidth)?parseInt(An.pageborderwidth,10):1,An.pagespacing=pe(An.pagespacing)?parseInt(An.pagespacing,10):4,An.showpageborder=An.showpageborder?!0:!1,An.showpagenumber=An.showpagenumber?!0:!1,An.showstatus=An.showstatus?!0:!1,An.zoom=pe(An.zoom,!0)?parseFloat(An.zoom):1,An.scripturl=ge(An.scripturl)?An.scripturl:An.scripturl+"/"}function ge(t){return t.length>0?-1!==t.indexOf("/",t.length-1)||-1!==t.indexOf("\\",t.length-1)?!0:!1:!0}function pe(t,e){return e?isFinite(parseFloat(t)):isFinite(parseInt(t,10))}function fe(t,e,o,n,a){if(null==a&&"function"==typeof n&&(a=n,n=null),t=null==t?mn.scroller.scrollLeft():t,e=null==e?mn.scroller.scrollTop():e,An.direction===bn.Horizontal){if(t>mn.viewport.width()){var i=J();if(t<i.width&&mn.content.width()>0){var l=i.width-(mn.edges[0].width()+mn.content.width());mn.edges[1].width(l)}}}else if(An.direction===bn.Vertical&&e>mn.viewport.height()){var r=J();if(e<r.height&&mn.content.height()>0){var s=r.height-(mn.edges[0].height()+mn.content.height());mn.edges[1].height(s)}}mn.scroller.stop(),!o||zn.loading||zn.scrollPos.x===t&&zn.scrollPos.y===e?(mn.scroller.scrollLeft(t),mn.scroller.scrollTop(e),"function"==typeof a&&a.call()):rn.when(mn.scroller.animate({scrollLeft:t,scrollTop:e},{duration:n||hn,easing:"easeOutQuad",queue:!1})).done(a)}function _e(t,e,o,n,a){var i=mn.scroller.scrollLeft()+t,l=mn.scroller.scrollTop()+e;fe(i,l,o,n,a)}function me(t,e){if(mn.scroller.is(":animated"))return re("scrolling",e);var o=Y(yn.number+t-1);An.direction===bn.Vertical?fe(null,o.height,!0,e):An.direction===bn.Horizontal&&fe(o.width,null,!0,e)}function ve(){if(mn.scrollH&&mn.scrollV){var t=3e4,e=vn.document.getPageCount();if(mn.scrollH.pauseEventPropagation(),mn.scrollV.pauseEventPropagation(),An.direction===bn.Vertical){be(mn.scrollH,"width");var o=Math.round(Y(e-1).height+Z(e-1).height);mn.scrollV.scrollSize(o-(mn.scrollV.height()-mn.scrollH.scrollbarHeight()-1)),o>t?(mn.scrollV.ratio(o/(t-(mn.scrollV.height()-mn.scrollH.scrollbarHeight()-1))),mn.scrollV._tray.height(t)):(mn.scrollV._tray.height(o),mn.scrollV.ratio(1))}else if(An.direction===bn.Horizontal){be(mn.scrollV,"height");var n=Math.round(Y(e-1).width+Z(e-1).width);mn.scrollH.scrollSize(n),n>t?(mn.scrollH.ratio(n/(t-(mn.scrollH.width()-mn.scrollV.width()-1))),mn.scrollH._tray.width(t)):(mn.scrollH._tray.width(n),mn.scrollH.ratio(1))}mn.scrollV._max=Math.max(mn.scrollV._tray.height()-mn.scrollV[0].clientHeight,0)+1,mn.scrollV.ratio(mn.scrollV._scrollSize/mn.scrollV._max),mn.scrollH._max=Math.max(mn.scrollH._tray.width()-mn.scrollH[0].clientWidth,0)+1,mn.scrollH.ratio(mn.scrollH._scrollSize/mn.scrollH._max),mn.scrollH.resumeEventPropagation(),mn.scrollV.resumeEventPropagation()}}function we(t,e){var o=3e4;if(An.direction===bn.Vertical){if(mn.scrollV)if(mn.scrollV.scrollSize(Math.max(mn.scrollV._scrollSize+e,0)),1===mn.scrollV._ratio&&mn.scrollV._scrollSize+e<o)mn.scrollV._tray.height(mn.scrollV._tray.height()+e),mn.scrollV._max=Math.max(mn.scrollV._tray.height()-mn.scrollV[0].clientHeight,0)+1;else{var n=mn.scrollV.height()-mn.scrollH.scrollbarHeight()-1,a=(o-n)*mn.scrollV._ratio;a+e>o?mn.scrollV.ratio((a+e)/(o-n)):ve()}be(mn.scrollH,"width")}else if(An.direction===bn.Horizontal){if(mn.scrollH)if(mn.scrollH.scrollSize(Math.max(mn.scrollH._scrollSize+t,0)),1===mn.scrollH._ratio&&mn.scrollH._scrollSize+t<o)mn.scrollH._tray.width(mn.scrollH._tray.width()+t),mn.scrollH._max=Math.max(mn.scrollH._tray.width()-mn.scrollH[0].clientWidth,0)+1,mn.scrollH.ratio(mn.scrollH._scrollSize/mn.scrollH._max);else{var i=mn.scrollH.width()-mn.scrollV.width()-1,l=(o-i)*mn.scrollH._ratio;l+t>o?mn.scrollH.ratio((l+t)/(o-i)):ve()}be(mn.scrollV,"height")}if((0!==t||0!==e)&&0!==e){var r=mn.scroller[0].scrollLeft,s=mn.scroller[0].scrollTop;ke($(r,s)+1),an({type:"scroll",x:r,y:s,dx:0,dy:0})}}function be(t,e){if(t){for(var o=Math.round(yn.size[e]*An.zoom),n=0;n<mn.pageDivs.length;n++)null!=mn.pageDivs[n]._index&&(o=Math.max(Z(mn.pageDivs[n]._index)[e],o));t._tray[e](o),t.scrollSize(o-t[e]()),t.ratio(1)}}function xe(t){if(!zn.zooming&&!zn.scrollBuffer){var e=(new Date).getTime(),o=mn.scroller[0].scrollLeft,n=mn.scroller[0].scrollTop,a=o+mn.scroller[0].clientWidth,i=n+mn.scroller[0].clientHeight,l=X(o,n)+1,r=Math.abs(l-yn.number);if(!zn.loading){var s=0===r&&mn.pageDivs.length>1&&(yn.number-1<mn.pageDivs[0]._index||yn.number-1>mn.pageDivs[mn.pageDivs.length-1]._index);r<mn.pageDivs.length&&!s?se(mn.edges[1][0],mn.scroller[0],o,n,a,i)?Ve(r):se(mn.edges[0][0],mn.scroller[0],o,n,a,i)?Ae(r):l!==yn.number&&null===We(l-1)&&Ce(l):Me(l,!1,null),so()}if(ke($(o,n)+1),!mn.scroller.propagationPaused()&&mn.scrollH&&mn.scrollV){var c=Math.round(o/mn.scrollH._ratio),u=Math.round(n/mn.scrollV._ratio);c!==mn.scrollH.scrollLeft()&&(mn.scrollH.pauseEventPropagation(!0),mn.scrollH.scrollLeft(c)),u!==mn.scrollV.scrollTop()&&(mn.scrollV.pauseEventPropagation(!0),mn.scrollV.scrollTop(u))}an({type:"scroll",x:o,y:n,dx:o-zn.scrollPos.x,dy:n-zn.scrollPos.y}),t&&(zn.scrollTimeout&&clearTimeout(zn.scrollTimeout),zn.scrollTimeout=setTimeout(function(){ye(o,n)},500),zn.scrollPos.x=o,zn.scrollPos.y=n,zn.scrollPos.t=e),zn.scrollBuffer=t?setTimeout(ze,50):null}}function ye(t,e){var o=mn.scroller[0].scrollLeft,n=mn.scroller[0].scrollTop,a=o===zn.scrollPos.x&&n===zn.scrollPos.y;t===zn.scrollPos.x&&e===zn.scrollPos.y&&a?(ko(),zn.scrollTimeout=null):a||(xe({}),zn.scrollTimeout=null)}function ze(){null!==zn.scrollBuffer&&(clearTimeout(zn.scrollBuffer),zn.scrollBuffer=null)}function De(){An.direction===bn.Vertical?Atalasoft.Utils.Browser.Explorer&&parseInt(Atalasoft.Utils.Browser.Version,10)<8&&(mn.edges[0].width(mn.content.width()),mn.edges[1].width(mn.content.width())):An.direction===bn.Horizontal&&(mn.edges[0].height(mn.pageDivs[0].height()),mn.edges[1].height(mn.pageDivs[0].height()))}function Te(t,e){e=null===e?t+mn.pageDivs.length:e;var o=An.tabular?ee():1;if(An.direction===bn.Vertical)mn.edges[0].height(Y(t).height),e+o>=vn.document.getPageCount()?mn.scrollH?mn.edges[1].height(mn.scrollH.scrollbarHeight()):mn.edges[1].height(1):(mn.edges[1].height(Y(mn.pageDivs.length).height),Atalasoft.Utils.Browser.Chrome&&mn.content.height(""));else if(An.direction===bn.Horizontal)if(mn.edges[0].width(Y(t).width),e+o>=vn.document.getPageCount())mn.scrollV?mn.edges[1].width(mn.scrollV.width()):mn.edges[1].width(1);else{var n=Y(t).width,a=J().width,i=Y(mn.pageDivs.length).width,l=a-(i+n);mn.edges[1].width(l),mn.edges[1].height(1)}}function Pe(){return zn.activepage}function Ae(t){if(t=t?t:1,0===zn.prpr&&mn.pageDivs.length>0){var e=ee(An.zoom);Oe();for(var o=t;o>0;o--){var n=mn.pageDivs[0]._index-e;if(n>=0&&n<vn.document.getPageCount()){for(var a=e-1;a>=0;a--){var i=je(-1);Ue(i),mn.content.prepend(i),Fe(i,qe(n+a),n+a)}Te(n,null),De(),Atalasoft.Utils.Browser.Explorer&&parseInt(Atalasoft.Utils.Browser.Version,10)<=8&&(mn.content[0].className=mn.content[0].className)}}setTimeout(Re,10)}}function Ve(t){t=t?t:1;var e=mn.pageDivs[mn.pageDivs.length-1]._index+1;if(0===zn.prpr&&mn.pageDivs.length>0&&e<vn.document.getPageCount()){Oe();for(var o=t;o>0;o--){var n=mn.pageDivs[mn.pageDivs.length-1]._index+1;if(n<vn.document.getPageCount()){for(var a=n-mn.pageDivs.length,i=ee(An.zoom),l=0;i>l;l++){var r=je(1);Ue(r),mn.content.append(r),Fe(r,qe(n+l),n+l)}Te(a+1,n),De()}}setTimeout(Re,10)}}/**
	* Scrolls the viewer to the given page index and executes the callback when finished
	* @param i int, page index (0 based)
	* @param callback: function to execute after this operation is done
	* @returns undefined
	*/
function He(t,e){Ce(t+1,e)}/**
	* Scrolls the viewer to the given page number and executes the callback when finished
	* @param i: int, page number (1 based)
	* @param callback: function to execute after this operation is done
	* @returns undefined
	*/
function Ce(t,e){if(t=Math.max(1,t),t=Math.min(vn.document.getPageCount(),t),yn.number!==t){var o=t-yn.number;Math.abs(o)<mn.pageDivs.length?me(o,e):Me(t,!0,e)}else"function"==typeof e&&e.call()}function Me(t,e,o){var n=vn.document.getPageCount(),a=t-1;if(0===zn.prpr&&n>0){var i=function(){Re(!e),"function"==typeof o&&o.call()};Oe();var l=0,r=0,s=0>=a?0:a;if(s+mn.pageDivs.length>=n&&(s=Math.max(n-mn.pageDivs.length,0)),An.direction===bn.Vertical){l=Y(s).height,mn.edges[0].height(l),Te(s,null),De(),Be();for(var c=0;c<mn.pageDivs.length;c++)mn.content.append(mn.pageDivs[c]),Fe(mn.pageDivs[c],null,s+c);var u=Y(Math.max(a,0)).height,d=yn.number<t?-yn.size.height:yn.size.height;e&&u!==zn.scrollPos.y?(fe(null,u+d,!1),fe(null,u,!0,i)):i.call()}else if(An.direction===bn.Horizontal){r=Y(s).width,mn.edges[0].width(r),Te(s,null),De(),Be();for(var h=0;h<mn.pageDivs.length;h++)mn.content.append(mn.pageDivs[h]),Fe(mn.pageDivs[h],null,s+h);var g=Y(Math.max(a,0)).width,p=yn.number<t?-yn.size.width:yn.size.width;e&&g!==zn.scrollPos.x?(fe(g+p,null,!1),fe(g,null,!0,i)):i.call()}}else re("paused",o)}function Ee(t){zn.activepage=t}function ke(t){var e=vn.document.getPageCount();if(t>0&&e>=t){if(yn.number!==t||yn.numberoutof!==e){if(mn.pageLabel.html(t+" / "+e),yn.number!==t){yn.number=t;for(var o=0;o<mn.pageDivs.length;o++){var n=mn.pageDivs[o];n._index===t-1?n.addClass(Dn.atala_active_page):n.removeClass(Dn.atala_active_page)}an({type:"pagenumberchanged",number:yn.number})}yn.numberoutof!==e&&(yn.numberoutof=e)}}else mn.pageLabel.html(""),mn.viewport.find("."+Dn.atala_active_page).removeClass(Dn.atala_active_page),yn.numberoutof=0}function Be(){for(var t=mn.pageDivs.length-1;t>=0;t--)Ue(mn.pageDivs[t])}function Le(){for(var t=0;t<mn.loadedImgs.length;t++)mn.loadedImgs[t]&&(mn.loadedImgs[t].dispose(),mn.loadedImgs[t].remove());mn.loadedImgs.length=0}function Ue(t){t.detach(),null!=t._img&&(t._img._page=null,t._img.getDomElement().detach(),t._img=null),an({type:"pagerecycled",page:t}),t._index=-1,t.removeAttr(Tn.atala_page_index)}function Se(t){t._index=-1,t.removeAttr(Tn.atala_page_index),t._img=null,t.remove()}function Fe(t,e,o,n){if(t._index===o&&t._img===e&&!n)return!1;if(n&&!t.nullinserted&&e){var a=vn.document.getPageReference(o);if("object"==typeof a?a=a.mapsto:("undefined"==typeof a||null===a)&&(a=e._index),e._index!==a)return}t._index=o,t.attr(Tn.atala_page_index,o),t._img&&t._img!==e&&(t._img._page=null,t.has(t._img.getDomElement()).length>0&&t._img.getDomElement().remove(void 0,!0)),t._rubberband&&t._rubberband.reset(),t._img=e,t._img&&(t._img._page=t),t.css({display:An.tabular||An.direction===bn.Horizontal?"inline-block":"block"}),An.showpagenumber&&(t.css({position:"relative"}),t._num||(t._num=rn('<div style="position:absolute; right:20px; bottom:16px;z-index:1"/>'),t._num.addClass(Dn.atala_page_number),t.append(t._num)),t._num.text(t._index+1));var i=Atalasoft.Utils.Browser.Explorer&&parseInt(Atalasoft.Utils.Browser.Version,10)<=8,l=i&&t._img&&!t._img._loaded;if(t._img&&t._img._binds&&(t._img._binds.pageresize||(t._img._binds.pageresize=function(t){an({type:"pageresize",page:t.image._page,image:t.image,index:t.image._page._index,width:t.width,height:t.height})},t._img.bind({pageresize:t._img._binds.pageresize})),t._img._binds.pagesizechanged||(t._img._binds.pagesizechanged=function(e){an({type:"pagesizechanged",page:t,image:e.image,index:t._index,width:e.width,height:e.height,dx:e.dx,dy:e.dy})},t._img.bind({pagesizechanged:t._img._binds.pagesizechanged}))),t._img&&!l){var r=t._img.getDomElement();i&&0===r.find(t._img).length&&r.append(t._img),t.append(r),t._img.trigger({type:"inserted",page:t}),t._img._loaded||(t.nullinserted?t._img.css({width:t.width(),height:t.height()}):Ie(t._img,t._index)),zn.newpagedivsize||t.css({width:"",height:""}),t.nullinserted=!1}else t.nullinserted=!0,zn.newpagedivsize||Ie(t,t._index);return an({type:"pageshown",page:t,index:t._index}),!0}function Ie(t,e){var o=Z(e,null,!1);t.css({width:o.width,height:o.height})}function Oe(){zn.prpr++}function Re(t){0!==zn.prpr&&(zn.prpr--,0!==zn.prpr||t||xe())}function je(t){return t>0?(ce(mn.pageDivs,0,mn.pageDivs.length-1),mn.pageDivs[mn.pageDivs.length-1]):(ce(mn.pageDivs,mn.pageDivs.length-1,0),mn.pageDivs[0])}function qe(t,e){var o=vn.document.getPageReference(t),n=-1;return null!==o&&("number"==typeof o?(t=o,n=t,o=null):"object"==typeof o&&(n=o.mapsto)),!mn.loadedImgs[n]&&n>=0?(mn.loadedImgs[n]=S(t,o,function(t){mn.loadedImgs.length<=n&&t&&(mn.loadedImgs[n]=t,vn.memory.allocate(t)),"function"==typeof e&&e.call()}),An.allowtext&&vn.text&&!cn&&setTimeout(function(){vn.text.ensurePageTextLoaded(t)},0)):"function"==typeof e&&e.call(),mn.loadedImgs[n]}function Ne(t){var e=We(t);if(e){var o=mn.scroller[0].scrollLeft,n=mn.scroller[0].scrollTop;return se(e[0],mn.scroller[0],o,n,o+mn.scroller[0].clientWidth,n+mn.scroller[0].clientHeight)}return!1}function We(t){for(var e=null,o=0;o<mn.pageDivs.length&&null===e;o++)mn.pageDivs[o]._index===t&&(e=mn.pageDivs[o]);return e}function Qe(t,e,o,n,a){n&&"function"==typeof n&&(a=n,n=!1);var i,l=We(t);if(l){var r=mn.scroller[0].scrollLeft,s=mn.scroller[0].scrollTop;if(i=K(l[0],mn.scroller[0]),i.left+=e.x,i.top+=e.y,!n&&i.left>=r&&i.left<=r+r+mn.scroller[0].clientWidth&&i.top>=s&&i.top<=s+mn.scroller[0].clientHeight)return a&&a(),void 0}else i=Y(t),i.left=i.width+e.x,i.top=i.height+e.y;var c={x:mn.scroller[0].clientWidth/2,y:mn.scroller[0].clientHeight/2};Ze(o,Atalasoft.Utils.PageSelection.BottomLeft)?(c.x=mn.scroller[0].clientWidth,c.y=mn.scroller[0].clientHeight):Ze(o,Atalasoft.Utils.PageSelection.TopLeft)&&(c.x=0,c.y=0),fe(i.left-c.x,i.top-c.y,!0,a)}function Ze(t,e){return t&&e&&t.x===e.x&&t.y===e.y}function Ge(t,e){var o=We(t);null!=o&&null!=o._num&&o._num.css({left:e-20,right:0})}function Xe(){}function $e(){0===zn.prpr&&(Atalasoft.Utils.Browser.Safari||Atalasoft.Utils.Browser.Chrome?mn.edges[1].hide().show():mn.edges[1][0].className=mn.edges[1][0].className)}function Ke(){mn.scroller.stop(),mn.scroller.pauseEventPropagation(),Oe()}function Je(){ve(),De(),mn.scroller.resumeEventPropagation(),Re()}function Ye(){zn.zooming=!0,Ke(),an("zoomstarted")}function to(t){t=Math.min(t,Q()),t=Math.max(t,W()),io(t,!1),An.zoom=t,so(!1),ro(t,!1)}function eo(){zn.zooming=!1,Je(),an({type:"zoomchanged",zoom:An.zoom})}/**
	* Asynchronously zooms the viewer to the given zoom over the default zoom duration
	* @param z number, desired zoom level to zoom to
	* @param callback function to execute after the zoom is finished animating
	* @returns undefined
	*/
function oo(t,e){zn.zooming?re("zooming",e):(zn.zooming=!0,Ke(),an("zoomstarted"),e=null==e?no:Atalasoft.Utils.__functionFromArray([no,e]),t!==An.zoom?(t=Math.min(t,Q()),t=Math.max(t,W()),io(t,!0),An.zoom=t,so(!0),ro(t,!0,e)):"function"==typeof e&&e.call())}function no(){zn.zooming=!1,Je(),xe(),an({type:"zoomchanged",zoom:An.zoom})}function ao(t,e){var o=An.zoom+(t?-1:1)*An.zoom*.3;oo(o,e)}function io(t,e,o){var n=Y(yn.number,null,null),a=Y(yn.number,null,null,t),i=(mn.scroller.scrollLeft()-n.width)/An.zoom*t,l=(mn.scroller.scrollTop()-n.height)/An.zoom*t;fe(a.width+i,a.height+l,e,dn,o)}function lo(){mn.edges[0]._z=An.zoom}function ro(t,e,o){if(mn.edges.length>0){o="function"==typeof o?Atalasoft.Utils.__functionFromArray([lo,o]):lo;var n=An.direction===bn.Vertical,a=mn.pageDivs[0]&&mn.pageDivs[0]._img?mn.pageDivs[0]._index:0,i=Y(a,null,null,t),l=n?i.height:i.width;if(e&&!zn.loading){var r=n?{height:l}:{width:l};mn.edges[0].animate(r,{duration:dn,easing:"easeOutQuad",complete:o,queue:!1})}else n?mn.edges[0].height(l):mn.edges[0].width(l),"function"==typeof o&&o.call()}}function so(t,e){for(var o=0,n=!0,a=function(){if(o--,0>=o){if(An.direction===bn.Horizontal){var t=J().width;mn.spacer||(mn.spacer=w(),mn.spacer.css({position:"absolute",top:"-1px",height:"1px"}),mn.viewport.append(mn.spacer)),mn.spacer.width(t)}"function"==typeof e&&e.call(),$e()}},i=0;i<mn.pageDivs.length;i++)if(mn.pageDivs[i]._img){var l=mn.pageDivs[i]._img.needsZoom()||mn.pageDivs[i]._img.needsRotate();l&&(n=!1,o++,mn.pageDivs[i]._img.needsRotate()?mn.pageDivs[i]._img.rotate(a):mn.pageDivs[i]._img.needsZoom()&&mn.pageDivs[i]._img.zoom(t,a))}n&&a.call()}/**
	* Asynchronously zooms the viewer to fit to a page
	* @param f: Fitting enum, type of fitting to fit the page to
	* @param pn: integer, page number to fit to
	* @param callback: function to execute after the fit is done animating
	*/
function co(t,e,o){var n=An.zoom,a=le();null!=e?"function"==typeof e&&(o=e,e=yn.number):e=yn.number;var i=G(e-1,1,!1),l=!1,r=!1;switch((0===i.width||0===i.height)&&(t=null),t){case wn.None:break;case wn.Best:i.width/a.width>i.height/a.height?(n=a.width/i.width,l=!0):n=a.height/i.height;break;case wn.Height:n=a.height/i.height,r=!0;break;case wn.Width:n=a.width/i.width,l=!0;break;default:n=1}l&&fe(0,null,!1),r&&fe(null,0,!1),oo(n,o)}function uo(t){return vn.document.getPageFitMultiplier(t,un)}function ho(t){return An.zoom*vn.document.getPageFitMultiplier(t,un)}function go(t){return vn.document.getPageRotation(t,un)}function po(t,e){e=e||0;var o=go(t),n=ho(t),a=oe(t,e),i=Raphael.matrix();i.scale(n,n,0,0),i.rotate(o+e,0,0);var l=fo(i,{x:a.width,y:a.height}),r=Math.min(0,l.x),s=Math.min(0,l.y),c=i.invert(),u=c.x(-r,-s),d=c.y(-r,-s);return i.translate(u,d),i}function fo(t,e){return{x:t.x(e.x,e.y),y:t.y(e.x,e.y)}}function _o(t){var e=rn.data(t.currentTarget,"_config"),o=rn.data(t.currentTarget,"_annoConfig");!o&&e&&(o={type:e.icon,rotatable:An.showrotatetools}),o&&(vn.mouseTool.setTool(xn.None,xn.None),vn.annotations.drawAnnotation(o,vo,mo))}function mo(){vn.mouseTool.setTool(xn.Pan,xn.None)}function vo(){vn.mouseTool.setTool(xn.Pan,xn.None)}/**
	* Depricated annotation function. Please use 'annotations' subtree.
	* @returns undefined
	*/
function wo(){return An.allowannotations===!1&&_("InitError",'The "allowannotations" property in the WebDocumentViewer config is set to false.'),An.allowannotations}function bo(){for(var t=0;t<mn.pageDivs.length;t++)mn.pageDivs[t]._draw.toFront()}function xo(){for(var t=0;t<mn.pageDivs.length;t++)mn.pageDivs[t]._draw.reset()}function yo(t,e){function o(t){zo(t,e)}function n(t,o,n){Do(t,o,n,e)}zn.loading=!0;var a={atala_docurl:An.documenturl,atala_pagebuffer:An.pagebuffersize,atala_minwidth:An.minwidth};cn&&(a.atala_thumb=cn,a.atala_capt_format=An.thumbcaptionformat),null!=t&&("function"==typeof t&&(e=t,t=null),rn.extend(a,t));var i={type:"docinfo",serverurl:An.serverurl,query:"?ataladocinfo=",method:"GET",data:a,cancel:!1,info:{pagewidth:-1,pageheight:-1,pagecount:-1}};Io(i,o,n)}function zo(t,e){if(t&&t.licensed!==!1)yn.size.width=t.pagewidth,yn.size.height=t.pageheight,yn.count=t.pagecount,yn.buffer=An.pagebuffersize,yn.dpi=t.dpi,yn.vector=t.vector===!0,yn.caption=t.thumbcaptionformat||(An.showthumbcaption?"{0}":""),Hn.zero(),vn.memory.clearEntries(),vn.memory.setColorDepth(t.colordepth),vn.memory.setPageSize(t.pagewidth,t.pageheight),an("documentinfochanged"),vn.text&&(vn.text.clear(),t.text&&vn.text.loadText(t)),zn.loading&&(U(),fe(0,0),mn.scrollV&&mn.scrollV.pageNum(1),ke(1),co(An.fitting,1,function(){De(),Te(0,mn.pageDivs.length);for(var o=0;o<mn.pageDivs.length&&o<yn.count;o++)mn.content.append(mn.pageDivs[o]),Fe(mn.pageDivs[o],null,o);mn.pageDivs.length>0&&mn.pageDivs[0].addClass(Dn.atala_active_page),t.layers&&t.layers.length?vn.annotations.loadAnnotations(t):An.annotationsurl&&vn.annotations&&vn.annotations.clear(),vn.forms&&(vn.forms.clear(),t.forms&&vn.forms.loadForms(t)),t.error&&_("DocumentLoadError",t.error),vn.mouseTool.setTool(An.mousetool.type&&!cn?An.mousetool.type:xn.Pan,xn.None),"function"==typeof e&&e.call()})),zn.loading=!1;else{if(t&&t.licensed===!1){var o=t.error?t.error:"LicenseException: Handler was unable to find a valid license.";_("LicenseException",o)}else _("DocumentLoadError","HandlerException: Handler did not return any data.");zn.loading=!1,"function"==typeof e&&e.call()}}function Do(t,e,o,n){if(t.responseText){var a=t.responseText.substr(t.responseText.indexOf("</html>")+7);a.indexOf("<!--")>=0?(a=a.replace("<!--","").replace("-->",""),a.length>0&&(o="<pre>"+a+"</pre>")):t.responseText.indexOf("web.config")>0&&t.responseText.indexOf("customErrors")>0&&(o+=": web.config customErrors attribute has disabled remote error messages.")}_("DocumentLoadError",o),"function"==typeof n&&n.call()}function To(){if(U(),mn.pageDivs.length>0){var t=vn.document.getPageCount(),e=mn.pageDivs.length>0?t-mn.pageDivs.length:0;"undefined"!=typeof mn.pageDivs[0]._index&&(e=Math.min(mn.pageDivs[0]._index,e));for(var o=mn.pageDivs.length>0?e:0,n=0;n<mn.pageDivs.length&&t>n;n++){var a=o+n;Ue(mn.pageDivs[n]),mn.content.append(mn.pageDivs[n]),Fe(mn.pageDivs[n],null,a)}}Te(mn.pageDivs.length>0?mn.pageDivs[0]._index:0,null),De(),ko(),ve();var i=mn.scroller[0].scrollLeft,l=mn.scroller[0].scrollTop;ke($(i,l)+1)}function Po(t,e){function o(t){Ao(t),"function"==typeof e&&e.call()}function n(t){var e=[];e.error=t.responseText,o(e)}var a={atala_docurl:An.documenturl,atala_spath:An.savepath};rn.extend(a,t);var i={type:"docsave",serverurl:An.serverurl,query:"?ataladocsave=",method:"POST",data:a,cancel:!1,info:{success:void 0,error:void 0}};Io(i,o,n)}function Ao(t){t.error?_("DocumentSaveError",t.error):ue("DocumentSave: success="+t.success),an({type:"documentsaved",success:t.success})}function Vo(t,e){var o=null;return"string"==typeof t?(o={},zn.initialized&&e&&(t.length>0?o=e.createHandlerRequest(An.serverurl,t):0===t.length&&e.clear()),o.url=t):"undefined"!=typeof t&&null!=t&&_("openUrlError","string input expected for url."),o}function Ho(){on({annotationsloaded:Uo})}function Co(t,e){vn.annotations&&(Ho(),vn.annotations.makeHandlerRequest(t,e))}function Mo(){on({formsloaded:So})}function Eo(t,e){vn.forms&&(Mo(),vn.forms.makeHandlerRequest(t,e))}function ko(t){if(!(mn.pageDivs.length>0&&"undefined"==typeof mn.pageDivs[0]._index))for(var e=0;e<mn.pageDivs.length;e++)Lo(mn.pageDivs[e],t)}function Bo(t,e){var o=We(t);o&&Lo(o,e)}function Lo(t,e){(Fe(t,qe(t._index),t._index)||e)&&(vn.annotations&&vn.annotations.showLayer(t._index,t),vn.forms&&!cn&&vn.forms.showLayer(t._index,t),vn.text&&!cn&&An.allowtext&&vn.text.showLayer(t._index,t))}function Uo(t){t.error&&(_("AnnotationsLoadError",t.error),An.annotationsurl=""),vn.annotations&&nn({annotationsloaded:Uo})}function So(t){t.error&&(_("FormsLoadError",t.error),An.formsurl=""),vn.forms&&nn({formsloaded:So})}function Fo(t){an({type:"beforehandlerrequest",request:t})}function Io(t,e,o){var n=Oo(t,function(t){e(t.request.info)});Fo(t),t.cancel||(nn({handlerreturned:n}),t.serverurl&&!rn.isEmptyObject(t.data)&&(t.info instanceof jQuery&&"docpage"===t.type?t.info.attr("src",t.serverurl+t.query+"&"+rn.param(t.data)):rn.ajax({type:t.method,url:t.serverurl+t.query+"?",dataType:"json",data:t.data,success:e,error:o})))}function Oo(t,e){var o=function(n){n.request===t&&(nn({handlerreturned:o}),"function"==typeof e&&e.call(this,n))};return on({handlerreturned:o}),o}function Ro(){if(An.debug){var t={};return rn.extend(!0,t,{dom:mn,controllers:vn,page:yn}),t}return null}function jo(t,e){function o(){this.typeOf="__LVlinker",this._id=un,this._config=An,this._controllers=vn,this._dom=mn,this._page=yn,this._state=zn,this._annos=null,this._fields=null,this._ocr=null,this._changes=null,this.__createDialog=P,this.__createDiv=w,this.__createDOM=v,this.__createDropDownButton=A,this.__createDropDownMenu=V,this.__createMenu=T,this.__getPageSize=ne,this.__getTabularIndexOffset=ee,this.__redrawVisiblePages=ko,this.__adjustVisiblePages=so,this.__onDocumentChanged=To,this.__startDomManipulation=Ke,this.__endDomManipulation=Je,this.__status=ue,this.__updatePageSize=d}if(t&&"Atalasoft.Controls.WebDocumentThumbnailer"===t.typeOf){var n=new o;return vn.document.__linkChanges(e||n),An.allowannotations&&(t!==sn&&An.annotationsurl.length>0&&(An.annotationsurl=""),vn.annotations.__linkAnnotations(n)),An.allowforms&&(t!==sn&&An.formurl.length>0&&(An.formurl=""),vn.forms.__linkForms(n)),An.allowtext&&vn.text&&vn.text.__linkText(e||n),n}}/**
	* Resets the viewer to its default state
	* @param callback function to execute when the empty process is finished
	*/
function qo(t){zn.loading=!0;var e=function(){an({type:"documentunloaded"}),"function"==typeof t&&t.call()};Be(),Le(),zo({pagewidth:0,pageheight:0,pagecount:-1},e)}/**
	* Gets the current zoom level of the viewer
	* @returns decimal number
	*/
function No(){return An.zoom}/**
	* Indicates whether the viewer is ready to receive commands
	* @returns bool
	*/
function Wo(){return zn.initialized}/**
	* Scrolls to the given coordinates, does not account for zoom
	* @param x number indicating the coordinate of the x axis 
	* @param y number indicating the coordinate of the y axis 
	* @param ani bool indicating whether to animate this scroll
	* @param callback function to execute when the scroll operation is finished
	* @returns undefined
	*/
function Qo(t,e,o,n){null==n&&"function"==typeof o&&(n=o,o=!1),fe(t,e,o,null,n)}/**
	* Scrolls by the given deltas, does not account for zoom
	* @param dx number indicating delta of the x axis 
	* @param dy number indicating delta of the y axis 
	* @param ani bool indicating whether to animate this scroll
	* @param callback function to execute when the scroll operation is finished
	* @returns undefined
	*/
function Zo(t,e,o,n){null==n&&"function"==typeof o&&(n=o,o=!1),_e(t,e,o,null,n)}/**
	* Scrolls to the next viewable page
	* @param n number of pages to scroll forward
	* @param callback function to execute when the scroll operation is finished
	* @returns undefined
	*/
function Go(t,e){var o=An.direction===bn.Vertical?ee():1;null==e&&"function"==typeof t&&(e=t,t=o),isFinite(t)||(t=o),me(t,e)}/**
	* Scrolls to the previous viewable page
	* @param n number of pages to scroll backward
	* @param callback function to execute when the scroll operation is finished
	* @returns undefined
	*/
function Xo(t,e){var o=An.direction===bn.Vertical?ee():1;null==e&&"function"==typeof t&&(e=t,t=o),isFinite(t)||(t=o),me(-t,e)}/**
	* Zooms in one level
	* @param callback function to execute when the zoom operation is finished
	* @returns undefined
	*/
function $o(t){ao(!1,t)}/**
	* Zooms out one level
	* @param callback function to execute when the zoom operation is finished
	* @returns undefined
	*/
function Ko(t){ao(!0,t)}/**
	* Opens the document at the given urls
	* @param surl string: url of the document file with respect to the config.serverurl
	* @param aurl string: url of the annotation xmp file with respect to the config.serverurl
	* @param furl string: url of the form file with respect to the config.serverurl 	
	* @param callback function to execute when the open operation is finished
	* @returns undefined
	*/
function Jo(t,e,o,n){null==n&&("function"==typeof e?(n=e,e=null):"function"==typeof o&&(n=o,o=null));var a=0,i=!1,l={},r=Vo(e,vn.annotations),s=Vo(o||t,vn.forms);An.annotationsurl=r?r.url:An.annotationsurl,An.formsurl=s?s.url:An.formsurl;var c=function(){a--,0>=a&&(ko(!0),an({type:"documentloaded"}),"function"==typeof n&&n.call())};if("string"==typeof t)0===t.length?qo(c):(An.documenturl=t,zn.initialized&&(Be(),Le(),I(mn.scrollH),I(mn.scrollV),a++,0===t.length&&qo(c),An.allowannotations&&r&&r.data&&(Ho(),rn.extend(l,r.data)),An.allowforms&&s&&s.data&&(Mo(),rn.extend(l,s.data)),i=!0,yo(l,c)));else{var u=!!(null==t&&An.documenturl.length>0&&(e||""===e||o||""===o));u||_("openUrlError","string input expected for document url.")}i||(r&&(a++,Co(r,c)),s&&(a++,Eo(s,c)))}/**
	* Saves the client changes in this document to the pre defined save folder or to the given path
	* @param surl string: optional relative path to save to, must be writable 
	* @sfileformat string: optional save file format, the value used for this call instead of savefileformat form config
	* @param callback function to execute when the save has finished
	* @returns
	*/
function Yo(t,e,o){null==o&&"function"==typeof e&&(o=e,e=An.savefileformat),null===o&&"function"==typeof t&&(o=t,t=null),void 0===e&&(e=An.savefileformat);var n={atala_subpath:t||"",atala_sformat:e};vn.annotations&&rn.extend(n,{atala_iuname:An.annotations.saveusername,atala_annos:vn.annotations.stringifyChanges()}),vn.forms&&rn.extend(n,{atala_forms:vn.forms.stringifyChanges()}),vn.document&&rn.extend(n,{atala_document:vn.document.stringifyChanges()}),Po(n,o)}/**
	* Gets the current page index
	* @returns number indicating the zero based page index
	*/
function tn(){return yn.number-1}/**
     * Sets the current mouse tool
     * @param tool: enum Atalasoft.Utils.MouseToolType, type of the tool to set
     */
function en(t){for(var e in Atalasoft.Utils.MouseToolType)if(Atalasoft.Utils.MouseToolType.hasOwnProperty(e)&&Atalasoft.Utils.MouseToolType[e]===t){vn.mouseTool.setTool(t);break}}/**
	* jQuery bind shortcut
	* @returns object, WebDocumentViewer
	*/
function on(){return de(arguments,!0),fn.bind.apply(fn,arguments),sn}/**
	* jQuery unbind shortcut
	* @returns object, WebDocumentViewer
	*/
function nn(){return de(arguments,!1),fn.unbind.apply(fn,arguments),sn}/**
	* jQuery trigger shortcut
	* @returns object, WebDocumentViewer
	*/
function an(){return fn.trigger.apply(fn,arguments),sn}/**
	* Gets the current document info
	* @returns object indicating document main page size, and number of pages
	*/
function ln(){return{count:yn.count,dpi:yn.dpi,size:{height:yn.size.height,width:yn.size.width},vector:yn.vector}}var rn=Atalasoft.$,sn={typeOf:e.type||"Atalasoft.Controls.WebDocumentViewer"},cn="Atalasoft.Controls.WebDocumentThumbnailer"===sn.typeOf,un="",dn=150,hn=500,gn="atala-ui-icon",pn=document.createElement("div"),fn=rn({}),_n=rn({}),mn={/** Main outer object that holds the scrollbars */
main:null,/** Toolbar wrapper object */
toolbar:null,/** Inner object that controls scrolling */
scroller:null,/** Inner object that defines the viewable area */
viewport:null,/** Inner content container object */
content:null,/** Inner horizontal scroll bar object */
scrollH:null,/** Inner vertical scroll bar object */
scrollV:null,/** Edge objects of viewable area */
edges:[],/** Image objects already requested */
loadedImgs:[],/** Page wrapper objects recycle pool */
pageDivs:[],/** Span tag containing the page number */
pageLabel:null,/** Status div */
status:null},vn={annotations:null,document:null,forms:null,mouseTool:null,memory:null,text:null},wn=Atalasoft.Utils.Fitting,bn=Atalasoft.Utils.ScrollDirection,xn=Atalasoft.Utils.MouseToolType,yn={size:{width:0,height:0},sizes:[{width:0,height:0}],smallest:{width:0,height:0},count:0,number:-1,numberoutof:-1,buffer:3,dpi:96,vector:!1,caption:""},zn={prpr:0,loading:!1,zooming:!1,initialized:!1,newpagedivsize:null,newpagedivfullzoom:1,scrollPos:{x:0,y:0,t:0},scrollBuffer:null,scrollTimeout:null,changes:{},activepage:null},Dn={/** Page element class */
atala_page_div:"atala_page_div",/** Page image anchor container element claass*/
atala_page_image_anchor:"atala_page_image_anchor",/** Page image element claass*/
atala_page_image:"atala_page_image",/** Page index element class. see config.showpagenumber. */
atala_page_number:"atala_page_number",/** Active page class */
atala_active_page:"atala_active_page",/** Active thumbnail class */
atala_active_thumb:"atala_active_thumb",/** Thumbnail caption class */
atala_thumb_caption:"atala_thumb_caption",/** Document toolbar element class */
atala_toolbar:"atala_toolbar",/** Annotations toolbar element class */
atala_annotation_toolbar:"atala_annotation_toolbar",/** Toolbar button element class */
atala_toolbar_button:"atala_toolbar_button",/** Class of the main outer object that holds the scrollbars */
atala_main_container:"atala_main_container",/** Class of the inner object that controls scrolling */
atala_scroller:"atala_scroller",/** Class of the inner object that defines the viewable area */
atala_viewport:"atala_viewport",/** Inner content container object class */
atala_content:"atala_content",/** Inner horizontal scroll bar object class */
atala_scroll_horizontal:"atala_scroll_horizontal",/** Inner vertical scroll bar object */
atala_scroll_vertical:"atala_scroll_vertical",/** Toolbar span element containing the page number */
atala_page_label:"atala_page_label",/** Status div */
atala_statusbar:"atala_statusbar",/** "Save Changes" toolbar button */
atala_tool_button_save:"atala_tool_button_save",/** "Previous Page" toolbar button */
atala_tool_button_page_prev:"atala_tool_button_page_prev",/** "Next Page" toolbar button */
atala_tool_button_page_next:"atala_tool_button_page_next",/** "Zoom Out" toolbar button */
atala_tool_button_zoom_out:"atala_tool_button_zoom_out",/** "Zoom In" toolbar button */
atala_tool_button_zoom_in:"atala_tool_button_zoom_in",/** "Full Size" toolbar button */
atala_tool_button_fit_none:"atala_tool_button_fit_none",/** "Best Fit" toolbar button */
atala_tool_button_fit_best:"atala_tool_button_fit_best",/** "Fit To Width" toolbar button */
atala_tool_button_fit_width:"atala_tool_button_fit_width",/** "Zoom Area" toolbar button */
atala_tool_button_zoom_area:"atala_tool_button_zoom_area",/** "Rotate Left" tooltip button */
atala_tool_button_rotate_left:"atala_tool_button_rotate_left",/** "Rotate Right" tooltip button */
atala_tool_button_rotate_right:"atala_tool_button_rotate_right",/** "Text selection" toolbar button */
atala_tool_button_text_tool:"atala_tool_button_text_tool",/** "Pan" toolbar button */
atala_tool_button_pan_tool:"atala_tool_button_pan_tool",/** "Draw Ellipse" annotation toolbar button */
atala_tool_button_ellipse_anno:"atala_tool_button_ellipse_anno",/** "Draw Highlight" annotation toolbar button */
atala_tool_button_highlight_anno:"atala_tool_button_highlight_anno",/** "Draw Line" annotation toolbar button */
atala_tool_button_line_anno:"atala_tool_button_line_anno",/** "Draw Poly Lines" annotation toolbar button */
atala_tool_button_lines_anno:"atala_tool_button_lines_anno",/** "Draw Freehand" annotation toolbar button */
atala_tool_button_freehand_anno:"atala_tool_button_freehand_anno",/** "Draw Polygon" annotation toolbar button */
atala_tool_button_polygon_anno:"atala_tool_button_polygon_anno",/** "Draw Rectangle" annotation toolbar button */
atala_tool_button_rect_anno:"atala_tool_button_rect_anno",/** "Filled Rectangle" annotation toolbar button */
atala_tool_button_fillrect_anno:"atala_tool_button_fillrect_anno",/** "Draw Text" annotation toolbar button */
atala_tool_button_text_anno:"atala_tool_button_text_anno",/** "Add a Stamp" annotation toolbar button */
atala_tool_button_stamp_anno:"atala_tool_button_stamp_anno",/** "Add a Sticky Note" annotation toolbar button */
atala_tool_button_note_anno:"atala_tool_button_note_anno",/** "Add a Comment" annotation toolbar button */
atala_tool_button_commment_anno:"atala_tool_button_commment_anno",/** Selection Rubberband div object */
atala_tool_selection_band:"atala_tool_selection_band",/** Selection Rubberband grip div object */
atala_tool_selection_grip:"atala_tool_selection_grip",/** Selection Rubberband mask div object */
atala_tool_selection_mask:"atala_tool_selection_mask",/** Selection Rubberband tooltip div object */
atala_tool_selection_tooltip:"atala_tool_selection_tooltip",/** Text search containing div object */
atala_search_container:"atala_search_container",/** Text search input box */
atala_search_input:"atala_search_input",/** Text search next match button */
atala_search_next:"atala_search_next",/** Text search previous match button */
atala_search_prev:"atala_search_prev"},Tn={/** Index of the page. applies to elements having .atala_page_div class */
atala_page_index:"atala_page_index"},Pn={/** Triggers before a request is sent to the server. Populated keys: e.request */
beforehandlerrequest:null,/** Triggers when the document info has changed, usually after a new document is opened. Populated keys: none */
documentinfochanged:null,/** Triggers when the document is done loading. Populated keys: none */
documentloaded:null,/** Triggers after a response from the server while saveing the document. Populated keys: e.success */
documentsaved:null,/** Triggers when the document has been unloaded from the control. Populated keys: none */
documentunloaded:null,/** Triggers when the control has encountered and error. Populated keys: e.name, e.message */
error:null,/** Triggers when the control has initialized. Populated keys: none */
initialized:null,/** Triggers when the page number has changed. Populated keys: e.number */
pagenumberchanged:null,/** Triggers when the control has recycled a pageDiv object. Populated keys: e.page */
pagerecycled:null,/** Triggers when the control has resized a pageDiv object. Populated keys: e.page, e.image, e.index */
pageresize:null,/** Triggers when the control has shown a page in the viewable area. Populated keys: e.page, e.index */
pageshown:null,/** Triggers when the page size returned from the server is different than expected. Populated keys: e.index, e.height, e.width */
pagesizechanged:null,/** Triggers for every pixel movement registered by the scrollable area. Populated keys: e.x, e.y, e.dx, e.dy */
scroll:null,/** Triggers when dependencies have finished loading. Populated keys: none */
scriptsloaded:null,/** Triggers when the control has updated the status bar. Populated keys: e.message */
statusmessage:null,/** Triggers when a zoom operation has been started. Populated keys: none */
zoomstarted:null,/** Triggers when the zoom level of the control has changed. Populated keys: e.zoom */
zoomchanged:null},An={/** Turns annotation support on or off. */
allowannotations:!1,/** Turns flick scrolling support on or off. */
allowflick:!0,/** Turns forms support on or off. */
allowforms:!1,/** Turns text selection support on or off. */
allowtext:!1,/** Annotations specific config options */
annotations:{/** Pre defined annotations to be drawn with the mouse. */
defaults:null,/** Pre defined stamp annotations to be drawn with the mouse. */
stamps:null,/** Pre defined image annotations to be drawn with the mouse. */
images:null,/** Indicates whether the server handler will save the username property when saving all annotations. */
saveusername:!1},/** Number of columns to show when displaying tabular pages, -1 is automatic. */
columns:-1,/** Parameter to change the scroll directopm of the viewer. */
direction:bn.Vertical,/** To specify a document (that is on the server) to be displayed when the document is first opened. */
documenturl:"",/** To specify annotation data (an .xmp file on the server) that should be displayed along with the displayed document. */
annotationsurl:"",/** To specify PDF form data (.pdf file on the server) that should be displayed along with the displayed document. */
formurl:"",/** Specifies the initial page fit when displayed in the viewer. */
fitting:wn.Width,/** Specifies whether all pages should be resized to fit into the bounds of the first page. */
forcepagefit:!1,/** Allows a custom page size to be used for force fitting all pages to. Ignored if forcepagefit is false. */
forcepagesize:{height:-1,width:-1},/** Allows image requests to be returned as jpeg instead of png. */
jpeg:!1,/** Specifies the maximum amount of pixel width allowed for zooming in. */
maxwidth:3e3,/** Maximum number of bytes in memory before larger memory objects are recycled. */
memorythreshold:5e8,/** Specifies the minimum amount of pixel width allowed for zooming out. */
minwidth:150,/** Specifies the pixel border width around each page in a document. */
pageborderwidth:1,/** The number of pages to keep in memory while scrolling. Negative values will automatically calculate the optimal number based on available screen space. Values lower than can be displayed will be ignored, and higher values will cause a degradation in performance. */
pagebuffersize:-1,/** Specifies the distance (in pixels) between pages displayed. */
pagespacing:4,/** Specifies the location to determine the current page number. */
pageselectlocation:rn.extend({},Atalasoft.Utils.PageSelection.TopLeft),/** [Required] Used to specify the jQuery object that the control will be created in. */
parent:null,/** deprecated. Number of rows to show when displaying tabular pages, -1 is automatic.
         * @deprecated tabular horizontal layout is not consistent with horizontal scrolling and will be removed. Use tabular layout with vertical scrolling and columns configuration.
         */
rows:-1,/** Specifies the file format for the document that will be used when saving multipaged document to the server. */
savefileformat:"",/** Specifies the path that the document, annotation data, and form data will be saved to on the server. */
savepath:"",/** Url location to the server where all JavaScript files are put when not in the default location. */
scripturl:"",/** [Required] Url location to the server handler. */
serverurl:"",/** If the toolbar is displayed, this can be used to hide or show the button text for the toolbar items. */
showbuttontext:!0,/** Specifies whether a black border will be added around each page in the displayed document. */
showpageborder:!0,/** Specifies whether a page number will be added to the bottom left of each page. */
showpagenumber:!0,/** Specifies whether error messages are allowed to show up in the console instead of being caught. */
showerrors:!1,/** Specifies whether status messages will be output to an area in the toolbar. */
showstatus:!1,/** Specifies whether scrollbars will be shown. */
showscrollbars:!0,/** Specifies whether rubberband selection tools are shown in the toolbar. */
showselecttools:!1,/** Specifies whether pages should be displayed in a tabular fashion, rather than one row or column. */
tabular:!1,/** [Experimental] Used to set the base DOM element size underneath each page. */
tilesize:-1,/** Specifies the jQuery object where the toolbar will be created. */
toolbarparent:null,/** Sets the initial zoom level of the dosument. Ignored when fitting is anything besides Fitting.None. */
zoom:1,/** Specifies whether captions will be added to the each thumbnail page. */
showthumbcaption:!1,/** Specifies default thumbnail caption format.
	     * 
	     * {0} - page number.
	     * {1} - file name.
	     * Could also be set using DocumentInfoRequestedEventArgs.
         */
thumbcaptionformat:"",/** Specifies whether to persist page rotation during document save. */
persistrotation:!0,/** Specifies whether page and annotation artifacts are shown. Annotation rotation could be explicitly enabled or disabled with annotation defaults.*/
showrotatetools:!0,/**Object or MouseToolType value. Specifies the mouse tools settings. Could be set to Atalasoft.Utils.MouseToolType if no advanced settings specified. */
mousetool:{/** Specifies the default mouse tool that are enabled after document loaded. */
type:xn.Pan,/** Specifies the default text selection settings*/
text:{/** Atalasoft.Utils.ScrollArea enum value, Specifies the percentage of type of scroll trigger area. When selecting text in that area around page bounds scrolling will be triggered for corresponding direction. */
scrolltriggerarea:Atalasoft.Utils.ScrollArea.Normal,/** Specifies scroll delta in pixels that are applied when selecting text within viewport scroll trigger area */
innerscrolldelta:10,/** Specifies scroll delta in pixels that are applied when selecting text and mouse goes out of viewport. */
outerscrolldelta:20,/** Specifies milliseconds throttling threshold for selection UI operations. 0 performs selection without throttling barrier, most CPU intensive. */
throttlingtreshold:40,/** Specifies the text selection highlight settings. */
selection:{/** Specifies the fill color. */
color:"blue",/** Specifies the selection transparency level. */
alpha:.25},/** Specifies the search results highlight settings. */
highlight:{/** Specifies the fill color. */
color:"yellow",/** Specifies the selection transparency level. */
alpha:.7},/** Specifies whether to hook up ctrl+c keystroke. */
hookcopy:!1,/** Specifies whether to show default search UI. */
allowsearch:!0,/** Specifies whether default text search is wrapped. */
wrapsearch:!0,/** Specifies the milliseconds timeout before triggering text search. 
                 * This allows to delay potentially long running search until user still typing query text.
                 */
searchdelay:400}}};if(e){var Vn=e.mousetool;e.mousetool&&"object"!=typeof e.mousetool&&(e.mousetool=rn.extend({},An.mousetool,{type:Vn})),rn.extend(!0,An,e),e.mousetool=Vn}he(),i(),/** WARNING: Changing values from these references can cause instability.*/
sn.config=An,/** WARNING: Changing values from these references can cause instability.*/
sn.events=Pn,/** WARNING: Changing values from these references can cause instability.*/
sn.domclasses=Dn,/** WARNING: Changing values from these references can cause instability.*/
sn.domattributes=Tn;var Hn={height:0,isEmpty:function(){return 0===this.width&&0===this.height},width:0,zero:function(){this.width=0,this.height=0},zoom:1};/**
	* [Internal] Gets debug info object
	* @returns debug info object if available, otherwise null
	*/
return sn.__getDebugInfo=Ro,/**
	* [Internal] Gets the viewer linkage for controls that inherit this one
	* @param viewer object of type WebDocumentViewer
	* @param linker internal object of type __LVlinker
	* @returns linker object if possible, otherwise undefined
	*/
sn.__getViewerLink=jo,sn.dispose=r,sn.empty=qo,sn.fit=co,sn.getZoom=No,sn.isReady=Wo,sn.scrollTo=Qo,sn.scrollBy=Zo,sn.next=Go,sn.previous=Xo,sn.zoom=oo,sn.zoomIn=$o,sn.zoomOut=Ko,sn.openUrl=sn.OpenUrl=Jo,sn.save=Yo,sn.getCurrentPageIndex=tn,sn.bind=on,sn.unbind=nn,sn.trigger=an,sn.getDocumentInfo=ln,sn.setMouseTool=en,sn.showPage=He,sn.showPageNumber=Ce,Atalasoft.Annotations.AnnotationController(),Atalasoft.Document.ManipulationController(),Atalasoft.Forms.FormController(),Atalasoft.Text.TextController(),sn.annotations=Atalasoft.Annotations.AnnotationController.__exposedApi,sn.document=Atalasoft.Document.ManipulationController.__exposedApi,sn.forms=Atalasoft.Forms.FormController.__exposedApi,sn.text=Atalasoft.Text.TextController.__exposedApi,n(),sn}}();
Atalasoft.Document.ManipulationController=function(e,n){function t(){$.bind({pagerecycled:P,pageshown:_,documentinfochanged:a}),q._state.initialized?i():$.bind({initialized:i})}function i(){E=!0}function a(){G.info=$.getDocumentInfo(),G.mapping=null,G.changes.length=0,G.count=0,G.inserted=0,G.length=0}function o(){W=null,$=null,q=null,G.changes.length=0,G.mapping=null,G.info=null}function r(){"Atalasoft.Controls.WebDocumentViewer"===$.typeOf&&U.extend($,B)}function g(e,n){$.trigger({type:"throwerror",name:e,msg:n})}function p(){null==G.mapping&&l()}function u(e,n){p(),G.mapping[e]&&(G.mapping[e].viewestate[n]||(G.mapping[e].viewestate[n]={size:null,fitmultiplier:null}))}function l(){var e=$.getDocumentInfo(),n=Math.max(e.count,0);G.mapping=new Array(n);for(var t=0;n>t;++t)G.mapping[t]=c(t)}function c(e){return{index:e,viewestate:{},pageref:null,angle:0,text:null}}function s(e){return p(),e>=0&&e<G.mapping.length?null!=G.mapping[e].pageref?G.mapping[e].pageref:G.mapping[e].index:null}function f(e,n){return p(),u(e,n),e>=0&&e<G.mapping.length&&G.mapping[e].viewestate[n].fitmultiplier?G.mapping[e].viewestate[n].fitmultiplier:1}function m(e,n,t){p(),u(e,t),e>=0&&e<G.mapping.length&&(G.mapping[e].viewestate[t].fitmultiplier=n)}/**
     * Gets the rotation angle of the specified page.
     * @param index: number, zero based index of the page to retreive rotation
     * @returns page rotation angle.
     */
function d(e){return p(),e>=0&&e<G.mapping.length?G.mapping[e].angle:0}function h(e,n){p(),e>=0&&e<G.mapping.length&&(G.mapping[e].angle=n)}function v(e,n,t){var i=n;e&&(i.pageref={uri:e,index:n.index,mapsto:G.info.count+G.inserted}),G.count++,G.inserted++,G.mapping.splice(t,0,i)}function x(e){return e>=G.mapping.length?-1:(G.count--,G.mapping.splice(e,1)[0])}function y(e,n){v(null,x(e),n)}function _(){}function P(){}/**
   * Returns the page reference object or page index. This can be passed as a 'srcindex' parameter into document.insertPage method.
   * @param index: number, zero based source index to get the page rreference from.
   */
function w(e){var n=s(e);if(n&&"object"==typeof n){var t={uri:n.uri,index:n.index};return t}return n}/**
    * Inserts a page at the destination index from the given source uri and index.
    * @param srcuri: string, source uri of the document
    * @param srcindex: number, zero based source index to get the page from
    * @param destindex: number, zero based destination index to insert the page
    * @param callback: function to execute when the operation has completed
    */
function D(e,n,t,i){if(null===n||void 0===n)return g("Source page index cannot be "+n),void 0;"object"==typeof n&&(e=n.uri,n=n.index);var a=c(n);t=T(t),v(e,a,t),q._controllers.annotations&&q._controllers.annotations.insertLayer(null,null,t),q._controllers.forms&&q._controllers.forms.insertForm(null,null,t),G.changes.push({type:"insertpage",uri:e,src:a.index,dest:t}),"function"==typeof i&&i(),$.trigger({type:H.inserted,srcuri:e,srcindex:n,destindex:t}),$.trigger(H.changed)}/**
	* Removes the page at the given index.
	* @param index: number, zero based index of the page to remove
	* @param callback: function to execute when the operation has completed
	*/
function z(e,n){e=V(e),x(e),q._controllers.annotations&&q._controllers.annotations.removeLayer(e),q._controllers.forms&&q._controllers.forms.removeForm(e),G.changes.push({type:"removepage",index:e}),"function"==typeof n&&n(),$.trigger({type:H.removed,index:e}),$.trigger(H.changed)}/**
	* Moves a page from the source index to the destination index.
	* @param srcindex: number, zero based source index to get the page from
	* @param destindex: number, zero based destination index to insert the page
	* @param callback: function to execute when the operation has completed
	*/
function b(e,n,t){e=V(e),n=T(n),y(e,n),q._controllers.annotations&&q._controllers.annotations.moveLayer(e,n),q._controllers.forms&&q._controllers.forms.moveForm(e,n),G.changes.push({type:"movepage",src:e,dest:n}),"function"==typeof t&&t(),$.trigger({type:H.moved,srcindex:e,destindex:n}),$.trigger(H.changed)}/**
     * Rotates the specified angle page.
     * @param index: number, zero based index of the page to rotate
     * @param angle: number, clockwise rotation angle in degrees
     * @param callback: function to execute when the operation has completed
     */
function A(e,n,t){p(),e=V(e);var i=I(e,n,t);i&&(G.changes.push({type:"rotatepage",index:e,angle:n}),$.trigger({type:H.rotated,index:e,page:i,angle:n}))}function I(e,n,t){if(0>e)return!1;if(e>=G.mapping.length)return!1;n=(n-n%90)%360,h(e,n);for(var i=null,a=0;a<q._pages.length;++a){var o=q._pages[a];if(o._index===e){i=o;break}}var r=!!i&&!!i._img;return r?(q.startDomManipulation(),t="function"==typeof t?Atalasoft.Utils.__functionFromArray([q.endDomManipulation,t]):q.endDomManipulation,q.adjustVisiblePages(!0,t)):"function"==typeof t&&t(),i}function M(e,n){p(),e>=0&&e<G.mapping.length&&(G.mapping[e].text=n)}function C(e){return e>=0&&e<G.mapping.length?G.mapping[e].text:null}function F(e){if(e&&e.pages){p();for(var n=0;n<G.mapping.length;++n)if(n<e.pages.length)if(G.mapping[n].index===n)G.mapping[n].text=e.pages[n];else for(var t=0;t<G.mapping.length;++t)G.mapping[t].index===n&&(G.mapping[t].text=e.pages[n]);else G.mapping[n].text=null}}function k(){var e={};return U.extend(!0,e,{data:G,changes:G.changes}),e}function S(e){e&&(null===e._changes?e._changes=G:G=e._changes)}function O(e){G.clear(),"function"==typeof e&&e(),$.trigger(H.changed)}function R(){return G.info.count+G.count}function j(e,n){if(p(),u(e,n),e>=0&&e<G.mapping.length){var t=G.mapping[e].viewestate[n].size;if(!t){var i=$.getDocumentInfo();if(i.pagesizes&&i.pagesizes[e])return i.pagesizes[e]}return t}}function L(e,n,t){p(),u(e,t),e>=0&&e<G.mapping.length&&(G.mapping[e].viewestate[t].size=n)}function T(e){return J(e,G.mapping.length+1)}function V(e){return J(e,G.mapping.length)}function J(e,n){if(0>e){var t=parseInt(e,10)+n;0>t&&g("Page index "+e+" is outside the document."),e=t}return e>=n&&g("Page index "+e+" is outside the document."),e}function N(){var e=[],n={type:"docinfo",pagescount:G.info.count};e.push(n);for(var t in G.changes)if(G.changes.hasOwnProperty(t)&&($.config.persistrotation||"rotatepage"!==G.changes[t].type)){var i={};for(var a in G.changes[t])G.changes[t].hasOwnProperty(a)&&(i[a]=G.changes[t][a]);e.push(i)}return JSON.stringify({changes:e})}var U=Atalasoft.$,W=this,$=e,q=n,B={document:{events:{/** Triggers when a page is added to the document. Populated keys: e.srcuri, e.srcindex, e.index */
pageinserted:null,/** Triggers when a page is removed from the document. Populated keys: e.index */
pageremoved:null,/** Triggers when a page is moved within the same document. Populated keys: e.srcindex, e.destindex */
pagemoved:null,/** Triggers when the document is changed. Populated keys: none */
documentchanged:null,/** Triggers when a page is rotated. 
                * Populated keys: 
                * e.index : index of the rotated page, 
                * e.angle : clockwise rotation angle
                */
pagerotated:null},insertPage:D,removePage:z,movePage:b,rotatePage:A,getPageRotation:d,getPageReference:w}};if(Atalasoft.Document.ManipulationController.__exposedApi=B.document,!e)return null;var E=!1,G={changes:[],mapping:null,count:0,inserted:0,info:{count:0,dpi:96,size:{width:0,height:0}}},H={inserted:"pageinserted",removed:"pageremoved",moved:"pagemoved",changed:"documentchanged",rotated:"pagerotated"};W.dispose=o,W.getPageReference=s,W.insertPage=D,W.removePage=z,W.movePage=b,W.rotatePage=A,W.getPageFitMultiplier=f,W.setPageFitMultiplier=m,W.getPageRotation=d,W.getPageSize=j,W.setPageSize=L,W.updatePageText=M,W.getPageText=C,W.initDocumentText=F,W.__getDebugInfo=k,W.__linkChanges=S,W.clear=O,W.getPageCount=R,W.checkDestIndex=T,W.checkSrcIndex=V,W.checkIndex=J,W.stringifyChanges=N,r(),t()};
Atalasoft.Document.MemoryTracker=function(e){function t(){f()}function n(){return U.bytesInUse}function r(e){k.colorDepth=e}function i(){return k.colorDepth}function o(e){k.highWaterMark=e}function s(){return k.highWaterMark}function a(e,t){k.pageSize.width=e,k.pageSize.height=t}function u(){return k.pageSize}function h(){return d.bind.apply(d,arguments),b}function c(){return d.unbind.apply(d,arguments),b}function g(){return d.trigger.apply(d,arguments),b}function p(e){return I.memoryEntries.push(e),U.bytesInUse+=m(e),U.bytesInUse>k.highWaterMark&&g("exceededhighwatermark"),U.bytesInUse}function y(){var e=I.memoryEntries.shift();return l(e),e}function f(){I.memoryEntries.length=0,U.bytesInUse=0}function m(e){var t=e.width()||k.pageSize.width,n=e.height()||k.pageSize.height,r=t*n*k.colorDepth/8*k.compression;return r}function l(e){return U.bytesInUse-=m(e),U.bytesInUse<0&&(U.bytesInUse=0),U.bytesInUse}var b={typeOf:"Atalasoft.Document.MemoryTracker"},d=$({}),I={memoryEntries:[]},U={bytesInUse:0},k={colorDepth:8,compression:1,highWaterMark:5e8,pageSize:{width:800,height:1132}};return e&&$.extend(k,e),b.dispose=t,b.getBytesInUse=n,b.setColorDepth=r,b.getColorDepth=i,b.setHighWatermark=o,b.getHighWatermark=s,b.setPageSize=a,b.getPageSize=u,b.bind=h,b.unbind=c,b.trigger=g,b.allocate=p,b.deallocateOldestEntry=y,b.clearEntries=f,b};
Atalasoft.Controls.ToolController=function(t,e,o,n,l){function r(){R=new Atalasoft.Controls.PointerTool,Q.bind(R.events.viewport),R.events.wdv&&V.bind(R.events.wdv),R.bind({clickzoom:h,fit:m,panstart:y,panmove:T,panend:E,zoomstart:D,zoommove:_,zoomend:z,selectstart:b,selectmove:w,selectend:A,zoomareastart:b,zoomareamove:w,zoomareaend:A,textselectstart:k,textselectmove:C,textselectend:L,textselectscroll:M,textselectcopy:S})}function a(){R&&R.events&&(R.events.wdv&&V&&V.unbind&&V.unbind(R.events.wdv),R.events.viewport&&Q&&Q.unbind&&Q.unbind(R.events.viewport)),le&&le.length>0&&(le.length=0),R&&R.dispose&&R.dispose(),J=null,G=null,$=null,Q=null,V=null,F=null}function s(){return q.bind.apply(q,arguments),F}function i(){return q.unbind.apply(q,arguments),F}function c(){return q.trigger.apply(q,arguments),F}function u(t,e){switch(Atalasoft.Utils.Browser.Explorer8&&(t=t!==Atalasoft.Utils.MouseToolType.Text?t:Atalasoft.Utils.MouseToolType.Arrow,e=e!==Atalasoft.Utils.MouseToolType.Text?e:Atalasoft.Utils.MouseToolType.Arrow),R.setTool(t,e),N(t,e),t){case G.None:p(J.Arrow);break;case G.Pan:p(J.Move);break;case G.ZoomIn:p(J.ZoomIn);break;case G.ZoomOut:p(J.ZoomOut);break;case G.Selection:j.raiseDrawLayer(),se=1,p(J.Crosshair);break;case G.ZoomArea:j.raiseDrawLayer(),se=1,p(J.Crosshair);break;case G.Text:j.raiseDrawLayer(),p(J.Text);break;default:p(J.Arrow)}}function v(){var t={};return Y.extend(!0,t,{cursor:oe,custom:ne,flick:le,resourcepath:ee,flickdelay:re,scroller:$,tool:R,toolcusors:J,tooltypes:G,viewport:Q,zoom:te}),t}function f(){return R.getTool()}function d(){return R.pauseTool()}function g(){return R.resumeTool()}function p(t){var e=""===ee?"?atalacsr=":ee;oe="%2"===t?oe=ne:t.replace("%1",e),Q.css({cursor:oe})}function x(t){ne=t}function m(t){V.fit(t.fit)}function h(t){t.zoomout?V.zoomOut():V.zoomIn()}function y(t){$.data("ox",$.scrollLeft()+t.x).data("oy",$.scrollTop()+t.y),$.stop()}function T(t){$.scrollLeft($.data("ox")-t.x),$.scrollTop($.data("oy")-t.y),ce.allowflick&&(le.push({x:t.x,y:t.y,time:(new Date).getTime()}),le.length>10&&le.shift())}function E(){if(ce.allowflick){if(le.length>1){var t=(new Date).getTime(),e=le.pop();if(t-e.time<100){var o=le.shift(),n=-o.time+e.time;$.animate({scrollLeft:$.scrollLeft()+Math.round((o.x-e.x)/n*250),scrollTop:$.scrollTop()+Math.round((o.y-e.y)/n*250)},re,"easeOutQuad")}}le.length=0}}function b(t){ae=j.getActivePage(),ae&&ae._rubberband.startSelect(t)}function w(t){ae=j.getActivePage(),ae&&ae._rubberband.moveSelect(t)}function A(t){ae=j.getActivePage(),ae&&(ae._rubberband.endSelect(t),"zoomareaend"===t.type&&(ae._rubberband.hide(),ae._rubberband.zoomToSelection())),se--,0===se&&(se=-1,j.resetDrawLayer(),u(W,H))}function D(){j.zoomStart(),te=V.getZoom()}function _(t){var e=te*t.scale;j.zoom(e)}function z(){j.zoomEnd()}function k(t){var e=X(t);if(e){if(e.cursor=oe,e.complete=!1,e.rectangular=t.toolEvent?t.toolEvent.altKey:!1,e.interval=t.toolEvent?t.toolEvent.shiftKey:!1,!e.rectangular&&!e.interval){var o=t.toolEvent&&t.toolEvent.originalEvent&&t.toolEvent.originalEvent.detail?t.toolEvent.originalEvent.detail%3:1;1!==o&&(e.word=2===o,e.line=0===o)}c({type:ue.textselectstart,eventData:e}),t.eventData.handled=e.handled,e.complete&&e.handled&&(L(t),t.eventData.complete=!0)}}function C(t){U();var e=X(t);if(e){e.cursor=oe,e.selecting=t.eventData.selecting,c({type:ue.textselectmove,eventData:e}),t.eventData.handled=e.handled;var o=e.handled&&e.cursor?e.cursor:J.Arrow;o!==oe&&p(o),t.eventData.handled&&t.eventData.selecting&&t.toolEvent&&t.toolEvent.target&&P(t)}}function L(t){U();var e=X(t);e&&(c({type:ue.textselectend,eventData:e}),t.eventData.handled=e.handled)}function M(t){U(),P(t)}function S(){ce.text.hookcopy&&c({type:ue.textselectcopy})}function U(){ie&&(clearTimeout(ie),ie=null)}function P(t){if(U(),t&&t.toolEvent){var e=B.offset(),o=null;if(void 0!==t.toolEvent.pageX&&void 0!==t.toolEvent.pageY?o=t.toolEvent:t.toolEvent.originalEvent&&t.toolEvent.originalEvent.touches&&1===t.toolEvent.originalEvent.touches.length&&void 0!==t.toolEvent.originalEvent.touches[0].pageX&&void 0!==t.toolEvent.originalEvent.touches[0].pageY&&(o=t.toolEvent.originalEvent.touches[0]),o){var n={x:o.pageX-e.left,y:o.pageY-e.top},l=B.width(),r=B.height(),a=0,s=0;n.y<r*ce.text.scrolltriggerarea&&$.scrollTop()>0?a=n.y>0?-ce.text.innerscrolldelta:-ce.text.outerscrolldelta:n.y>r*(1-ce.text.scrolltriggerarea)?a=n.y<r?ce.text.innerscrolldelta:ce.text.outerscrolldelta:n.x<l*ce.text.scrolltriggerarea&&$.scrollLeft()>0?s=n.x>0?-ce.text.innerscrolldelta:-ce.text.outerscrolldelta:n.x>l*(1-ce.text.scrolltriggerarea)&&(s=n.x<l?ce.text.innerscrolldelta:ce.text.outerscrolldelta),(a||s)&&ce.text.scrolltriggerarea!==Atalasoft.Utils.ScrollArea.None&&($.scrollTop($.scrollTop()+a),$.scrollLeft($.scrollLeft()+s),ie=setTimeout(P,K,t))}}}function Z(t){var e=Y(t).parents("."+V.domclasses.atala_page_div).first();if(e){var o=e.attr(V.domattributes.atala_page_index);return parseInt(o,10)}return null}function I(t,e){var o=Atalasoft.Utils.getMousePositionJquery(t.toolEvent?t.toolEvent:t);if(e&&e._paper){var n=Atalasoft.Utils.getSVGOffset(e._paper.canvas,e);o.x-=n.left,o.y-=n.top}return o}function O(t,e){var o=0;if(j._controllers.text){var n=j._controllers.document.getPageText(e);n&&isFinite(n.rotation)&&(o=n.rotation)}var l=j.getViewerTransform(e,o).invert();return{x:l.x(t.x,t.y),y:l.y(t.x,t.y)}}function N(t,e){var o=(W===G.Text||H===G.Text)&&t!==G.Text&&e!==G.Text;o&&j.resetDrawLayer(),t!==G.Selection&&t!==G.ZoomArea&&(W=t),e!==G.Selection&&e!==G.ZoomArea&&(H=e)}function X(t){var e={cursor:null,handled:!1};if(t&&t.toolEvent){var o=t.toolEvent.originalEvent.touches&&1===t.toolEvent.originalEvent.touches.length,n=o?document.elementFromPoint(t.toolEvent.originalEvent.touches[0].clientX,t.toolEvent.originalEvent.touches[0].clientY):t.toolEvent.target,l=Z(n);if(isFinite(l)&&l>=0){var r=I(t),a=O(r,l);Atalasoft.$.extend(e,{page:l,point:a,viewerPoint:r})}}return e}if(!o||!n)return Atalasoft.Event.Throw("Atalasoft.Controls.ToolController",0,null,"ToolController requires a WDV and two jQuery objects passed in as input, one for mouse events, the other for scrolling."),!1;var Y=Atalasoft.$,F=this,V=t,j=e,q=(e?e._internalEvents:null)||Y({}),K=50,Q=o,$=n,B=Q.parents("."+V.domclasses.atala_main_container).first(),G=Atalasoft.Utils.MouseToolType,J=Atalasoft.Utils.MouseToolCursor,W=G.Pan,H=G.None,R=null,te=1,ee="",oe=null,ne="",le=[],re=1e3,ae=null,se=-1,ie=null,ce={allowflick:!0,text:{scrolltriggerarea:Atalasoft.Utils.ScrollArea.Normal,innerscrolldelta:10,outerscrolldelta:20}};/**
     * Internal events for conditional input handling.
     */
F.events=ue;var ue={textselectstart:"textselectstart",textselectmove:"textselectmove",textselectend:"textselectend",textselectcopy:"textselectcopy"};l&&(Y.extend(ce,l),ce.text.scrolltriggerarea=Math.max(0,Math.min(ce.text.scrolltriggerarea,.3))),r(),F.dispose=a,F.bind=s,F.unbind=i,F.trigger=c,F.setTool=u,F.__getDebugInfo=v,F.getTool=f,F.pauseTool=d,F.resumeTool=g,F.setCursor=p,F.setCustomCursor=x};
Atalasoft.Controls.PointerTool=function(){function t(){N(),ln.events={viewport:{click:Y,dblclick:D,mousedown:S,mousemove:C,mouseout:I,mouseover:O,mouseup:q,contextmenu:Z,mousewheel:B,keydown:M}},Atalasoft.Utils.Browser.Features.Touch&&un.extend(!0,ln.events,{viewport:{touchstart:V,touchmove:W,touchend:tn},wdv:{annotationdrawstart:c,annotationdrawend:s,annotationdragstart:c,annotationdragend:s}})}function n(){sn&&(sn=null),pn&&(pn=null),ln=null}function e(){return cn.bind.apply(cn,arguments),ln}function o(){return cn.unbind.apply(cn,arguments),ln}function i(){return cn.trigger.apply(cn,arguments),ln}function a(t,n){switch(vn=t,gn=n,N(),vn){case fn.None:J=Atalasoft.Utils.__rf;break;case fn.Pan:j=m;break;case fn.ZoomIn:J=L;break;case fn.ZoomOut:J=Q;break;case fn.Selection:j=A;break;case fn.ZoomArea:j=A;break;case fn.PassThrough:break;case fn.Text:j=y,F=x,H=E}switch(gn){case fn.None:break;case fn.Pan:G=m;break;case fn.ZoomIn:K=L;break;case fn.ZoomOut:K=Q;break;case fn.Selection:G=A;break;case fn.ZoomArea:G=A;break;case fn.PassThrough:}}function r(){return{primary:vn,secondary:gn}}function u(){sn.prpt++}function l(){sn.prpt>0&&sn.prpt--}function c(){sn&&(sn.drawing=!0)}function s(){sn&&(sn.drawing=!1)}function p(t){if(!sn.prpt){t.stopPropagation(),sn.pinching=!0;var n=t.originalEvent.touches[0],e=t.originalEvent.touches[1];pn={start:Atalasoft.Utils.CalcDistance(n.clientX,n.clientY,e.clientX,e.clientY)},i({type:"zoomstart",touches:t.originalEvent.touches})}}function f(t){if(!sn.prpt&&(t.stopPropagation(),!sn.zooming)){sn.zooming=!0;var n=t.originalEvent.touches[0],e=t.originalEvent.touches[1],o=Atalasoft.Utils.CalcDistance(n.clientX,n.clientY,e.clientX,e.clientY,pn.start),a=o.x/pn.start.x,r=o.y/pn.start.y;setTimeout(v,40),i({type:"zoommove",touches:t.originalEvent.touches,scale:a,scalex:a,scaley:r,dx:o.dx,dy:o.dy})}}function v(){sn.zooming=!1}function g(t){sn.prpt||(t.stopPropagation(),sn.pinching=!1,i({type:"zoomend",touches:t.originalEvent.touches}),1===t.originalEvent.touches.length&&V(t))}function m(t){return sn.prmt?void 0:(i({type:"panstart",x:t.clientX,y:t.clientY}),un(document).bind({mousemove:d,mouseup:h,ondrag:Atalasoft.Utils.__rf}),!1)}function d(t){return t=null==t?event:t,sn.prpt?void 0:0===t.which?(h(),void 0):(i({type:"panmove",x:t.clientX,y:t.clientY}),!1)}function h(){return sn.prpt?void 0:(un(document).unbind({mousemove:d,mouseup:h,ondrag:Atalasoft.Utils.__rf}),i({type:"panend"}),!1)}function y(t){if(sn.prmt)return!1;t.stopPropagation();var n={handled:!1,complete:!1};return i({type:"textselectstart",toolEvent:t,eventData:n}),n.complete||(sn.textselection=!0,un(document).bind({mouseup:_,mousemove:b,ondrag:Atalasoft.Utils.__rf})),!1}function x(t){if(sn.prmt)return!0;if(!(0!==t.which||t.originalEvent.touches&&t.originalEvent.touches.length))return _(),!0;var n={handled:!1,selecting:sn.textselection};return i({type:"textselectmove",toolEvent:t,eventData:n}),!1}function _(t){if(sn.prmt||!sn.textselection)return!1;sn.textselection=!1,un(document).unbind({mouseup:_,mousemove:b,ondrag:Atalasoft.Utils.__rf});var n={handled:!1};return i({type:"textselectend",toolEvent:t,eventData:n}),!1}function b(t){return sn.textselection?sn.prmt?!0:0!==t.which||t.originalEvent.touches&&t.originalEvent.touches.length?(i({type:"textselectscroll",toolEvent:t}),!1):(_(),!0):void 0}function E(t){67===t.keyCode&&t.ctrlKey&&i({type:"textselectcopy",toolEvent:t})}function A(t){return sn.prmt?!0:(i({type:vn===fn.Selection?"selectstart":"zoomareastart",x:t.clientX,y:t.clientY,toolEvent:t}),mn=un(t.target),mn._binds={mousemove:w,mouseup:U,ondrag:Atalasoft.Utils.__rf},mn.bind(mn._binds),!1)}function w(t){return t=null==t?event:t,sn.prpt?!0:0===t.which?(U(),void 0):(i({type:vn===fn.Selection?"selectmove":"zoomareamove",x:t.clientX,y:t.clientY,toolEvent:t}),!1)}function U(t){return sn.prpt?void 0:(mn.unbind(mn._binds),mn=null,i({type:vn===fn.Selection?"selectend":"zoomareaend",toolEvent:t}),!1)}function k(t){vn===fn.Pan&&(t.type="panstart",i(t))}function T(t){vn===fn.Pan&&(t.type="panmove",i(t))}function P(t){vn===fn.Pan&&(t.type="panend",i(t))}function z(t){t.type="contextmenu",i(t)}function X(t){t.type="fit",i(t)}function Y(t){return t=null==t?event:t,J(t)}function D(t){t=null==t?event:t}function Z(t){return t=null==t?event:t,K(t)}function S(t){return t=null==t?event:t,2===t.button?G(t):j(t),$(t)}function C(t){return t=null==t?event:t,F(t)}function M(t){return t=null==t?event:t,H(t)}function N(){J=vn===fn.PassThrough?Atalasoft.Utils.__ef:Atalasoft.Utils.__rf,K=gn===fn.PassThrough?Atalasoft.Utils.__ef:Atalasoft.Utils.__rf,$=Atalasoft.Utils.__ef,j=Atalasoft.Utils.__ef,G=Atalasoft.Utils.__ef,F=Atalasoft.Utils.__ef,H=Atalasoft.Utils.__ef}function I(){}function O(){}function q(){}function B(){}function F(){}function J(){}function K(){}function $(){}function j(){}function G(){}function H(){}function L(t){return sn.prpt?void 0:(R(t,!1),!1)}function Q(t){return sn.prpt?void 0:(R(t,!0),!1)}function R(t,n){return sn.prpt?void 0:(i({type:"clickzoom",x:t.clientX,y:t.clientY,zoomout:n}),!1)}function V(t){sn.prpt||sn.drawing||sn.pinching||un(t.target).is(".ui-menu,.ui-menu-item,.ui-corner-all")||(t.preventDefault(),sn.e=t,2===t.originalEvent.touches.length&&rn(t.originalEvent.touches)?(an(),sn.touching=!1,p(t)):vn===fn.Text?y(t):1===t.originalEvent.touches.length&&(sn.touching=!0,sn.point.x=t.originalEvent.touches[0].pageX,sn.point.y=t.originalEvent.touches[0].pageY,sn.hold=setTimeout(on,1500),k({x:sn.point.x,y:sn.point.y})))}function W(t){if(!sn.prpt&&!sn.drawing)if(t.preventDefault(),sn.e=t,sn.pinching)f(t);else if(sn.touching){var n=t.originalEvent.touches[0];sn.moves++,sn.touching=!0,T({x:n.pageX,y:n.pageY})}else sn.textselection&&x(t)}function tn(t){sn.prpt||sn.drawing||(t.preventDefault(),sn.pinching?g(t):sn.textselection?_(t):(sn.touching=!1,an(),sn.moves>0?(sn.moves=0,P({})):sn.tapped?en(t):(sn.tapped=!0,setTimeout(nn,300))))}function nn(){sn.tapped=!1}function en(t){X(t)}function on(){if(sn.moves>0&&null!=sn.e){var t=Atalasoft.Utils.getMousePositionJquery(sn.e);Math.abs(sn.point.x-t.x)<5&&Math.abs(sn.point.y-t.y)<5&&(sn.moves=0)}0===sn.moves&&sn.touching&&z({x:sn.point.x,y:sn.point.y})}function an(){null!=sn.hold&&(clearTimeout(sn.hold),sn.hold=null)}function rn(t){for(var n=null,e=0;e<t.length;e++){var o=t[e].target;if(o)if(null==n)n=o;else if(n!==o)return!1}return!0}var un=Atalasoft.$,ln=this,cn=un({}),sn={tapped:!1,touching:!1,pinching:!1,zooming:!1,textselection:!1,origin:{x:0,y:0},point:{x:0,y:0},delta:{x:0,y:0},drawing:!1,moves:0,prpt:0},pn=null,fn=Atalasoft.Utils.MouseToolType,vn=fn.None,gn=fn.None,mn=null;return t(),ln.dispose=n,ln.bind=e,ln.unbind=o,ln.trigger=i,ln.setTool=a,ln.getTool=r,ln.pauseTool=u,ln.resumeTool=l,ln};
Atalasoft.Controls.RubberBandTool=function(t,e,o,i){function n(){e&&ne.extend(!0,ue,e),le.rect=l(),le.rectback=l(),le.mask.top=d(),le.mask.bottom=d(),le.mask.left=d(),le.mask.right=d(),ie=u("div"),ie.addClass(he.domclasses.atala_tool_selection_tooltip),ie.hide(),ie.css({fontFamily:"Arial, helvetica, san-serif",fontSize:"8pt",padding:"1px",backgroundColor:"#FFFFE1",border:"1px solid #000000",position:"absolute",zIndex:999}),ge.append(le.rectback),ge.append(le.rect),ge.append(ie),ge.append(le.mask.top),ge.append(le.mask.bottom),ge.append(le.mask.left),ge.append(le.mask.right),oe=new h,I(),ue.visible?E():D(),ge.bind({pageresize:r,pagezoom:a})}function s(){null!=oe&&(oe.dispose(),oe=null),re=null,le.rect=null,le.rectback=null,ie=null,le.mask.top=null,le.mask.bottom=null,le.mask.left=null,le.mask.right=null}function r(){te(),V()}function a(){te(),V()}function h(){function t(){for(var t=0;9>t;t++)l[t].dispose(),l[t]=null;u=null,l=null,d=null,c=null}function e(t,e,o,i){g=o,m=i,l[0].setPos(t,e),l[1].setPos(t-4,e-4),l[3].setPos(t+o-4,e-4),l[6].setPos(t-4,e+i-4),l[8].setPos(t+o-4,e+i-4),l[0].setSize(o,i),ue.showgrips?(l[2].setPos(t+Math.round(o/2)-4,e-4),l[4].setPos(t-4,e+Math.round(i/2)-4),l[5].setPos(t+o-4,e+Math.round(i/2)-4),l[7].setPos(t+Math.round(o/2)-4,e+i-4)):(l[2].setPos(t+4,e-4),l[4].setPos(t-4,e+4),l[5].setPos(t+o-4,e+4),l[7].setPos(t+4,e+i-4),l[2].setSize(o-8,8),l[4].setSize(8,i-8),l[5].setSize(8,i-8),l[7].setSize(o-8,8)),r()}function o(){for(var t=0;9>t;t++)l[t].resetColors()}function i(){for(var t=0;9>t;t++)l[t].resetGripSize(),l[t].resetColors()}function n(){for(var t=0;9>t;t++)l[t].hide()}function s(){for(var t=0;9>t;t++)c[t]===!0?l[t].show():l[t].hide()}function r(){for(var t=0;9>t;t++)c[t]=!0;c[0]=!0,8>g&&8>m&&(c[1]=!1),(12>g||12>m)&&(c[3]=!1,c[6]=!1),(16>g||8>m)&&(c[2]=!1,c[7]=!1),(16>m||8>g)&&(c[4]=!1,c[5]=!1),s()}function a(){x()===!0?(l[0].grip.onmousedown=W,l[0].grip.style.cursor="move"):(l[0].grip.onmousedown=Atalasoft.Utils.__rf,l[0].grip.style.cursor="default");for(var t=1;9>t;t++)v()===!0?(l[t].bind({mousedown:l[t].onResize}),l[t].grip.style.cursor=u[t]+"-resize"):(l[t].unbind({mousedown:l[t].onResize}),l[t].grip.style.cursor="default")}function h(t){function e(){x=null,c=null,g=null,w=null}function o(){return m.bind.apply(m,arguments),m}function i(){return m.unbind.apply(m,arguments),m}function n(t,e){g.left=t+"px",g.top=e+"px"}function s(t,e){z()===!0&&"move"!==w&&(t-=2,e-=2),0>=t&&(t=1),0>=e&&(e=1),g.width=t+"px",g.height=e+"px"}function r(){y&&(g.visibility="hidden",y=!1)}function a(){y||(g.visibility="visible",y=!0)}function h(){"move"!==w&&(ue.showgrips===!0?b()===!0?(g.backgroundColor="#"+p(),g.border="1px solid #"+f()):(g.backgroundColor="#"+f(),g.border="1px solid #"+f()):(g.backgroundColor="",g.border=""))}function l(){ue.showgrips===!0?(g.width="6px",g.height="6px"):(g.width="8px",g.height="8px")}function d(t){return H(t,w)}var c,g,m,x=this,w=u[t],y=!1;c=document.createElement("div"),g=c.style,m=ne(c),m.addClass(he.domclasses.atala_tool_selection_grip),h(),l(),x.grip=c,x.dispose=e,x.setPos=n,x.setSize=s,x.hide=r,x.show=a,x.resetColors=h,x.resetGripSize=l,x.onResize=d,x.bind=o,x.unbind=i,g.display="block",g.position="absolute",g.visibility="hidden",g.zIndex=se,c.onclick=Atalasoft.Utils.__rf,c.onselectstart=Atalasoft.Utils.__rf,c.onselect=Atalasoft.Utils.__rf,c.oncontextmenu=Atalasoft.Utils.__rf}for(var u=new Array("move","nw","n","ne","w","e","sw","s","se"),l=[],d=!1,c=[],g=0,m=0,w=0;9>w;w++)l[w]=new h(w),ge.append(l[w].grip);this.dispose=t,this.setRectangle=e,this.resetColors=o,this.resetGrips=i,this.hide=n,this.show=s,this.showGrips=r,this.resetEvents=a,a()}function u(t,e,o,i){var n=ne("<"+t+"></"+t+">");return e&&e.append&&n.appendTo(e),o&&n.attr("id",o),i&&n.html(i),n}function l(){var t=u("div");return t.addClass(he.domclasses.atala_tool_selection_band),t.css({position:"absolute",zIndex:se}),t}function d(){var t=u("div");return t.addClass(he.domclasses.atala_tool_selection_mask),t.hide(),t.css({left:"0px",top:"0px",width:"1px",height:"1px",position:"absolute",background:"#000",opacity:"0.6",zIndex:"0"}),t}function c(){return ue.animated}function g(){return ue.aspectratio}function p(){return ue.backcolor}function f(){return ue.forecolor}function m(){return ue.height}function x(){return ue.movable}function b(){return ue.multicolor}function w(){return{x:ue.x,y:ue.y}}function y(){return{x:ue.x,y:ue.y,width:ue.width,height:ue.height}}function v(){return ue.resizable}function z(){return ue.showgrips}function k(){return ue.showmask}function M(){return ue.showtooltip}function _(){return{width:ue.width,height:ue.height}}function P(){return ue.visible}function S(){return ue.width}function A(){return ae.bind.apply(ae,arguments),re}function C(){return ae.unbind.apply(ae,arguments),re}function U(){return ae.trigger.apply(ae,arguments),re}function R(){D(),ue.x=0,ue.y=0,ue.width=0,ue.height=0}function F(){le.mask.left.hide(),le.mask.right.hide(),le.mask.top.hide(),le.mask.bottom.hide()}function G(t,e,o,i){return ue.showmask?(e>0?(le.mask.top.css({left:de.pageoffset.x,top:de.pageoffset.y,width:X(),height:e}),le.mask.top.show()):le.mask.top.hide(),e+i<Q()?(le.mask.bottom.css({left:de.pageoffset.x,top:de.pageoffset.y+e+i,width:X(),height:Q()-(e+i)}),le.mask.bottom.show()):le.mask.bottom.hide(),t>0?(le.mask.left.css({left:de.pageoffset.x,top:de.pageoffset.y+e,width:t,height:i}),le.mask.left.show()):le.mask.left.hide(),t+o<X()?(le.mask.right.css({left:de.pageoffset.x+t+o,top:de.pageoffset.y+e,width:X()-(t+o),height:i}),le.mask.right.show()):le.mask.right.hide(),void 0):(F(),void 0)}function T(){ie.css({left:(ue.x+ue.width)*de.zoom+8+"px",top:(ue.y+ue.height)*de.zoom+4+"px"}),ie.text(Math.round(ue.width/de.zoom)+"x"+Math.round(ue.height/de.zoom)),ie.is(":hidden")&&ie.show()}function E(){ue.visible=!0,le.rectback.show(),le.rect.show(),c()===!0&&b()===!0&&K()}function D(){ue.visible=!1,F(),oe.hide(),le.rectback.hide(),le.rect.hide()}function I(){var t=ue.multicolor?"dashed":"solid",e="1px solid #"+ue.backcolor,o="1px "+t+" #"+ue.forecolor;le.rectback.css("border",e),le.rect.css("border",o),oe.resetColors()}function B(){V()}function V(){var t=ue.x,e=ue.y,o=de.pagesize.width,i=de.pagesize.height;(t>=o||t+ue.width>o)&&(t=o-ue.width,0>t&&(t=0)),(e>=i||e+ue.height>i)&&(e=i-ue.height,0>e&&(e=0)),t!==ue.x&&(ue.x=t),e!==ue.y&&(ue.y=e);var n=Math.round(ue.x*de.zoom),s=Math.round(ue.y*de.zoom),r=Math.round(ue.width*de.zoom),a=Math.round(ue.height*de.zoom);Z(n,s),q(r,a),oe.setRectangle(n,s,r,a),ue.visible?(E(),G(n,s,r,a)):D()}function Z(t,e){le.rectback.css({left:t+"px",top:e+"px"}),le.rect.css({left:t+"px",top:e+"px"})}function q(t,e){0===t&&(t=1),le.rectback.css({width:t+"px",height:e+"px"}),le.rect.css({width:t+"px",height:e+"px"})}function J(t){t.stopPropagation(),t.preventDefault(),te();var e=N(t);return E(),de.origin.x=e.x,de.origin.y=e.y,ue.x=Math.round(e.x/de.zoom),ue.y=Math.round(e.y/de.zoom),ue.width=1,ue.height=1,de.changing=!0,de.vert=0,de.horiz=0,V(),ue.showtooltip===!0&&T(),!1}function L(t,e){t.stopPropagation(),t.preventDefault();var o=e?e:N(t),i=Math.round(de.origin.x/de.zoom),n=Math.round(de.origin.y/de.zoom),s=Math.abs((o.x-de.origin.x)/de.zoom),r=Math.abs((o.y-de.origin.y)/de.zoom);if(ue.aspectratio>0){var a=Math.abs((o.y-de.origin.y)/(o.x-de.origin.x));a>1/ue.aspectratio&&0===de.horiz||1===de.vert?s=Math.round(r*ue.aspectratio):r=Math.round(s/ue.aspectratio)}return o.x<de.origin.x?(i-=s,i-de.pageoffset.x<0&&(s=de.origin.x-de.pageoffset.x,ue.aspectratio>0&&(r=Math.round(s/ue.aspectratio)),i=de.origin.x-s)):i+s>de.pagesize.width+de.pageoffset.x&&(s=de.pagesize.width-i+de.pageoffset.x,ue.aspectratio>0&&(r=Math.round(s/ue.aspectratio))),o.y<de.origin.y?(n-=r,n-de.pageoffset.y<0&&(r=de.origin.y-de.pageoffset.y,ue.aspectratio>0&&(s=Math.round(r*ue.aspectratio)),n=de.origin.y-r,o.x<de.origin.x&&(i=de.origin.x-s))):n+r>de.pagesize.height+de.pageoffset.y&&(r=de.pagesize.height-n+de.pageoffset.y,ue.aspectratio>0&&(s=Math.round(r*ue.aspectratio)),o.x<de.origin.x&&(i=de.origin.x-s)),(0===de.vert||ue.aspectratio>0)&&(ue.x=i-de.pageoffset.x,ue.width=s),(0===de.horiz||ue.aspectratio>0)&&(ue.y=n-de.pageoffset.y,ue.height=r),V(),ue.showtooltip===!0&&T(),!1}function O(t){return L(t,Atalasoft.Utils.getMousePositionJquery(t,null,!0))}function H(t,e){t=t||event,Y(t),de.vert=0,de.horiz=0,de.changing=!0;var o={x:0,y:0};switch(e){case"nw":o.x=ue.x+ue.width,o.y=ue.y+ue.height;break;case"n":o.x=ue.x,o.y=ue.y+ue.height,de.vert=1;break;case"ne":o.x=ue.x,o.y=ue.y+ue.height;break;case"w":o.x=ue.x+ue.width,o.y=ue.y+ue.height,de.horiz=1;break;case"e":o.x=ue.x,o.y=ue.y+ue.height,de.horiz=1;break;case"sw":o.x=ue.x+ue.width,o.y=ue.y;break;case"s":o.x=ue.x,o.y=ue.y,de.vert=1;break;case"se":o.x=ue.x,o.y=ue.y}de.origin.x=Math.round(o.x*de.zoom)+de.pageoffset.x,de.origin.y=Math.round(o.y*de.zoom)+de.pageoffset.y,ce.raiseDrawLayer();var i={mousemove:O,mouseup:j};return null!==de.boundevents?ne.extend(de.boundevents,i):de.boundevents=i,ge.bind(i),!1}function W(t){t=t||event,Y(t);var e=Atalasoft.Utils.getMousePosition(t,null,ge[0]);de.origin.x=e.x-Math.round(ue.x*de.zoom),de.origin.y=e.y-Math.round(ue.y*de.zoom),de.changing=!0;var o={mousemove:$,mouseup:j,ondrag:Atalasoft.Utils.__rf};return null!==de.boundevents?ne.extend(de.boundevents,o):de.boundevents=o,ge.bind(o),!1}function $(t){t=t||event,Y(t);var e=Atalasoft.Utils.getMousePosition(t,null,ge[0]),o={x:0,y:0};return o.x=Math.round((e.x-de.origin.x)/de.zoom),o.y=Math.round((e.y-de.origin.y)/de.zoom),o.x>de.pagesize.width-ue.width&&(o.x=de.pagesize.width-ue.width),o.x<0&&(o.x=0),o.y>de.pagesize.height-ue.height&&(o.y=de.pagesize.height-ue.height),o.y<0&&(o.y=0),ue.x=o.x,ue.y=o.y,V(),!1}function j(t){return t=t||event,Y(t),de.changing=!1,ue.showtooltip===!0&&ie.hide(),de.changing&&(de.changing=!1,U("changed")),null!==de.boundevents&&(ge.unbind(de.boundevents),de.boundevents=null,ce.resetDrawLayer()),!1}function K(){ue.animated===!0&&0===de.colorswap?(le.rect.css("border","1px dashed #"+p()),le.rectback.css("border","1px solid #"+f()),de.colorswap=1):(le.rect.css("border","1px dashed #"+f()),le.rectback.css("border","1px solid #"+p()),de.colorswap=0),ue.animated!==!0||le.rect.is(":hidden")||de.animating||(de.animating=setTimeout(function(){de.animating=!1,K()},250))}function N(t){var e=Atalasoft.Utils.getMousePositionJquery(t.toolEvent?t.toolEvent:t);if(ge._paper){var o=Atalasoft.Utils.getSVGOffset(ge._paper.canvas,ge);e.x-=o.left,e.y-=o.top}return e}function Q(){return Math.round(de.pagesize.height*de.zoom)}function X(){return Math.round(de.pagesize.width*de.zoom)}function Y(t){"undefined"!=typeof t.stopPropagation?t.stopPropagation():t.cancelBubble=!0}function te(){var t=ge._img.getSize();de.zoom=ge._img.getFitZoom(),de.pagesize.width=t.width,de.pagesize.height=t.height}function ee(){var t=ce.getMaxZoom();if(he.getZoom()<t){var e,o=ce.getViewportSize(),i=ge._img.getFitMultiplier(),n=1,s=0,r=0;e=o.width/ue.width===o.height/ue.height?Math.min(o.width/(ue.width*i),o.height/(ue.height*i),t):o.width/ue.width<o.height/ue.height?Math.min(o.width/(ue.width*i),t):Math.min(o.height/(ue.height*i),t),n=i*e,s=Math.round(ue.x*n),r=Math.round(ue.y*n),r-=Math.max(0,Math.round((o.height-ue.height*n)/2)),s-=Math.max(0,Math.round((o.width-ue.width*n)/2));var a=ce.getPageOffsets(ge._index,null,null,e);he.zoom(e,function(){he.scrollTo(a.width+s,a.height+r)})}}var oe,ie,ne=Atalasoft.$,se=3,re=this,ae=ne({}),he=t,ue={animated:!1,aspectratio:0,backcolor:"fff",forecolor:"000",movable:!0,multicolor:!0,resizable:!0,showgrips:!1,showmask:!1,showtooltip:!1,visible:!1,x:0,y:0,width:0,height:0},le={/** Main RubberBand dom object */
rect:null,/** Dom object underneath Main RubberBand */
rectback:null,/** Mask objects */
mask:{top:null,bottom:null,left:null,right:null}},de={animating:!1,boundevents:null,changing:!1,colorswap:0,origin:{x:0,y:0},pagesize:{width:0,height:0},pageoffset:{x:0,y:0},vert:!1,horiz:!1,zoom:1},ce=i,ge=o;return re.dispose=s,re.getAnimated=c,re.getAspectRatio=g,re.getBackColor=p,re.getForeColor=f,re.getHeight=m,re.getMovable=x,re.getMultiColor=b,re.getPosition=w,re.getRectangle=y,re.getResizable=v,re.getShowGrips=z,re.getShowMask=k,re.getShowTooltip=M,re.getSize=_,re.getVisible=P,re.getWidth=S,re.bind=A,re.hide=D,re.reset=R,re.show=E,re.synchronize=B,re.trigger=U,re.unbind=C,re.zoomToSelection=ee,re.startSelect=J,re.moveSelect=L,re.endSelect=j,n(),re};
Atalasoft.Annotations.AnnotationController=function(e,t,n){function a(e){Nt.push(e)}function o(){Wt.setAnnos(qt.annos),Wt.setPages(Et)}function r(){if(o(),"undefined"==typeof Raphael)return d("DependencyError","Raphael did not load properly."),void 0;for(parseFloat(Raphael.version)<Ct&&d("DependencyError","Raphael versions 2.1 and higher are supported, other versions may cause instability."),Atalasoft.Utils._raphaelLoader&&Atalasoft.Utils._raphaelLoader===Ot&&delete Atalasoft.Utils._raphaelLoader,Ot.trigger("raphaelloaded"),l(),Ot.trigger("raphaelextended");Nt.length;)Nt.shift().call();Ht=Raphael.matrix(1,0,0,1,0,0),Ot.bind({scroll:c,pagerecycled:D,pageshown:_,zoomchanged:u,pagerotated:P}),It={Delete:F,Properties:B},St._state.initialized?i():Ot.bind({initialized:i})}function i(){Mt=!0,qt.readonly||(Lt=S(It),jt=new R,null!=Tt.annotations.defaults&&G(Tt.annotations.defaults),null!=Tt.annotations.stamps&&Q(Tt.annotations.stamps),null!=Tt.annotations.images&&J(Tt.annotations.images),null!=Tt.annotations.custom&&X(Tt.annotations.custom))}/**
	* [Internal] Disposes memory intensive objects
	* @returns undefined
	*/
function s(){zt=null,Ot=null,St=null,Tt=null,Et=null,Ut=null,Lt=null,It=null,jt=null,Nt.length=0,qt.annos.length=0,qt.activepage=null,qt.activeanno=null,qt.zoom=null,Wt.dispose(),Wt=null}function l(){function e(e,t,a,o,r){function i(e){var t=s.matrix.split();if(e.hasOwnProperty("x")&&"undefined"!=typeof e.x&&e.hasOwnProperty("y")&&"undefined"!=typeof e.y){var n={x:e.x*t.scalex,y:e.y*t.scaley};if(0!==t.rotate){var a=Atalasoft.Utils.__calcPathBounds([{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}],s.matrix);n=a}l.style.left=Math.round(n.x)+"px",l.style.top=Math.round(n.y)+"px"}}var s=n(this,this,null,"div",t,a,o,r),l=s.node;return l.innerHTML=e?e:"",s.innerDom=l,l.style.position="absolute",s.__tsfm=s.transform,s.transform=function(){this.__tsfm.apply(this,arguments),this.repaint(),i(this.attrs)},s.backgroundColor=function(e){l.style.backgroundColor=e,this.repaint()},s.repaint=function(){l.style.filter='progid:DXImageTransform.Microsoft.Chroma(color="'+l.style.backgroundColor+'"); '+this.matrix.toFilter()},s.__attr=s.attr,s.attr=function(e){this.__attr.apply(this,arguments),e&&(i(e),e.hasOwnProperty("width")&&(l.style.width=e.width+"px"),e.hasOwnProperty("height")&&(l.style.height=e.height+"px"))},s.isHtml=!0,s}function t(e,t,a,r,i){var s="http://www.w3.org/1999/xhtml",l="http://www.w3.org/2000/xmlns/",p="http://www.w3.org/2000/svg",c=o?"image":"foreignObject",d=n(this,this,p,c,t,a,r,i),u=null;return o||(u=document.createElementNS(s,"div"),u.setAttributeNS(l,"xmlns",l),u.innerHTML=e?e:"",d.node.appendChild(u),d.isHtml=!0),d.innerDom=u,d}function n(e,t,n,a,o,r,i,s,l){var p=null===n?document.createElement(a):document.createElementNS(n,a);t.canvas&&t.canvas.appendChild&&t.canvas.appendChild(p);var c=new e.constructor.el.constructor(p,e);c.attrs={x:o,y:r,width:i,height:s,r:l||0,rx:l||0,ry:l||0,fill:"none",stroke:"#000"},c.skew={},c.type=a,"g"===a&&(c.canvas=c.node);for(var d in c.attrs)c.attrs.hasOwnProperty(d)&&void 0!==c.attrs[d]&&p.setAttribute(d,c.attrs[d]+"");return c}function a(){var e={block:"M5,0 0,2.5 5,5z",classic:"M5,0 0,2.5 5,5 3.5,3 3.5,2z",diamond:"M2.5,0 5,2.5 2.5,5 0,2.5z",open:"M6,1 1,3.5 6,6",oval:"M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"},t={},n=function(e,t){if(t){"string"==typeof e&&(e=n(e));for(var a in t)t.hasOwnProperty(a)&&("xlink:"===a.substring(0,6)?e.setAttributeNS("http://www.w3.org/1999/xlink",a.substring(6),String(t[a])):e.setAttribute(a,String(t[a])))}else e=Raphael._g.doc.createElementNS("http://www.w3.org/2000/svg",e),e.style&&(e.style.webkitTapHighlightColor="rgba(0,0,0,0)");return e};Raphael.fn.addArrow=function(a,o,r){if("path"===a.type){for(var i,s,l,p,c,d=String(o).toLowerCase().split("-"),u=a.paper,f=r?"end":"start",g=a.node,h=a.attrs,v=h["stroke-width"],m=d.length,y="classic",w=3,_=3,x=5;m--;)switch(d[m]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":y=d[m];break;case"wide":_=5;break;case"narrow":_=2;break;case"long":w=5;break;case"short":w=2}if("open"===y?(w+=2,_+=2,x+=2,l=1,p=r?4:1,c={fill:"none",stroke:h.stroke}):(p=l=w/2,c={fill:h.stroke,stroke:"none"}),a._.WDVarrows?r?(a._.WDVarrows.endPath&&t[a._.WDVarrows.endPath]--,a._.WDVarrows.endMarker&&t[a._.WDVarrows.endMarker]--):(a._.WDVarrows.startPath&&t[a._.WDVarrows.startPath]--,a._.WDVarrows.startMarker&&t[a._.WDVarrows.startMarker]--):a._.WDVarrows={},"none"!==y){var b=Math.random().toString(36).substring(7),A="dave-marker-"+y,D="dave-marker-"+f+y+w+_+b;Raphael._g.doc.getElementById(A)?t[A]++:(u.defs.appendChild(n(n("path"),{"stroke-linecap":"round",d:e[y],id:A})),t[A]=1);var k,P=Raphael._g.doc.getElementById(D);P?(t[D]++,k=P.getElementsByTagName("use")[0]):(P=n(n("marker"),{id:D,markerHeight:_,markerWidth:w,orient:"auto",refX:p,refY:_/2}),k=n(n("use"),{"xlink:href":"#"+A,transform:(r?"rotate(180 "+w/2+" "+_/2+") ":"")+"scale("+w/x+","+_/x+")","stroke-width":(1/((w/x+_/x)/2)).toFixed(4)}),P.appendChild(k),u.defs.appendChild(P),t[D]=1),n(k,c);var V=l*("diamond"!==y&&"oval"!==y);r?(i=a._.WDVarrows.startdx*v||0,s=Raphael.getTotalLength(h.path)-V*v):(i=V*v,s=Raphael.getTotalLength(h.path)-(a._.WDVarrows.enddx*v||0)),s=0>s?0:s,c={},c["marker-"+f]="url(#"+D+")",(s||i)&&(c.d=Raphael.getSubpath(h.path,i,s)),n(g,c),a._.WDVarrows[f+"Path"]=A,a._.WDVarrows[f+"Marker"]=D,a._.WDVarrows[f+"dx"]=V,a._.WDVarrows[f+"Type"]=y,a._.WDVarrows[f+"String"]=o}else r?(i=a._.WDVarrows.startdx*v||0,s=Raphael.getTotalLength(h.path)-i):(i=0,s=Raphael.getTotalLength(h.path)-(a._.WDVarrows.enddx*v||0)),a._.WDVarrows[f+"Path"]&&n(g,{d:Raphael.getSubpath(h.path,i,s)}),delete a._.WDVarrows[f+"Path"],delete a._.WDVarrows[f+"Marker"],delete a._.WDVarrows[f+"dx"],delete a._.WDVarrows[f+"Type"],delete a._.WDVarrows[f+"String"];for(c in t)if(t.hasOwnProperty(c)&&!t[c]){var R=Raphael._g.doc.getElementById(c);R&&R.parentNode.removeChild(R)}}}}var o=Raphael.svg&&!Atalasoft.Utils.Browser.Features.foreignObject;Raphael.vml?Raphael.fn.html=e:(Raphael.fn.html=t,a())}function p(){"Atalasoft.Controls.WebDocumentViewer"===Ot.typeOf&&Rt.extend(Ot,Bt)}function c(e){Ht.translate(e.dx,e.dy)}function d(e,t){Ot.trigger({type:"throwerror",name:e,msg:t})}function u(e){qt.zoom=e.zoom}function f(e){if(e instanceof jQuery){if("undefined"!=typeof Raphael){e._paper=Raphael(e[0]),e._paper.canvas.style.position="absolute",e._paper.canvas.style.zIndex="2",Tt.pageborderwidth>0&&(e._paper.canvas.style.left=Tt.pageborderwidth+"px",e._paper.canvas.style.top=Tt.pageborderwidth+"px"),e._paper._annos=e._paper.set(),e._paper._trash=e._paper.set(),e._paper._page=e,e._matrix=Raphael.matrix(1,0,0,1,0,0),e._matrix.translate(-e.offset().left,-e.offset().top),e._grips=new Atalasoft.Annotations.Grips(e,qt);var t=function(){A(e),Wt.deselectPage(e),O()};e.bind("mousedown",t),Atalasoft.Utils.Browser.Features.Touch&&e.bind("touchstart",t),e.bind({pageresize:function(t){t.page=e,w(t)},pagezoom:function(t){t.page=e,k(t)}})}else a(function(){f(e)});return!0}return!1}function g(e){return e instanceof jQuery?("undefined"!=typeof Raphael&&(e._paper&&(e._paper._annos=null,e._paper._page=null,e._paper=null),e._matrix=null,e._grips=null),!0):!1}function h(e,t,n){if(null==e&&"number"==typeof t&&(t=v(t)),t=t||[],null==n?n=qt.annos.length:0>n&&(n=0),n>qt.annos.length){var a=qt.annos.length;qt.annos[n]=t;for(var o=a;o<qt.annos.length;++o)qt.annos[o]||(qt.annos[o]=[])}else qt.annos.splice(n,0,t)}function v(e){return e<qt.annos.length?qt.annos.splice(e,1)[0]:null}function m(e,t){h(null,v(e),t)}function y(e){e&&e.remove&&!e.grip&&e.paper&&e.paper._trash&&e.paper._trash.push(e)}function w(e){e.page._paper.setSize(e.width,e.height),e.page._paper.canvas.style.width=e.width,e.page._paper.canvas.style.height=e.height,V(e.page)}function _(e){x(e.index,e.page)}function x(e,t){if("undefined"!=typeof Raphael){if(e<qt.annos.length&&(b(t),qt.annos[e]&&qt.annos[e].length))for(var n,o=0;o<qt.annos[e].length;o++)n=qt.annos[e][o],n._pageindex=e,n.repaint(t._paper),n.get("selected")&&Wt.select(n,e,!0)}else a(function(){x(e,t)})}function b(e){e._grips.clear(),e._paper._annos.remove(),e._paper._annos.clear(),e._paper.forEach(function(e){e&&e.remove&&!e.grip&&e.paper&&e.paper._trash&&e.paper._trash.push(e)}),e._paper._trash.remove(),e._paper._trash.clear(),dt()}function A(e){qt.activepage=e}function D(e){e.page._paper&&(b(e.page),e.page.append(e.page._paper.canvas))}function k(e){isFinite(e.width)&&isFinite(e.height)&&e.width&&e.height&&(qt.zoom=e.zoom,e.page._paper.setSize(e.width,e.height),e.page._paper.canvas.style.width=e.width,e.page._paper.canvas.style.height=e.height,e.page._paper.forEach(function(t){if(t&&t.transform&&!t.grip){"undefined"!=typeof t._linewidth&&t.attr("stroke-width",t._linewidth*qt.zoom);var n=t.attr("clip-rect");if("object"==typeof n&&"number"==typeof n.length){if(Atalasoft.Utils.Browser.Explorer&&parseInt(Atalasoft.Utils.Browser.Version,10)<9)for(var a=0;a<n.length;a++)n[a]=n[a]/e.prevzoom*e.zoom;t.attr("clip-rect",n)}}}),V(e.page))}function P(e){V(e.page)}function V(e){if(e&&e._index>=0&&qt.annos[e._index]){for(var t=0;t<qt.annos[e._index].length;t++)qt.annos[e._index][t].repaint();e&&e._grips.repaint()}}function R(){function e(){g.appendTo(f),f.dialog({minWidth:320,dialogClass:"atala-ui",resizable:!1,autoOpen:!1,buttons:{Ok:n,Reset:r,Cancel:o}})}function t(e){h=e,g.empty(),v={};for(var t in m)if(m.hasOwnProperty(t)){var n={};n[t]=h.get(t),Rt.extend(!0,v,n)}i(h.get(),"",m),f.dialog("open")}function n(){f.dialog("close")}function a(){return f.dialog("isOpen")}function o(){r(),n()}function r(){h.set(v,!0),h.updateView(),h.repaint(),g.empty(),i(h.get(),"",m),d()}function i(e,t,n){function a(t){if(this.value&&"boolean"!=typeof this.value)if("number"==typeof e[this.title]){var n=parseFloat(this.value);isNaN(n)||"rotation"!==this.title||n===e[this.title]?"opacity"===this.title&&n>=0&&1>=n||"opacity"!==this.title&&this.value>=0?e[this.title]=n:this.value=e[this.title]:(h.set({rotation:n}),h.repaint())}else e[this.title]=this.value;else t&&"boolean"==typeof this.value?e[this.title]=t.target.id.indexOf("true")>=0:this.value=e[this.title];h.updateView(),h.repaint(),d()}for(var o in e)if("object"==typeof e[o]){var r="text"!==o?c(o):"";n[o]&&("text"!==o||"text"===o&&"text"===h.get("type"))&&i(e[o],(t?t+" ":t)+r,n[o])}else if("type"===o)f.dialog("option","title",c(e[o].replace("fillrect","rectangle"))+" Annotation Properties");else if(n[o]){var l=Rt("<div/>"),u=s(o,e[o],a,n[o]);l.addClass("ui-helper-clearfix atala-ui-dialog-clearfix"),l.css({overflow:"hidden"}),u.appendTo(l),p(l,(t?t+" ":t)+c(o)+":"),l.appendTo(g)}}function s(e,t,n,a){var o=typeof t,r=null;if(Rt.isArray(a))r=Rt("<select/>").attr({title:e}),Rt.each(a,function(e,t){var n=t,a=t,o=t.split(":");o.length>1&&(a=o[0],n=o[1]),r.append(Rt("<option/>",{value:n,text:a}))}),r.change(n),r.val(t);else if("string"===o||"number"===o)r=Rt("<input/>").attr({type:"text",title:e}),r.val(t),r.change(n),r.focus(function(){this.select(),this._focused=!0}),r.mouseup(function(e){this._focused&&(e.preventDefault(),this._focused=!1)});else if("boolean"===o){var i="bool"+e;r=Rt("<div/>").attr({title:e}),l(r,i+!0,i,"True",t),l(r,i+!1,i,"False",!t),r.buttonset(),r.change(n),r[0].value=t}else r=Rt("<div>"+t+"</div");return r.css({"float":"right"}),r}function l(e,t,n,a,o){e.append(Rt("<input/>").attr({type:"radio",id:t,name:n,checked:o})),e.append(Rt("<label/>").attr({"for":t}).text(a))}function p(e,t){e.append(Rt("<span/>").text(t))}function c(e){return e.charAt(0).toUpperCase()+e.slice(1)}function d(){var e=h.getObject();e&&e.paper&&e.paper._page&&e.paper._page._grips.repaint()}var u=this,f=Rt("<div />"),g=Rt("<div />"),h=null,v=null,m={fill:{color:!0,opacity:!0},rotation:!0,outline:{color:!0,opacity:!0,width:!0,startcap:{style:["None:none","Arrow:open","Filled Arrow:block","Filled Ellipse:oval","Filled Diamond:diamond"],width:["medium","long","short"],height:["medium","wide","narrow"]},endcap:{style:["None:none","Arrow:open","Filled Arrow:block","Filled Ellipse:oval","Filled Diamond:diamond"],width:["medium","long","short"],height:["medium","wide","narrow"]}},text:{font:{bold:!0,italic:!0,color:!0,family:!0,size:!0}}};return u.show=t,u.hide=n,u.isVisible=a,u.cancel=o,u.reset=r,e(),u}function C(e){if(Lt){if(qt.activeanno.get("readonly"))Lt.children(":contains(Properties)").unbind("click").children("a, div").css("color","#cdc9c9");else{var t=Lt.children(":contains(Properties)");void 0!==t.data("events")&&"click"in t.data("events")||t.bind("click",B),t.children("a").css("color","#000000")}0===Lt.closest().length&&Ut.prepend(Lt);var n={x:e.x-6,y:e.y-6};Lt.css({left:n.x,top:n.y}),Lt.show(),Lt.visible=!0}}function z(e){Lt&&(Lt.visible&&O(),Lt.remove());var t=Rt.extend(!0,{},It);if(Ot.trigger("contextmenu",[qt.activeanno.getClonedData(),t]),Rt.isEmptyObject(t))Lt=null;else{for(var n in t)t.hasOwnProperty(n)&&(t[n]=W(t[n]));Lt=S(t)}C(e)}function O(){Lt&&(Lt.hide(),Lt.visible=!1)}function S(e){var t=St.createMenu(e);return t.css({position:"fixed","z-index":99999}),t.mouseleave(O),t.visible=!1,t}function W(e){return function(){return O(),e.call(this,qt.activeanno.getClonedData())}}function F(){var e=qt.activepage?qt.activepage._index:0;if(qt.annos[e]){var t=Rt.inArray(qt.activeanno,qt.annos[e]);-1!==t&&(qt.activeanno=null,L(t,e))}O()}function B(){O(),jt.show(qt.activeanno)}/**
	* Clears the annotations and related data from all pages
	*/
function T(){if(qt.annos.length>0){if(qt.annos.length=0,Et)for(var e=0;e<Et.length;e++)Et[e]._grips.clear(),Et[e]._paper.forEach(y),Et[e]._paper._trash.remove(),Et[e]._paper._trash.clear(),Et[e]._paper._annos.remove(),Et[e]._paper._annos.clear();Ot.trigger({type:"annotationscleared"})}}/**
	* Creates an annotation on the desired page with the given annotation data.
	* @param aConfig: object, Key value pairs representing annotation data.
	* @param pgNum: number, The zero based index of the page the annotation should be created on.
	* @param callback: function, Function to be called when the operation has completed.
	* @returns object: Atalasoft.Annotations.Annotation.
	*/
function E(e,t,n){var a={};e.multiview?a=e:(e&&e.type&&Gt[e.type]&&Rt.extend(!0,a,Gt[e.type]),Rt.extend(!0,a,e));var o=new Atalasoft.Annotations.Annotation(a,qt);return o._pageindex=t,"undefined"==typeof qt.annos[t]&&(qt.annos[t]=[]),qt.annos[t].push(o),St.redrawPageFromIndex(t,!0),"function"==typeof n&&n(o),gt(o),o}/**
	* Creates an annotation on the desired page with the given annotation data.
	* @param aConfig: object, Key value pairs representing annotation data.
	* @param pgNum: number, The zero based index of the page the annotation should be created on.
	* @param callback: function, Function to be called when the operation has completed.
	* @returns object, Key value pairs representing annotation data.
	*/
function M(e,t,n){var a=E(e,t,n).getClonedData();return Ot.trigger({type:Xt.annocreate,anno:a,page:t}),a}/**
	* Deletes an annotation on the given z-index and zero based page index.
	* @param pgNum: number, Zero based page index the annotation is located on.
	* @param annIndex: number, Zero based z-index of the annotation.
	*/
function U(e,t){L(t,e)}/**
	* Deletes an annotation on the given z-index and zero based page index.
	* @param annIndex: number, Zero based z-index of the annotation.
	* @param pgNum: number, Zero based page index the annotation is located on.
	*/
function L(e,t){var n=qt.annos[t].splice(e,1)[0];qt.activepage&&qt.activepage._paper._annos.exclude(n.getObject()),qt.activeanno===n&&(qt.activeanno=null),n.dispose(),qt.activepage&&qt.activepage._grips.repaint(),Ot.trigger({type:"annotationdeleted",page:t,index:e})}/**
	* Gets an array of annotion data objects located on the given zero based page index.
	* @param pageNum: number, Zero based page index the annotations are located on.
	* @returns array: Array of annotation data objects on the given page index. 
	*/
function I(e){var t=[];if(0===qt.annos.length||"undefined"==typeof qt.annos[e])return t;for(var n=0;n<qt.annos[e].length;n++)t[n]=qt.annos[e][n].getClonedData();return t}function j(e,t){var n;if(isFinite(t)){if(t<qt.annos.length)for(n=0;n<qt.annos[t].length;++n)if(qt.annos[t][n].isCloneSource(e))return qt.annos[t][n]}else for(n=0;n<qt.annos.length;++n){var a=j(e,n);if(a)return a}return null}/**
	* Inserts a layer of annotations at the source URL and index into the given page index.
	* @param sourceUrl: string, Url of the desired xmp annotation file.
	* @param sourceIndex: number, Zero based page index the layer is copied from.
	* @param index: number, Zero based page index the layer is to be inserted into.
	* @param callback: function, Function to be called when the operation has completed.
	*/
function N(e,t,n,a){h(e,t,n),"function"==typeof a&&a(),Ot.trigger({type:Xt.layerinserted,srcurl:e,srcindex:t,index:n}),Ot.trigger(Xt.layerschanged)}/**
	* Removes a layer of annotations.
	* @param index: number, Zero based page index of the layer to be removed.
	* @param callback: function, Function to be called when the operation has completed.
	*/
function H(e,t){v(e),"function"==typeof t&&t(),Ot.trigger({type:Xt.layerremoved,index:e}),Ot.trigger(Xt.layerschanged)}/**
	* Moves a layer of annotations from one page index to another.
	* @param sourceIndex: number, Zero based page index of the layer to be moved.
	* @param destIndex: number, Destination zero based page index.
	* @param callback: function, Function to be called when the operation has completed.
	*/
function q(e,t,n){m(e,t),"function"==typeof n&&n(),Ot.trigger({type:Xt.layermoved,srcindex:e,destindex:t}),Ot.trigger(Xt.layerschanged)}/**
	* Sets the default annotation properties for initially created annotations.  This accepts the same input as the main config.
	* @param aConfig: array, An array of JSON objects representing the starting properies of the associated type.
	* @returns object: Atalasoft.Controls.WebDocumentViewer
	*/
function G(e){Tt.annotations.defaults=e;for(var t=0;t<e.length;t++)"string"==typeof e[t].type&&(Gt[e[t].type]=e[t]);return Ot}/**
	* Sets the default annotation properties for initially created stamp annotations.  This accepts the same input as the main config.
	* @param sConfig: array, An array of JSON objects representing pre-made stamp annotations.
	* @returns object: Atalasoft.Controls.WebDocumentViewer
	*/
function Q(e){Tt.annotations.stamps=e;for(var t=0;t<e.length;t++)Dt(e[t]);if(Mt){var n={type:"button",id:St._id+"_toolbar_Button_Stamp",icon:"stamp",tooltip:"Draw Stamp",text:""},a=St.createDropDownButton(n);n.onclick=St.drawAnnotation,St.createDropDownMenu(a,n,e)}return Ot}/**
	* Sets the default annotation properties for initially created image annotations.  This accepts the same input as the main config.
	* @param iConfig: array, An array of JSON objects representing pre-made image annotations.
	* @returns object: Atalasoft.Controls.WebDocumentViewer
	*/
function J(e){Tt.annotations.images=e;for(var t=0;t<e.length;t++)Pt(e[t]);if(Mt){var n={type:"button",id:St._id+"_toolbar_Button_Image",icon:"image",tooltip:"Draw Image",text:""},a=St.createDropDownButton(n);n.onclick=St.drawAnnotation,St.createDropDownMenu(a,n,e)}return Ot}/**
	* Sets the default annotation properties for initially created custom annotations.  This accepts the same input as the main config.
	* @param cConfig: array, An array of JSON objects representing custom annotation types.
	* @returns object: Atalasoft.Controls.WebDocumentViewer
	*/
function X(e){Tt.annotations.custom=e;for(var t=0;t<e.length;t++)Vt(e[t]);if(Mt){var n={type:"button",id:St._id+"_toolbar_Button_Custom",icon:"image",tooltip:"Draw Custom",text:""},a=St.createDropDownButton(n);n.onclick=St.drawAnnotation,St.createDropDownMenu(a,n,e)}return Ot}/**
    * Shows the text annotation editor. Ignores other types of annotations.
    * @param annotation: the annotation object to show editor for.     
    * @returns undefined 
    */
function Z(e){return $(e,!0)}/**
    * Hides the text annotation editor. Ignores other types of annotations.
    * @param annotation: the annotation object to hide editor for.     
    * @returns undefined 
    */
function Y(e){return $(e,!1)}function $(e,t){if("text"===e.type&&e){var n=e.getPageIndex(),a=j(e,n);if(t){var o=e.visible;o&&(St.isPageInView(n)?K(a,n):Ot.showPage(e.getPageIndex(),function(){K(a,n)}))}else a.trigger("hideeditor")}}function K(e,t){e&&(e.get("selectable")!==!1&&Wt.select(e,t,!1),e.trigger("showeditor"))}function et(){var e={};return Rt.extend(!0,e,{data:qt,defaults:Gt,drawing:Qt,drawready:Jt,matrix:Ht,menu:Lt,menuconfig:It,pages:Et,props:jt,viewport:Ut}),e}function tt(e){e&&(null===e._annos?e._annos=qt.annos:Rt.isArray(e._annos)&&(qt.annos=e._annos))}function nt(e){e&&(e instanceof jQuery||(e=Rt(e)),Ut=e)}function at(e,t,n){return Qt?null:(e&&e.type&&Gt[e.type]&&Rt.extend(!0,e,Gt[e.type]),qt.activeanno&&null===qt.activeanno.getObject()&&ct(),it(),qt.activeanno=new Atalasoft.Annotations.Annotation(e,qt),qt.activeanno.bind({drawn:pt,cancelled:ct}),"function"==typeof t&&(ot=t),"function"==typeof n&&(rt=n),qt.activeanno)}function ot(){}function rt(){}function it(){if(!Jt){Ut.bind("mousedown",lt),Atalasoft.Utils.Browser.Features.Touch&&Ut.bind("touchstart",lt);for(var e=0;e<Et.length;e++)Et[e]._draw.toFront();Jt=!0}}function st(){if(Jt){Ut.unbind("mousedown",lt),Atalasoft.Utils.Browser.Features.Touch&&Ut.unbind("touchstart",lt);for(var e=0;e<Et.length;e++)Et[e]._draw.reset();Jt=!1}}function lt(e){Qt=!0,Ut.unbind("mousedown",lt),Atalasoft.Utils.Browser.Features.Touch&&Ut.unbind("touchstart",lt),Ot.trigger({type:"annotationdrawstart",ann:qt.activeanno.getClonedData()}),qt.activeanno._pageindex=qt.activepage._index,qt.activeanno.startDraw(e,qt.activepage._paper,{}),Atalasoft.Utils.Browser.Explorer&&parseInt(Atalasoft.Utils.Browser.Version,10)<8&&qt.activepage._draw.height(qt.activepage.height())}function pt(){ut(),ft(qt.activeanno),Atalasoft.Utils.Browser.Explorer&&parseInt(Atalasoft.Utils.Browser.Version,10)<8&&qt.activepage._draw.height("100%")}function ct(){qt.activeanno.dispose(),qt.activeanno=null,Qt&&ut(!0)}/**
	* Cancels the drawing of an annotation and returns the viewer to the previous tool.
	*/
function dt(){Jt&&(Qt?ct():(qt.activeanno&&(qt.activeanno.dispose(),qt.activeanno=null),st()),rt({annotation:null}),rt=function(){})}function ut(e){Qt=!1,st(),Ot.trigger({type:"annotationdrawend",ann:e?null:qt.activeanno.getClonedData(),cancelled:e?!0:!1})}function ft(e){var t=qt.activepage,n=t?t._index:0;qt.annos[n]?qt.annos[n].push(e):qt.annos[n]=[e],qt.activeanno.unbind({drawn:pt,cancelled:ct}),gt(qt.activeanno),Wt.select(qt.activeanno,t,!1),ot({annotation:e}),ot=function(){},Ot.trigger({type:Xt.annocreate,anno:e.getClonedData(),page:n})}function gt(e){function t(t){Ot.trigger({type:Xt[t.type],anno:e.getClonedData()})}e.bind({dragstart:function(){Ot.trigger({type:"annotationdragstart",ann:e.getClonedData()})},dragend:function(){Ot.trigger({type:"annotationdragend",ann:e.getClonedData()})},interactstart:function(){qt.activepage&&qt.activepage._paper===e.getObject().paper||A(e.getObject().paper._page),qt.activeanno=e},selected:ht,deselected:ht,reselected:ht,contextmenu:z,serverrenderurlrequested:vt,moved:t,rotated:t,annoresized:t,interactend:t,touchstart:t,touchmove:t,pinchmove:t,click:t,dblclick:t,rightclick:t,mousedown:t,mousedownleft:t,mousedownright:t,mousemove:t,mouseout:t,mouseup:t,mouseover:t,repaint:t})}function ht(e){var t=e.page||e.pageindex>=0?e.pageindex:qt.activepage;t=Wt.resolvePage(t),"selected"===e.type||"reselected"===e.type?(qt.activeanno=e.ann,Wt.select(e.ann,t,e.append),jt&&jt.isVisible()&&jt.show(e.ann)):(Wt.deselect(e.ann,t,e.append),jt&&jt.isVisible()&&jt.cancel()),t._grips.repaint()}function vt(e){var t=e.complete,n=yt(e.data);"function"==typeof t&&t.call(n)}function mt(){var e=[];for(var t in qt.annos)if(qt.annos.hasOwnProperty(t)){e[t]={items:[]};var n=0,a=St.getPageScale(t),o=Raphael.matrix();if(St._config.persistrotation){n=St.getPageRotation(t),o=St.getViewerTransform(t);var r=1/a;o.scale(r,r,0,0),o.e*=r,o.f*=r}for(var i in qt.annos[t])if(qt.annos[t].hasOwnProperty(i)){var s=Rt.extend(!0,{},qt.annos[t][i].get());if(s.rotation||n){var l=qt.annos[t][i].getBox(),p=l.width/2,c=l.height/2,d=Raphael.matrix();d.add(o),d.add(qt.annos[t][i].getTransform());var u={x:d.x(l.x+p,l.y+c),y:d.y(l.x+p,l.y+c)},f=u.x-p-l.x,g=u.y-c-l.y;if(s.points)for(var h=0;h<s.points.length;h++)if("line"===s.type){var v=d.x(s.points[h].x,s.points[h].y);s.points[h].y=d.y(s.points[h].x,s.points[h].y),s.points[h].x=v}else s.points[h].x+=f,s.points[h].y+=g;else"custom"!==s.type&&s.points||(s.x+=f,s.y+=g);s.rotation="line"!==s.type?(s.rotation+n)%360:0}e[t].items[i]=s,wt(s)}}return JSON.stringify(e)}function yt(e){return wt(e),JSON.stringify(e)}function wt(e){for(var t in e)if("color"===t&&null!=e[t]){var n=Raphael.getRGB(e[t]);n.error&&(n.hex="#000000"),e[t]=n.hex}else"points"!==t&&"object"==typeof e[t]&&wt(e[t])}function _t(e,t,n,a){var o={type:"annodata",serverurl:e,query:"?atalaanndata=",method:"GET",data:{atala_annurl:t,atala_a_ofs:n,atala_a_len:a},cancel:!1,info:{layers:[],offset:0,error:void 0}};return o}function xt(e,t){function n(e){At(e),"function"==typeof t&&t.call()}T(),St.makeHandlerRequest(e,n,n)}function bt(e,t,n,a,o){null!=n&&"function"==typeof n&&(o=n,n=void 0);var r=_t(e,t,n,a);xt(r,o)}function At(e){if(e)if("undefined"!=typeof Raphael){var t={type:"annotationsloaded"};if(e.layers)for(var n=0;n<e.layers.length;n++){var o=e.offset+n;qt.annos[o]&&qt.annos[o].length>0?qt.annos[o].length=0:qt.annos[o]=[];var r=e.layers[n];if(r._index=isFinite(r._index)&&r._index>=0?r._index:o,r.visible=void 0!==r.visible?r.visible:!0,r.items)for(var i=0;i<r.items.length;i++)r.items[i].visible=r.items[i].visible&&r.visible,qt.annos[o][i]=new Atalasoft.Annotations.Annotation(r.items[i],qt),qt.annos[o][i]._pageindex=r._index,Ot.trigger({type:Xt.annoload,anno:qt.annos[o][i].getClonedData()}),gt(qt.annos[o][i])}else e.error&&(t.error=e.error);t.offset=e.offset,t.length=e.layers?e.layers.length:0,Ot.trigger(t)}else a(function(){At(e)})}function Dt(e){return e.type="stamp",e.text&&(kt(e.text),e.text.readonly=!0),e}function kt(e){return e&&e.font&&e.font.size&&(e.font.size=parseFloat(e.font.size)),e}function Pt(e){return e.type="image",e}function Vt(e){e.type="custom"}var Rt=Atalasoft.$,Ct=2.1,zt=this,Ot=e,St=t,Wt=new Atalasoft.Annotations.AnnotationSelector,Ft={/** Triggers when the user uses the mouse to click on an annotation. Populated keys: e.anno */
annotationclicked:null,/** Triggers when the user uses the mouse to create an annotation. Populated keys: e.anno */
annotationcreated:null,/** Triggers when the user uses the mouse to double-click on an annotation. Populated keys: e.anno */
annotationdoubleclicked:null,/** Triggers when an annotation is loaded into the document. Populated keys: e.anno */
annotationloaded:null,/** Triggers when the user has depressed a mouse button on an annotation. Populated keys: e.anno */
annotationmousedown:null,/** Triggers when the user has depressed the left mouse button on an annotation. Populated keys: e.anno */
annotationmousedownleft:null,/** Triggers when the user has depressed the right mouse button on an annotation. Populated keys: e.anno */
annotationmousedownright:null,/** Triggers when the user moves the mouse pointer over an annotation. Populated keys: e.anno */
annotationmousemove:null,/** Triggers when the user has moved the mouse pointer out of the bounds of the annotation. Populated keys: e.anno */
annotationmouseout:null,/** Triggers when the user has moved the mouse pointer into the bounds of the annotation. Populated keys: e.anno */
annotationmouseover:null,/** Triggers when the user has released a mouse button on an annotation. Populated keys: e.anno */
annotationmouseup:null,/** Triggers when an annotation has been moved. Populated keys: e.anno */
annotationmoved:null,/** Triggers when an annotation has been rotated. Populated keys: e.anno */
annotationrotated:null,/** Triggers when a pinch gesture has been detected on an annotation. Populated keys: e.anno */
annotationpinchresize:null,/** Triggers when an annotation has been repainted. Populated keys: e.anno */
annotationrepainted:null,/** Triggers when an annotation has been resized. Populated keys: e.anno */
annotationresized:null,/** Triggers when the user right clicks on an annotation. Populated keys: e.anno */
annotationrightclicked:null,/** Triggers when a touch end event has been finished on an annotation. Populated keys: e.anno */
annotationtouchend:null,/** Triggers when a touch move event is happening on an annotation. Populated keys: e.anno */
annotationtouchmove:null,/** Triggers when a touch event has started on an annotation. Populated keys: e.anno */
annotationtouchstart:null,/** Triggers when a layer has been inserted into the document. Populated keys: e.srcurl, e.srcindex, e.index */
layerinserted:null,/** Triggers when a layer has moved from one index to another within the document. Populated keys: e.srcindex, e.destindex */
layermoved:null,/** Triggers when a layer has been removed from the document. Populated keys: e.index */
layerremoved:null,/** Triggers when a layer has been changed. Populated keys: none */
layerschanged:null,/** Triggers when all annotations have been deleted. Populated keys: none */
annotationscleared:null,/** Triggers when an annotation is deleted. Populated keys: e.page, e.index */
annotationdeleted:null,/** Triggers when a user has started drawing an annotation with the mouse or a touch event. Populated keys: e.ann */
annotationdrawstart:null,/** Triggers when a user has finished drawing an annotation with the mouse or a touch event. Populated keys: e.ann */
annotationdrawend:null,/** Triggers when an annotation has started dragging. Populated keys: e.ann */
annotationdragstart:null,/** Triggers when an annotation has finished dragging. Populated keys: e.ann */
annotationdragend:null,/** Triggers when the context menu is shown for an annotation. Event signature: function(event, anno, menu) */
contextmenu:null,/** Triggers when the Raphael dependency has finished loading. Populated keys: none */
raphaelloaded:null},Bt={annotations:{events:Ft,getSelected:Wt.getSelected,selectAll:Wt.selectAll,deselectAll:Wt.deselectAll,selectAllOnPage:Wt.selectPage,deselectAllOnPage:Wt.deselectPage,cancelDraw:dt,getFromPage:I,createOnPage:M,deleteFromPage:U,showEditor:Z,hideEditor:Y,setDefaults:G,setImages:J,setStamps:Q,insertLayer:N,removeLayer:H,moveLayer:q},deselectAll:Wt.deselectAll,createAnnotationOnPage:M,getAnnotationsFromPage:I,deleteAnnotationOnPageAtIndex:U,setAnnotationDefaults:G,setImages:J,setStamps:Q};if(Atalasoft.Annotations.AnnotationController.__exposedApi=Bt.annotations,!e)return null;var Tt=t._config,Et=t._pages,Mt=!1,Ut=null,Lt=null,It=null,jt=null,Nt=[],Ht=null,qt={annos:[],activepage:null,activeanno:null,readonly:n?!0:!1,zoom:Ot.getZoom(),getZoom:St.getPageScale,getViewerTransform:St.getViewerTransform,getPageRotation:St.getPageRotation},Gt={},Qt=!1,Jt=!1,Xt={click:"annotationclicked",dblclick:"annotationdoubleclicked",touchstart:"annotationtouchstart",interactend:"annotationtouchend",touchmove:"annotationtouchmove",pinchmove:"annotationpinchresize",rightclick:"annotationrightclicked",mousedown:"annotationmousedown",mousedownleft:"annotationmousedownleft",mousedownright:"annotationmousedownright",mousemove:"annotationmousemove",mouseout:"annotationmouseout",mouseup:"annotationmouseup",mouseover:"annotationmouseover",annocreate:"annotationcreated",annoload:"annotationloaded",moved:"annotationmoved",rotated:"annotationrotated",annoresized:"annotationresized",repaint:"annotationrepainted",layerinserted:"layerinserted",layerremoved:"layerremoved",layermoved:"layermoved",layerschanged:"layerschanged"};"undefined"==typeof Raphael?(Atalasoft.Utils._scriptLoader=Atalasoft.Utils.__loadDependencies(Tt.scripturl,Tt.allowannotations),Atalasoft.Utils._scriptLoader&&Atalasoft.Utils._scriptLoader.bind({scriptsloaded:r})):r(),p(),zt.addDrawingSurface=f,zt.removeDrawingSurface=g,zt.insertLayer=h,zt.removeLayer=v,zt.moveLayer=m,zt.showLayer=x,zt.clear=T,zt.createAnnotation=E,zt.deleteAnnoOnPage=U,zt.drawAnnotation=at,zt.getAnnosFromPage=I,zt.setStamps=Q,zt.setAnnotationDefaults=G,zt.setImages=J,zt.setCustom=X,zt.dispose=s,/**
	* [Internal] Gets debug info object
	* @returns debug info object if available, otherwise null
	*/
zt.__getDebugInfo=et,/**
	* [Internal] Links the annotation data between two controls
	* @param linker internal object of type __LVlinker
	* @returns undefined
	*/
zt.__linkAnnotations=tt,zt.setViewPort=nt,zt.stringifyChanges=mt,zt.stringifyAnnotationData=yt,zt.createHandlerRequest=_t,zt.makeHandlerRequest=xt,zt.loadAnnotationsUrl=bt,zt.loadAnnotations=At};
Atalasoft.Annotations.Grips=function(t,e){function n(){var e;for(var n in z)if(z.hasOwnProperty(n)){var a=t._paper.rect(0,0,B,B),o=r(a,n);U.push(o),U[z[n]]=o,e=Raphael.matrix(),e.rotate(z[n]),R[n]={x:e.x(1,0),y:e.y(1,0)}}S=i(),_()}function r(t,e){return t.attr({fill:"#FFFFE1",cursor:(e||"ne")+"-resize"}),t.grip=!0,t.rect=t.getBBox(),t.hide(),t.center=function(t,e,n,r){n=n||1;var i=B/n,a=B/n,o=i/2,s=Math.round(i/2)+.5,h=Math.round(a/2)+.5;Atalasoft.Utils.Browser.Explorer&&parseInt(Atalasoft.Utils.Browser.Version,10)>8&&(h-=.5);var u=Math.round(t)-s,x=Math.round(e)-h;this.ellipse?(u+=o,this.attr({cx:u,cy:x,r:o,"stroke-width":1})):this.attr({x:u,y:x,width:i,height:a,"stroke-width":1}),this.node.setAttribute("stroke-width",1),this.transform(r)},e&&(t.d={key:e,n:~e.indexOf("n"),s:~e.indexOf("s"),w:~e.indexOf("w"),e:~e.indexOf("e")},t.mousedown(function(t){return m(t,this.d)})),t}function i(){var e=t._paper.circle(0,0,B/2),n=r(e).attr({fill:"#00FF40",cursor:"pointer"});return n.ellipse=!0,U.push(n),n.mousedown(function(t){return p(t,n)}),n}function a(t){return-1!==j.inArray(t,I)}function o(){for(var t=0;t<I.length;t++)h(I[t]);I.length=0,G.clear(),U.hide()}function s(t){t.getEventObject().bind(Z)}function h(t){t.getEventObject().unbind(Z)}function u(){G.length>0?d():I.length>0?o():U.hide()}function x(t){for(var e in z)z.hasOwnProperty(e)&&P(U[z[e]],t)}function d(){if(G.length>0){var t=1===G.length?I[0].getBox():G.getBBox();Y.x=t.x,Y.y=t.y,Y.width=t.width,Y.height=t.height,Y.x2=t.x+t.width,Y.y2=t.y+t.height,Y.xmid=t.x+t.width/2,Y.ymid=t.y+t.height/2,g()}}function f(t,e,n,r){0===X&&(Y.x=t,Y.width=Math.max(n,1),Y.x2=t+Y.width,Y.xmid=t+Y.width/2),0===A&&(Y.y=e,Y.height=Math.max(r,1),Y.y2=e+Y.height,Y.ymid=e+Y.height/2),g()}function y(){for(var t=0;t<I.length;t++)I[t].transform(Y.x,Y.y,Y.width,Y.height)}function g(){var e=1===G.length,n=Raphael.matrix(),r=1,i="";n.add(V.getViewerTransform(t._index)),e&&(n.add(I[0].getTransform()),r=V.getZoom(t._index),i=n.toTransformString(!0)),U[z.nw].center(Y.x,Y.y,r,i),U[z.ne].center(Y.x2,Y.y,r,i),U[z.sw].center(Y.x,Y.y2,r,i),U[z.se].center(Y.x2,Y.y2,r,i),U[z.n].center(Y.xmid,Y.y,r,i),U[z.w].center(Y.x,Y.ymid,r,i),U[z.e].center(Y.x2,Y.ymid,r,i),U[z.s].center(Y.xmid,Y.y2,r,i);var a=I[0].get();a.rotatable||!a.hasOwnProperty("rotatable")?(S.show(),S.center(Y.xmid,Y.y-E/r,r,i)):S.hide();var o=1===I.length?I[0].get().rotation:0;x(o+V.getPageRotation(t._index))}function c(e){var n=t.offset(),r=Atalasoft.Utils.getSVGOffset(t._paper.canvas,t),i={x:e.pageX-(n.left+r.left),y:e.pageY-(n.top+r.top)};return i}function p(e){if(e.stopPropagation(),1===I.length&&1===G.length){for(var n=0;n<I.length;n++){var r=I[n].get();if(r.hasOwnProperty("rotatable")&&!r.rotatable)return}j.extend(C,Y);var i=I[0].getTransform(),a=i.x(C.xmid,C.ymid);C.ymid=i.y(C.xmid,C.ymid),C.xmid=a,j(t._paper.canvas).bind({mouseup:v,mousemove:l})}}function l(e){e.stopPropagation();var n=k(c(e)),r=180*Math.atan2(n.y-C.ymid,n.x-C.xmid)/Math.PI+90;return 1===I.length&&(I[0].set({rotation:r}),I[0].repaint()),t._grips.repaint(),!1}function v(e){return e.stopPropagation(),j(t._paper.canvas).unbind({mouseup:v,mousemove:l}),1===I.length&&I[0].getEventObject().trigger("rotated"),!1}function m(e,n){if(e.stopPropagation(),!(I.length>1)){for(var r=0;r<I.length;r++)if(!I[r].get("resizable"))return;return j.extend(C,Y),X=z[n.key]===z.n||z[n.key]===z.s?1:0,A=z[n.key]===z.w||z[n.key]===z.e?1:0,(n.n||1===A)&&(C.y=C.y2),n.w&&(C.x=C.x2),j(t._paper.canvas).bind({mouseup:b,mousemove:w}),!1}}function w(t){if(t.stopPropagation(),1===G.length){var e=O(c(t)),n=Math.abs(e.x-C.x),r=Math.abs(e.y-C.y),i=e.x<C.x?C.x-n:C.x,a=e.y<C.y?C.y-r:C.y;f(i,a,n,r),y()}return!1}function b(e){e.stopPropagation();for(var n=0;n<I.length;n++)I[n].getEventObject().trigger("resized"),I[n].getEventObject().trigger("annoresized"),I[n].repaint();return G.length>0&&d(),j(t._paper.canvas).unbind({mouseup:b,mousemove:w}),!1}function O(t){if(1===G.length){var e=G[0].matrix.invert(),n={x:e.x(t.x,t.y),y:e.y(t.x,t.y)};return n}return t}function k(e){var n=V.getViewerTransform(t._index).invert(),r=n.x(e.x,e.y);return e.y=n.y(e.x,e.y),e.x=r,e}function P(t,e){if(t&&t.d&&t.d.key){var n=Raphael.matrix();n.rotate(e);var r={x:n.x(R[t.d.key].x,R[t.d.key].y),y:n.y(R[t.d.key].x,R[t.d.key].y)};for(var i in T)if(T.hasOwnProperty(i)&&M(r,T[i].start,T[i].end)){t.attr({cursor:(T[i].dir||"ne")+"-resize"});break}}}function _(){var t=Raphael.matrix();t.rotate(F,0,0);for(var e=function(e,n){var r={dir:n,start:{x:t.x(R[e].x,R[e].y),y:t.y(R[e].x,R[e].y)},end:{x:t.x(R[n].x,R[n].y),y:t.y(R[n].x,R[n].y)}};return r},n=["e","ne","n","nw","w","sw","s","se"],r=0;r<n.length-1;++r)0===r&&(T[n[r]]=e(n[n.length-1],n[r])),T[n[r+1]]=e(n[r],n[r+1])}function M(t,e,n){function r(t,e){return-t.x*e.y+t.y*e.x>0}return!r(e,t)&&r(n,t)}var A,j=Atalasoft.$,B=8,E=25,F=-22.5,z={e:0,ne:315,n:270,nw:225,w:180,sw:135,s:90,se:45},R={},T={},V=e,U=t._paper.set(),G=t._paper.set(),I=[],S=null,C={},X=null,Y={x:0,y:0,width:1,height:1,x2:1,y2:1},Z={dragstart:function(){},dragmove:function(){U.hide()},moved:function(){u(),U.show();for(var t=0;t<I.length;++t){var e=I[t].get();e.hasOwnProperty("rotatable")&&!e.rotatable&&S.hide()}}};n(),this.push=function(t){a(t)||(I.push(t),G.push(t.getObject()),t.get("selectable")===!0&&s(t),u(),U.toFront(),U.show())},this.contains=a,this.remove=function(t){for(var e=0;e<I.length;e++)I[e]===t&&I.splice(e,1);G.exclude(t.getObject()),h(t)},this.clear=o,this.repaint=u,this.updateCursor=x};
Atalasoft.Annotations.AnnotationSelector=function(e,n){function t(e){x=e}function o(e){P=e}function l(){_=null,x=null,P=null,y.length=0}function r(e,n,t){a(!0,e,n,t)}function i(e,n,t){a(!1,e,n,t)}function a(e,n,t,o){var l,r,i=[].concat(n),a=null;a=f(t),a===t&&(t=a._index),o||g(a||t);for(var c=0;c<i.length;c++)l=i[c],r=A.inArray(l,y[t]),r>=0?e||y[t][r]!==l||y[t].splice(r,1):e&&(y[t]?y[t].push(l):y[t]=[l]),a&&(e?a._grips.push(l):a._grips.remove(l)),l.get("selected")!==e&&l.toggleSelected({append:!0,pageindex:t,page:a})}function c(e,n){var t="object"==typeof n?n._index:n;x[t]&&a(e,x[t],n,!0)}function u(e){for(var n=[],t=0;t<e.length;t++)if(e[t]){n[t]=[];for(var o=0;o<e[t].length;o++)n[t][o]=e[t][o].getClonedData()}return n}function f(e){var n=null;if("object"==typeof e)n=e;else{e=Math.max(e,0);var t=A.grep(P,function(n){return n._index===e});t.length>=1&&(n=t[0])}return n}/**
	* Selects all annotations on the given page.
	* @param fIndex: number, The zero based index of the page the annotations should be selected on.
	* @returns undefined
	*/
function s(e){c(!0,e)}/**
	* Deselects all annotations on the given page.
	* @param fIndex: number, The zero based index of the page the annotations should be deselected on.
	* @returns undefined
	*/
function g(e){var n=f(e);c(!1,n),n._grips.repaint()}/**
	* Selects all annotations on every page.
	* @returns undefined
	*/
function p(){for(var e=0;e<x.length;e++)s(e)}/**
	* Deselects all annotations on every page.
	* @returns undefined
	*/
function d(){for(var e=0;e<x.length;e++)g(e)}/**
	* Gets an array of selected annotation data objects.
	* @returns array containing annotation data objects for selected annotations only.
	*/
function v(){return u(y)}/**
	* Gets an array of all annotation data objects.
	* @returns array of arrays containing annotation data objects for each page of the document.
	*/
function h(){return u(x)}var A=Atalasoft.$,_=this,x=e,P=n,y=[];_.dispose=l,_.select=r,_.deselect=i,_.setAnnos=t,_.setPages=o,_.resolvePage=f,_.deselectAll=d,_.deselectPage=g,_.getAnnotations=h,_.getSelected=v,_.selectAll=p,_.selectPage=s};
Atalasoft.Annotations.Annotation=function(e,t){function n(){e.multiview||A(e.type),p(e,!0),u(),W=new Atalasoft.Annotations.DrawHandler(tt,N,q,$),i({repaint:W.events.update,viewchanged:W.events.viewchanged,drawn:k,resized:c}),tt.points&&(tt.x>0||tt.y>0)&&(_(tt.x,tt.y),tt.x=0,tt.y=0,tt.width=1,tt.height=1),a()}function a(){at={selectable:{selectchange:x},movable:{dragstart:W.events.dragstart,dragmove:W.events.dragmove,dragend:W.events.dragend},resizable:{pinchstart:W.events.pinchstart,pinchmove:W.events.pinchmove,pinchend:W.events.pinchend},boundEvents:{resizable:!1,movable:!1,selectable:!1},isBound:function(e){return this.boundEvents[e]},bound:function(e){this.boundEvents[e]=!0},unbound:function(e){this.boundEvents[e]=!1}}}function o(){tt.selected&&x(),q&&q.unbind(),L&&L.remove(),M&&M.dispose(),Q&&Q.remove(),W&&W.unbindEvents(),W=null,N=null,$=null,q=null,L=null,M=null,Q=null,tt=null}function i(){q.bind.apply(q,arguments)}function l(){q.unbind.apply(q,arguments)}function r(){return q.trigger.apply(q,arguments),$}function s(e,t){var n=(e-t+360)%360,a=Raphael.matrix();a.add(b());var o=T();a.rotate(n,o.x+o.width/2,o.y+o.height/2);var i=a.x(o.x,o.y),l=a.y(o.x,o.y);_(i-o.x,l-o.y),u()}function u(){var e=Raphael.matrix(),t=T();e.rotate(tt.rotation,t.x,t.y),tt.transform=e}function c(){var e=T(),t=J(b(),e);(t.x!==e.x||t.y!==e.y)&&_(t.x-e.x,t.y-e.y)}function d(e,t){if(e){var n=tt.rotation;e.hasOwnProperty("rotation")&&(e.rotation=(e.rotation+360)%360),p(e,t,!1),n!==tt.rotation&&s(tt.rotation,n)}}function p(e,t){t?K.extend(!0,tt,e):K.extend(tt,e)}function f(e){return e?tt[e]:tt}function b(){return tt.transform}function h(){function e(){delete tt.update,delete tt.getPageIndex}Y={/**
            * Updates the annotatin state.
            * @param viewOnly: bool, indicates whether
            *  to update data from this instace or only repaint view.
            */
update:function(t){tt.selected!==Y.selected&&x(),t||d(Y,!0),e(),j(),P(),B()},getPageIndex:function(){return $._pageindex}},K.extend(!0,Y,tt)}function y(){return Y?K.extend(!0,Y,tt):h(),delete Y.transform,Y}function g(){return L}function m(){return q}function v(){return JSON.stringify(tt)}function x(e){if(tt){var t={ann:$,append:!0,page:null,pageindex:$._pageindex,type:""};e&&(t.append=e.shiftKey||e.ctrlKey||"undefined"!=typeof e.append&&e.append,t.page=e.page,t.pageindex=e.pageindex),t.append||!tt.selected?(tt.selected=!tt.selected,t.type=tt.selected?"selected":"deselected"):tt.selected&&!t.append&&(t.type="reselected"),""!==t.type&&r(t)}}function w(e){return Y&&Y===e}function A(e){K.extend(!0,tt,nt[e])}function z(e){var t=null;switch(tt.type){case"image":t=e.image(),t.attr("src",tt.src);break;case"highlight":t=e.rect();break;case"rectangle":t=e.rect();break;case"fillrect":t=e.rect();break;case"text":t=e.rect();break;case"stamp":t=e.rect();break;case"ellipse":t=e.path();break;case"line":t=e.path();break;case"lines":t=e.path();break;case"freehand":t=e.path();break;case"polygon":t=e.path();break;case"custom":X=Atalasoft.Annotations.AnnotationCustomRenderer(tt,q),t=X.construct(e)}return e._annos&&e._annos.push(t),t}function k(){null!==G&&(L?q.unbind(L,G):q.unbind(G));var e={};tt.selectable&&(K.extend(e,at.selectable),at.bound("selectable"),!N.readonly&&tt.movable&&(K.extend(e,at.movable),at.bound("movable")),!N.readonly&&tt.resizable&&Atalasoft.Utils.Browser.Features.Touch&&(K.extend(e,at.resizable),at.bound("resizable"))),G=e,q.bind(L,e)}function B(){null!==G&&(tt.selectable?(at.isBound("selectable")||(q.bind(at.selectable),at.bound("selectable")),tt.movable&&!at.isBound("movable")?(q.bind(at.movable),at.bound("movable")):!tt.movable&&at.isBound("movable")&&(q.unbind(at.movable),at.unbound("movable")),Atalasoft.Utils.Browser.Features.Touch&&(tt.resizable&&!at.isBound("resizable")?(q.bind(at.resizable),at.bound("resizable")):!tt.resizable&&at.isBound("resizable")&&(q.unbind(at.resizable),at.unbound("resizable")))):!tt.selectable&&at.isBound("selectable")&&(q.unbind(at.selectable),at.unbound("selectable"),q.unbind(at.movable),at.unbound("movable"),q.unbind(at.resizable),at.unbound("resizable")))}/**
     * Returns bounding box of the annotation in document space.
    */
function T(){!et&&tt.points&&(et=Atalasoft.Utils.__calcPathBounds(tt.points));var e=tt.points?et:tt;return{x:e.x,y:e.y,width:e.width,height:e.height}}function _(e,t){if(tt.points){for(var n=0;n<tt.points.length;n++)tt.points[n].x+=e,tt.points[n].y+=t;et&&(et.x+=e,et.y+=t)}"custom"!==tt.type&&tt.points||(tt.x+=e,tt.y+=t),u(),I()}function E(e,t,n,a){var o=T(),i=n/o.width,l=a/o.height;if(tt.points&&tt.points.length>0&&"custom"!==tt.type){for(var s=0;s<tt.points.length;s++)tt.points[s].x=e+(tt.points[s].x-o.x)*i,tt.points[s].y=t+(tt.points[s].y-o.y)*l;et.x=e,et.y=t,et.width*=i,et.height*=l}else tt.x=e,tt.y=t,tt.width*=i,tt.height*=l;r({type:"annoresizing"}),I()}function R(){W.transformUI.apply(W,arguments)}function U(){W.commitTransform()}function I(){ot||(ot=!0,setTimeout(O,it))}function O(){ot=!1,P()}function S(e,t,n){d(n),L=z(t),L.transform(W.getTransform()),("text"===tt.type||"stamp"===tt.type)&&(M=new Atalasoft.Annotations.TextAnnotationUI($,t,N)),j(),W.drawStart(e,L,M,X)}function P(e){e&&(Q&&(Q=null),L=z(e),X&&X.render(L,tt),j(),k(),"text"!==tt.type&&"stamp"!==tt.type||null!==M||(M=new Atalasoft.Annotations.TextAnnotationUI($,e,N)),M&&M.changepaper(e),r({type:"viewchanged",annview:L,textview:M})),r("repaint")}function j(){if(L){var e=V();K.extend(e,Z()),L.attr(e),F(),tt.visible?L.show():L.hide()}C(),D()}function C(){M&&(M.set(tt.text),M.updateView())}function D(){L&&""!==tt.src&&"image"===tt.type&&("unknown"!=typeof L.node.src&&L.node.src?L.node.src=tt.src:L.node.href.baseVal=tt.src)}function V(){return{fill:tt.fill.color,"fill-opacity":tt.fill.opacity}}function Z(){var e={stroke:tt.outline.color,"stroke-width":tt.outline.width*N.getZoom($._pageindex),"stroke-opacity":tt.outline.opacity};return L._linewidth=tt.outline.width,Raphael.fn.addArrow||(tt.outline.startcap&&(e["arrow-start"]=H(tt.outline.startcap)),tt.outline.endcap&&(e["arrow-end"]=H(tt.outline.endcap))),e}function F(){Raphael.fn.addArrow&&(tt.outline.startcap&&Raphael.fn.addArrow(L,H(tt.outline.startcap),!1),tt.outline.endcap&&Raphael.fn.addArrow(L,H(tt.outline.endcap),!0))}function H(e){return[e.style,"-",e.width,"-",e.height].join("")}function J(e,t){return{x:e.x(t.x,t.y),y:e.y(t.x,t.y)}}var K=Atalasoft.$,N=t,$=this,q=new Atalasoft.Annotations.EventHelper($),G=null,L=null,M=null,Q=null,W=null,X=null,Y=null,et=null,tt=e.multiview?e:{type:"",x:0,y:0,width:0,height:0,rotation:0,transform:Raphael.matrix(),visible:!0,movable:!0,rotatable:!0,resizable:!0,selected:!1,selectable:!0,readonly:!1,tooltip:"",name:"",username:"",zindex:null,aspectratio:0,fill:{color:"white",opacity:1},outline:{color:"black",opacity:1,width:2},src:"",text:{value:null,align:"left",font:{bold:!1,italic:!1,strike:!1,underline:!1,color:"black",family:"Arial",size:12},readonly:!1,replies:null,parent:null}},nt={highlight:{readonly:!0,fill:{color:"yellow",opacity:.5},outline:{opacity:0}},image:{readonly:!0,fill:{color:null},outline:{opacity:0}},rectangle:{fill:{opacity:0}},stamp:{readonly:!0},line:{fill:{color:null},outline:{opacity:1,startcap:{width:"medium",height:"medium",style:"none"},endcap:{width:"medium",height:"medium",style:"none"}}},lines:{fill:{color:null},outline:{opacity:1}},freehand:{fill:{color:null},outline:{opacity:1}},ellipse:{},fillrect:{},polygon:{},text:{}},at={};n(),$.dispose=o,$.bind=i,$.unbind=l,$.trigger=r,$.set=d,$.get=f,$.getTransform=b,$.getClonedData=y,$.getObject=g,$.getEventObject=m,$.getZoom=function(){return N.getZoom($._pageindex)},$.stringify=v,$.getJSON=v,$.toggleSelected=x,$.isCloneSource=w,$.getBox=T,$.translate=_,$.transform=E,$.transformUI=R,$.commitTransform=U;var ot=!1,it=Atalasoft.Utils.Browser.Explorer?20:5;return $.startDraw=S,$.repaint=P,$.updateView=j,$};
Atalasoft.Annotations.EventHelper=function(t){function n(){P=new Atalasoft.Annotations.PointerHandler,P.bind({click:w,dblclick:A,mousedown:b,mousemove:E,mouseover:k,mouseout:T,mouseup:R,touchmove:X,touchstart:B,interactstart:l,interactend:a,pinchstart:m,pinchmove:f,pinchend:d,selectchange:h,contextmenu:x,showeditor:v,annoresized:Y})}function e(t){$.px=$.mx,$.py=$.my,t.originalEvent?($.mx=t.originalEvent.targetTouches[0].pageX,$.my=t.originalEvent.targetTouches[0].pageY):($.mx=t.targetTouches[0].pageX,$.my=t.targetTouches[0].pageY),$.dx=$.mx-$.px,$.dy=$.my-$.py}function o(t){$.px=$.mx,$.py=$.my,$.mx=t.screenX,$.my=t.screenY,$.dx=$.mx-$.px,$.dy=$.my-$.py}function u(t){var n=arguments;!t||t.constructor.prototype!==Raphael.el&&t.constructor.prototype!==Raphael.st||(t.drag(c,p,s),t.hover(y,g),F(t[0]).bind(P.events),n=Array.prototype.slice.call(n,1)),n.length>0&&U.bind.apply(U,n)}function r(t){var n=arguments;t&&t.constructor.prototype===Raphael.el?(t.undrag(),t.unhover(y,g),F(t[0]).unbind(P.events),n=Array.prototype.slice.call(n,1)):null===t&&n.length>1&&(n=Array.prototype.slice.call(n,1)),U.unbind.apply(U,n)}function i(){U.trigger.apply(U,arguments)}function l(){i({type:"interactstart",target:z})}function a(){i({type:"interactend",target:z})}function c(t,n,u,r,l){(t||n)&&(Atalasoft.Utils.Browser.Features.Touch&&l.target!==$.target||(null===$.px&&p(null,null,l),l.touches?e(l):o(l),i({type:"dragmove",dx:$.dx,dy:$.dy,mx:$.mx,my:$.my,originalEvent:l})))}function p(t,n,u){$.target=u.target,l(),u.touches?e(u):o(u),i({type:"dragstart",mx:$.mx,my:$.my,originalEvent:u})}function s(t){Atalasoft.Utils.Browser.Features.Touch&&t.target!==$.target||($.target=null,$.px=null,$.py=null,$.mx=null,$.my=null,i({type:"dragend",originalEvent:t}))}function y(){i("hoverin")}function g(){i("hoverout")}function m(t){i(t)}function f(t){i(t)}function d(t){$.px=null,$.py=null,i(t)}function h(t){i(t)}function x(t){i(t)}function v(t){i(t)}function w(t){i(t)}function A(t){i(t)}function b(t){i(t),1===t.which?i("mousedownleft"):3===t.which&&i("mousedownright")}function E(t){i(t)}function T(t){i(t)}function k(t){i(t)}function R(t){i(t),3===t.which&&i("rightclick")}function X(t){i(t)}function Y(t){i(t)}function B(t){i(t)}var F=Atalasoft.$,H=this,U=F({}),z=t,P=null,$={target:null,mx:null,my:null,px:null,py:null,dx:null,dy:null};n(),H.bind=u,H.unbind=r,H.trigger=i};
Atalasoft.Annotations.DrawHandler=function(t,e,n,a){function i(){}function r(t){var e=Atalasoft.Utils.getMousePositionJquery(t);if(N.paper){var n=Atalasoft.Utils.getSVGOffset(N.paper.canvas,N.paper._page);e.x-=n.left,e.y-=n.top}return e}function o(t){var e=I.getViewerTransform(H._pageindex).invert(),n=e.x(t.x,t.y);return t.y=e.y(t.x,t.y),t.x=n,t}function s(){L.trigger.apply(L,arguments)}function p(t,e,n,a){N=e,q=n,G=a,t.stopPropagation(),t.preventDefault();var i=o(r(t));F.visible=!0,O={x:i.x,y:i.y},F.x=Math.round(i.x),F.y=Math.round(i.y),F.width=1,F.height=1,"path"===N.type&&"custom"!==F.type?"ellipse"!==F.type?(F.points=[{x:F.x,y:F.y}],("lines"===F.type||"polygon"===F.type)&&F.points.push({x:F.x,y:F.y}),F.x=0,F.y=0,K=h,Q=P):(K=c,Q=U):(K=c,Q=T),A(),J={events:Atalasoft.Utils.Browser.Features.Touch?{touchend:y,touchmove:l,mouseup:y,mousemove:l}:{mouseup:y,mousemove:l},src:Z(t.srcElement||t.target),main:Z(t.currentTarget)},J.src.bind(J.events),J.main.bind({mouseup:y})}function u(){J&&(J.src.unbind(J.events),J.main.unbind({mouseup:y}))}function l(t){t.stopPropagation(),K(t),A()}function h(t){var e=o(r(t));switch(F.type){case"line":F.points[1]=e;break;case"freehand":F.points.push(e);break;case"lines":F.points[F.points.length-1]=e;break;case"polygon":F.points[F.points.length-1]=e}"path"===N.type&&("ellipse"===F.type?C():E(),N._&&0===N._.dirty&&(N._.dirty=1))}function c(t){var e=o(r(t)),n=O.x,a=O.y,i=Math.max(Math.abs(e.x-O.x),1),s=Math.max(Math.abs(e.y-O.y),1);if(F.aspectratio>0){var p=Math.abs((e.y-O.y)/(e.x-O.x));p>1/F.aspectratio?i=Math.round(s/F.aspectratio):s=Math.round(i/F.aspectratio)}e.x<O.x&&(n=O.x-i),e.y<O.y&&(a=O.y-s),F.x=n,F.y=a,F.width=i,F.height=s}function y(t){t.stopPropagation();var e=!1;if("lines"===F.type||"polygon"===F.type){if(I.activepage._index!==H._pageindex)return;if(F.points.push(o(r(t))),2!==t.button)return}else F.points?F.points&&F.points.length<2&&"custom"!==F.type&&(e=!0):(F.width<4&&F.height<4&&(F.width=100,F.height=100),A());u(),J=null,e?s("cancelled"):s("drawn")}function d(t){if(!I.readonly){t.originalEvent.stopPropagation();var e=H.getBox();O={x:e.x,y:e.y}}}function x(t){if(!I.readonly){t.originalEvent.stopPropagation();var e=o({x:0,y:0}),n=o({x:t.dx,y:t.dy});H.translate(n.x-e.x,n.y-e.y),s("moving")}}function f(t){if(!I.readonly){t.originalEvent.stopPropagation();var e=H.getBox();if(N.paper&&N.paper._page){var n=N.getBBox(),a={x:0,y:0,width:N.paper._page.width(),height:N.paper._page.height()};if(!S(a,n))return H.translate(O.x-e.x,O.y-e.y),void 0}(O.x!==e.x||O.y!==e.y)&&s("moved")}}function g(t){if(!F.points&&!I.readonly){var e=o({x:t.touches[0].clientX,y:t.touches[0].clientY}),n=o({x:t.touches[1].clientX,y:t.touches[1].clientY}),a=H.getBox();j={start:Atalasoft.Utils.CalcDistance(e.x,e.y,n.x,n.y),rect:a}}}function v(t){if(j){var e=o({x:t.touches[0].clientX,y:t.touches[0].clientY}),n=o({x:t.touches[1].clientX,y:t.touches[1].clientY}),a=Atalasoft.Utils.CalcDistance(e.x,e.y,n.x,n.y,j.start),i=a.x-j.start.x,r=a.y-j.start.y,s=j.rect.x-a.dx,p=j.rect.y-a.dy,u=j.rect.width+i,l=j.rect.height+r;F.points?H.transform(s,p,u,l):(F.x=s,F.y=p,F.width=u,F.height=l),N.paper&&N.paper._page&&N.paper._page._grips&&N.paper._page._grips.repaint(),A()}}function m(){s("resized"),s("annoresized"),j=null}function w(){A()}function _(t){N=t.annview,q=t.textview,"path"===N.type&&"custom"!==F.type?"ellipse"!==F.type?(K=h,Q=P):(K=c,Q=U):(K=c,Q=T)}function b(){N.transform($.toTransformString()),q&&q.repaint()}function M(){N.transform(B()),A()}function A(){Q(),N&&N.transform(B()),q&&q.repaint()}function B(){var t=Raphael.matrix();return t.add(I.getViewerTransform(H._pageindex)),t.add(H.getTransform()),t.toTransformString()}function T(){N.attr({x:F.x,y:F.y,width:F.width,height:F.height}),G&&G.render(N,F),Atalasoft.Utils.Browser.Features.VML&&N.transform(B())}function U(){C(),N._&&0===N._.dirty&&(N._.dirty=1)}function P(){E(),N._&&0===N._.dirty&&(N._.dirty=1)}function C(){var t=F.width/2,e=F.height/2,n=W*t,a=W*e,i=F.x+F.width/2,r=F.y+F.height/2,o=["M",i,r-e,"C",i+n,r-e,i+t,r-a,i+t,r,"C",i+t,r+a,i+n,r+e,i,r+e,"C",i-n,r+e,i-t,r+a,i-t,r,"C",i-t,r-a,i-n,r-e,i,r-e,"Z"];N.attr({path:o})}function E(){for(var t=["M",F.points[0].x,F.points[0].y],e=1;e<F.points.length;e++)t=t.concat(["L",F.points[e].x,F.points[e].y]);"polygon"===F.type&&t.push("Z"),N.attr({path:t}),V()}/**
	* Work around outlined by this post:
	* http://stackoverflow.com/questions/15693178/svg-line-markers-not-updating-when-line-moves-in-ie10
	*/
function V(){if(Atalasoft.Utils.Browser.Explorer){var t=parseInt(Atalasoft.Utils.Browser.Version,10);t>=10&&12>t&&N.node&&N.node.parentNode&&N.node.parentNode.insertBefore(N.node,N.node)}}function D(){Z.extend(F,k($,I.getZoom(H._pageindex))),M(),te=null}function R(t,e,n,a){$=Raphael.matrix(n,0,0,a,t,e),te||(te=Y(F,1)),$.add(te),b()}function S(t,e){return X(t,e.x,e.y)||X(t,e.x+e.width,e.y)||X(t,e.x,e.y+e.height)||X(t,e.x+e.width,e.y+e.height)}function X(t,e,n){return e>=t.x&&e<=t.x+t.width&&n>=t.y&&n<=t.y+t.height}function Y(t,e){var n;if(t.points&&t.points.length>1){var a=H.getBox();n=Raphael.matrix(1,0,0,1,0,0),n.scale(1/a.width,1/a.height,0,0),n.translate(-a.x,-a.y)}else n=Raphael.matrix(e,0,0,e,0,0),n.translate(t.x,t.y),n.scale(t.width,t.height,0,0);return n}function k(t,e){var n=t.split(),a={x:n.dx/e,y:n.dy/e,width:n.scalex/e,height:n.scaley/e};return a}var Z=Atalasoft.$,z=this,F=t,I=e,L=n,N=null,q=null,G=null,H=a,J=null,O=null,$=null,j=null,K=function(){},Q=function(){};z.events={drawstart:p,drawmove:l,drawend:y,dragstart:d,dragmove:x,dragend:f,update:w,viewchanged:_,pinchstart:g,pinchmove:v,pinchend:m},i(),z.drawStart=p,z.unbindEvents=u,z.repaint=A,z.getTransform=B;var W=.5522847498307936;z.commitTransform=D,z.transformUI=R;var te=null};
/**
* Mouse and Touch event handler for annotations
*/
Atalasoft.Annotations.PointerHandler=function(){function t(){return M.bind.apply(M,arguments),w}function n(){return M.unbind.apply(M,arguments),w}function e(){M.trigger.apply(M,arguments)}function o(){e({type:"interactstart"})}function i(){e({type:"interactend"})}function u(t){e(t)}function a(t){e(t);var n=Atalasoft.Utils.getMousePositionJquery(t);e({type:"showeditor",x:n.x,y:n.y})}function c(t){return o(),e(t),e({type:"selectchange",shiftKey:t.shiftKey,ctrlKey:t.ctrlKey}),3===t.which&&e({type:"contextmenu",x:t.pageX,y:t.pageY,event:t}),!1}function s(t){e(t)}function r(t){e(t)}function l(t){e(t)}function p(t){e(t),i()}function h(t){t.stopPropagation(),t.preventDefault(),K.pinching=!0,e({type:"pinchstart",touches:t.originalEvent.touches})}function g(t){t.stopPropagation(),t.preventDefault(),e({type:"pinchmove",touches:t.originalEvent.touches})}function f(t){t.stopPropagation(),t.preventDefault(),K.pinching=!1,e({type:"pinchend",touches:t.originalEvent.touches}),1===t.originalEvent.touches.length&&y(t)}function y(t){if(K.e=t,o(),e(t),2===t.originalEvent.touches.length&&b(t.originalEvent.touches))P(),K.touching=!1,h(t);else if(1===t.originalEvent.touches.length){e("selectchange"),K.touching=!0;var n=Atalasoft.Utils.getMousePositionJquery(t);K.point.x=n.x,K.point.y=n.y,K.hold=setTimeout(E,1500)}}function v(t){K.e=t,e(t),K.pinching?g(t):K.moves++}function d(t){K.e=t,e(t),K.pinching?f(t):K.touching&&(K.touching=!1,P(),K.moves>0?K.moves=0:K.tapped?x(t):(K.tapped=!0,setTimeout(m,300))),i()}function m(){K.tapped=!1}function x(t){K.e=t,e({type:"showeditor",x:K.point.x,y:K.point.y})}function E(){if(K.moves>0&&null!==K.e){var t=Atalasoft.Utils.getMousePositionJquery(K.e);Math.abs(K.point.x-t.x)<5&&Math.abs(K.point.y-t.y)<5&&(K.moves=0)}0===K.moves&&K.touching&&K.e&&(K.touching=!1,e({type:"contextmenu",x:K.e.originalEvent.touches[0].pageX,y:K.e.originalEvent.touches[0].pageY}))}function P(){null!==K.hold&&(clearTimeout(K.hold),K.hold=null)}function b(t){for(var n=null,e=0;e<t.length;e++){var o=t[e].target;if(!o||!o.raphael&&!o.raphaelParent)return!1;if(null===n)n=o;else if(n!==o)return!1}return!0}var A=Atalasoft.$,w=this,M=A({}),K={drawing:!1,hold:null,pinching:!1,tapped:!1,touching:!1,delta:{x:0,y:0},origin:{x:0,y:0},point:{x:0,y:0},moves:0,e:null};w.events={click:u,dblclick:a,mousedown:c,mousemove:s,mouseout:r,mouseover:l,mouseup:p},Atalasoft.Utils.Browser.Features.Touch&&A.extend(!0,w.events,{touchstart:y,touchmove:v,touchend:d}),w.bind=t,w.unbind=n,w.trigger=e};
Atalasoft.Annotations.FontUI=function(n,t){function o(){e(n)}function i(){h=null,w=null,A=null}function e(n){n&&m.extend(A,n),r()}function l(n){return n?A[n]:A}function r(n,t,o){n=n?n:w,n&&(t=void 0!==t?t:g,o||s(),u(n,t))}function u(n,t){var o="none";(A.strike||A.underline)&&(o=A.strike?"line-through ":"",o+=A.underline?"underline":""),n.css({color:A.color,"font-family":A.family,"font-style":A.italic?"italic":"normal","font-weight":A.bold?"bold":"normal","font-size":A.size*(t||1)+"px","text-decoration":o})}function s(){var n=document.width||window.outerWidth,t=n/window.innerWidth;p!==t&&(p=t),g=A.size*y<z?z/p/A.size:y}function a(){return s(),g}function f(){return s(),p}function c(){return y}function d(n){y=n,r()}var m=Atalasoft.$,h=this,w=t,A={bold:!1,italic:!1,strike:!1,underline:!1,color:"#000000",family:"Arial",size:12},g=1,y=1,p=1,z=Atalasoft.Utils.Browser.Mobile.Any()?18:8;o(),h.dispose=i,h.set=e,h.get=l,h.repaint=r,h.applyTo=u,h.getAdjustedZoom=a,h.getUserZoom=f,h.getZoom=c,h.setZoom=d};
Atalasoft.Annotations.AnnotationTextRenderer=function(t,e){function n(){o(),x=h("<canvas "+(g?'dir="rtl"':"")+"/>"),c=h('<span style="position:absolute; visibility:hidden; left: -5000px;">{[|,0123456789Thqkbfjplyg</span>'),h(document.body).append(c)}function o(){var t,e=document.body;e.currentStyle?t=e.currentStyle.direction:window.getComputedStyle&&(t=document.defaultView.getComputedStyle(e,null).getPropertyValue("direction")),"rtl"===t.toLowerCase()&&(g=!0)}function i(){f=null,p=null,d=null,x&&x.remove&&(x.remove(),x=null),c&&c.remove&&(c.remove(),c=null)}function l(t){x&&c||n(),d.applyTo(c),x[0].width=t.width,x[0].height=t.height;var e=x[0].getContext("2d"),o=[p.text.font.italic?"italic":"normal",p.text.font.bold?"bold":"normal",p.text.font.size+"px",p.text.font.family];e.font=o.join(" "),e.fillStyle=p.text.font.color,e.textAlign="start",e.textBaseline="top";for(var i=a(e,p.text.value,t.width),l=0,r=u(),s=e.measureText(p.text.value).width,h=g?t.width:0,f=0;f<i.length;f++)e.fillText(i[f],h,l,s),l+=r;return x[0].toDataURL()}function r(t,e){t.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",l(e))}function u(){return d.applyTo(c,1),c[0].offsetHeight}function a(t,e,n){var o=[],i=[];if("string"==typeof e){for(var l="\n",r=e,u=n,a=s(r),f="",p="",d=0;d<a.length;d++)if(f=p,p=a[d],t.measureText(p).width>u)for(var x=p.split(""),c=0;c<x.length;c++)i.push(x[c]),t.measureText(i.join("")).width>u&&(i.pop(),o.push(i.join("")),i.length=0,i.push(x[c]));else i.push(p),(t.measureText(h.trim(i.join(""))).width>u||f.indexOf(l)>=0)&&(i.pop(),o.push(i.join("")),i.length=0,i.push(p));i.length>0&&(o.push(i.join("")),i.length=0)}return o}function s(t){for(var e=[],n="",o=0,i=0;i<t.length;i++){var l=t[i];m[n]&&(e.push(t.substr(o,i-o)),o=i),n=l}return i>o&&e.push(t.substr(o,i-o)),e}var h=Atalasoft.$,f=this,p=t,d=e,x=null,c=null,g=!1,m={" ":!0,"-":!0,"?":!0,"\n":!0,"	":!0};f.dispose=i,f.renderToDataURL=l,f.renderToSVGImage=r};
Atalasoft.Annotations.AnnotationCustomRenderer=function(n,r){function t(){p=g.constructor?g.constructor:s,b=g.renderer?g.renderer:a}function u(){m=null,g=null,p=null,b=null}function e(){return y.bind.apply(y,arguments),m}function o(){return y.unbind.apply(y,arguments),m}function c(){return y.trigger.apply(y,arguments),m}function i(n){return p(n,g)}function l(n){b(n,g)}function s(n){return n.image()}function a(n){g.customurl?n.attr("src",g.customurl):f()}function f(){c("serverrenderurlrequested",{data:g,complete:d})}function d(n){n.customurl=n}var m=this,g=n,p=null,b=null,y=r;return m.dispose=u,m.bind=e,m.unbind=o,m.trigger=c,m.construct=i,m.render=l,t(),m};
Atalasoft.Annotations.PathHelper=function(n){function o(){A.points&&(A.points.length=0)}function t(){v=null,A=null,m.length=0,m=null}function c(n,o,t){m=m.concat([t?"m":"M",n,o]),p(n,o)}function i(n,o,t){m=m.concat([t?"l":"L",n,o]),p(n,o)}function u(n,o){m=m.concat([o?"h":"H",n]),p(n,null)}function l(n,o){m=m.concat([o?"v":"V",n]),p(null,n)}function a(n,o,t,c,i,u,l){m=m.concat([l?"c":"C",n,o,t,c,i,u]),p(i,u)}function e(n,o,t,c,i){m=m.concat([i?"s":"S",n,o,t,c])}function r(n,o,t,c,i){m=m.concat([i?"q":"Q",n,o,t,c])}function f(n,o,t){m=m.concat([t?"t":"T",n,o])}function s(n,o,t,c,i,u,l,a){m=m.concat([a?"a":"A",n,o,t,c,i,u,l])}function h(){m.push("Z")}function T(){return m}function p(n,o){A.points.push({x:n,y:o})}var v=this,A=n,m=[];return v.dispose=t,v.moveTo=c,v.lineTo=i,v.lineToHorizontal=u,v.lineToVertical=l,v.curveTo=a,v.curveToSmooth=e,v.curveToQuadratic=r,v.curveToQuadraticSmooth=f,v.ellipticalArc=s,v.close=h,v.toArray=T,o(),v};
Atalasoft.Forms.Field=function(e,t,n){function i(){Atalasoft.Forms.Field.__staticInitOccured||(Atalasoft.Forms.Field.__staticInitOccured=!0,Atalasoft.Utils.Browser.Explorer&&Atalasoft.Utils.Browser.Version<=9&&!function(){var e=null,t=null,n=null,i={get:function(){return n.get.call(this)},set:function(e){t=e,n.set.call(this,e)}},a=function(n){if("value"===n.propertyName){var i=n.srcElement.value;i!==t&&(t=i,null!=R(n.srcElement).data("ataladata")&&R(e).trigger("input"))}},o=function(o){e=o,t=o.value,n=Object.getOwnPropertyDescriptor(o.constructor.prototype,"value"),Object.defineProperty(e,"value",i),e.attachEvent("onpropertychange",a)},r=function(){e&&(delete e.value,e.detachEvent("onpropertychange",a),e=null,t=null,n=null)};R(document).on("focusin",function(e){("TEXTAREA"===e.target.nodeName||"INPUT"===e.target.nodeName&&("text"===e.target.type||"password"===e.target.type))&&(r(),o(e.target))}),R(document).on("focusout",function(){r()}),R(document).on("selectionchange keyup keydown",function(n){e&&e.value!==t&&(t=e.value,null!=R(n.srcElement).data("ataladata")&&R(e).trigger("input"))})}())}function a(){V._pageindex=n,o(e.type),c(e,!0)}function o(e){R.extend(!0,W,L[e])}function r(){j&&j.unbind(),H=null,V=null,j=null,W=null}function l(){j.bind.apply(j,arguments)}function s(){j.unbind.apply(j,arguments)}function u(){return j.trigger.apply(j,arguments),V}function c(e,t){e&&(t?R.extend(!0,W,e):R.extend(W,e))}function d(e){return e?W[e]:W}function g(e){J=e,V.hasOwnProperty("_pageindex")&&(V._pageindex=e)}function f(){function e(){delete W.update}D={update:function(){R.extend(!0,W,D),e(),S(),B(),w()}},R.extend(!0,D,W)}function h(){return D?R.extend(!0,D,W):f(),D}function p(){return Z}function x(){return j}function b(){return JSON.stringify(W)}function m(e){var t,n,i,a,o,r=0,l=0;return"number"==typeof e.selectionStart&&"number"==typeof e.selectionEnd?(r=e.selectionStart,l=e.selectionEnd):(n=document.selection.createRange(),n&&n.parentElement()===e&&(a=e.value.length,t=e.value.replace(/\r\n/g,"\n"),i=e.createTextRange(),i.moveToBookmark(n.getBookmark()),o=e.createTextRange(),o.collapse(!1),i.compareEndPoints("StartToEnd",o)>-1?r=l=a:(r=-i.moveStart("character",-a),r+=t.slice(0,r).split("\n").length-1,i.compareEndPoints("EndToEnd",o)>-1?l=a:(l=-i.moveEnd("character",-a),l+=t.slice(0,l).split("\n").length-1)))),{start:r,end:l}}function v(e,t){return t-(e.value.slice(0,t).split("\r\n").length-1)}function y(e,t){if("number"==typeof e.selectionStart&&"number"==typeof e.selectionEnd)e.selectionStart=t.start,e.selectionEnd=t.end;else{var n=e.createTextRange(),i=v(e,t.start);n.collapse(!0),t.start===t.end?n.move("character",i):(n.moveEnd("character",v(e,t.end)),n.moveStart("character",i)),n.select()}}function k(e){var t=null;switch(W.type){case"button":t=R("<button/>"),t.click(function(){return u({type:"buttonclicked",name:W.fieldname}),!1});break;case"textbox":case"signature":t=W.text.multiline?R('<textarea style="overflow-y:'+(W.text.scrollable?"auto":"hidden")+';resize:none"></textarea>'):R('<input type="text" />'),W.text.value=t.val(W.text.value).val();var n=!1;t.on("paste",function(){return n=!0,!0}),t.on("input",function(e){-1===W.text.maximumfieldheight&&(W.text.maximumfieldheight=R(this).get(0).scrollHeight);var t=W.text.maxlength>0&&R(this).val().length>W.text.maxlength,i=!W.text.scrollable&&R(this).get(0).scrollHeight>W.text.maximumfieldheight,a=R(this).val().length>W.text.value.length;if(a&&(t||i)){var o=m(e.target);if(n&&W.text.maxlength>0){var r=R(this).val(),l=r.length===o.start;if(l)R(this).val(r.substr(0,W.text.maxlength));else{var s=r.length-W.text.value.length,u=W.text.maxlength-W.text.value.length,c=r.substr(0,o.start-s+u),d=W.text.value.substr(o.start-s);R(this).val(c+d),y(e.target,{start:c.length,end:c.length})}}else R(this).val(W.text.value),y(e.target,{start:o.start-1,end:o.start-1})}!W.text.preserveoverflow&&R(this).get(0).scrollHeight<W.text.maximumfieldheight&&(W.text.maximumfieldheight=R(this).get(0).scrollHeight),W.text.value=R(this).val(),n=!1});break;case"checkbox":t=R('<input type="checkbox" />').prop({name:W.group,checked:W.checked}),t.val(W.value);break;case"radio":t=R('<input type="radio" />').prop({name:W.group,checked:W.checked}),t.val(W.value);break;case"choice":if(t=R("<select></select>"),t.text(W.value),t.attr({multiple:W.multiple,size:W.multiline&&W.items?W.items.length:0}),W.items){t.items=[];for(var i in W.items)if(W.items.hasOwnProperty(i)){var a=R("<option></option>",{selected:W.items[i].checked,value:W.items[i].value,text:W.items[i].text});t.append(a),t.items[i]=a}}if(W.multiline&&W.items){var o=function(){R(this).trigger("change")};t.bind({mouseup:o,touchend:o})}break;case"generic":t=R("<div></div>")}if(t){if("textbox"===W.type||"signature"===W.type){var r=W.text.font.paddingtop,l=W.text.font.linespacing>0?W.text.font.linespacing+"px":"1.14pt";t.css({resize:"none",position:"absolute",paddingTop:W.multiline?r:0,paddingBottom:W.multiline?"2pt":0,lineHeight:l,margin:0,"-webkit-box-sizing":"border-box","-moz-box-sizing":"border-box","box-sizing":"border-box"})}else t.css({resize:"none",position:"absolute",padding:0,margin:0,"-webkit-box-sizing":"border-box","-moz-box-sizing":"border-box","box-sizing":"border-box"});t.bind({click:Atalasoft.Utils.__sp,mousedown:Atalasoft.Utils.__sp,mouseup:Atalasoft.Utils.__sp,change:A,uncheck:_,focusin:O,focusout:P})}return e._fields&&e._fields.push(t),Atalasoft.Utils.Browser.Explorer&&Atalasoft.Utils.Browser.Version<=9&&t.data("ataladata",{}),e.append(t),t}function w(){null!==M&&(W.selectable?(X.isBound("selectable")||(j.bind(X.selectable),X.bound("selectable")),W.movable&&!X.isBound("movable")?(j.bind(X.movable),X.bound("movable")):!W.movable&&X.isBound("movable")&&(j.unbind(X.movable),X.unbound("movable")),Atalasoft.Utils.Browser.Features.Touch&&(W.resizable&&!X.isBound("resizable")?(j.bind(X.resizable),X.bound("resizable")):!W.resizable&&X.isBound("resizable")&&(j.unbind(X.resizable),X.unbound("resizable")))):!W.selectable&&X.isBound("selectable")&&(j.unbind(X.selectable),X.unbound("selectable"),j.unbind(X.movable),X.unbound("movable"),j.unbind(X.resizable),X.unbound("resizable")))}function z(){var e=W.fieldname.lastIndexOf(".");return e>=0?W.fieldname.substr(0,e):null}function E(){var e=W.fieldname.lastIndexOf(".");return e>=0?W.fieldname.substr(e+1):W.fieldname}function A(e){switch(W.type){case"button":break;case"textbox":case"signature":W.text.value=this.value;var t=z(W);if(H.multiviewFields.hasOwnProperty(t)){var n=H.multiviewFields[t];for(var i in n)if(n.hasOwnProperty(i)){var a=n[i];if(a!==V){var o=a.get();o.text.value=this.value,a.updateView()}}}break;case"checkbox":W.checked=this.checked,W.group&&W.checked&&(R('input[name="'+W.group+'"]').trigger("uncheck"),W.checked=!0,this.checked=!0);break;case"radio":W.group&&R('input[name="'+W.group+'"]').trigger("uncheck"),W.checked=this.checked;break;case"choice":var r=[];if("undefined"!=typeof e.target.selectedOptions)r=e.target.selectedOptions;else if(e.target.multiple)for(var l=0;l<e.target.options.length;l++)e.target.options[l].selected&&r.push(e.target.options[l]);else e.target.selectedIndex>=0&&r.push(e.target.options[e.target.selectedIndex]);for(var s in W.items)if(W.items.hasOwnProperty(s)){var u=W.items[s];u.checked=!1;for(var c in r)if(r.hasOwnProperty(c)){var d=r[c];d.value===u.value&&(u.checked=!0)}}}}function _(e){"checkbox"===e.target.type&&(e.target.checked=!1),W.checked=!1}function O(){U(!0),u({type:"fieldfocusin",field:V})}function P(){U(!1),u({type:"fieldfocusout",field:V})}function B(e){e&&(Z=k(e),Z.zoom=q,S(),u({type:"viewchanged",fieldview:Z})),u("repaint")}function S(){if(Z){if(W.hidden||W.noview)return Z.hide(),void 0;Z.show();var e=R.extend({},F(),T());Z.css(e),I(),N(),"textbox"===W.type?U(Z.is(":focus")):"button"===W.type&&Z.text(W.text.value)}}function T(){var e=W.border&&"underline"===W.border.style;return{backgroundColor:W.backgroundcolor,color:W.color||W.text.font.color,borderStyle:W.border&&W.border.style&&!e?W.border.style:"none",borderBottomStyle:e?"solid":"inherit",borderColor:W.border?W.border.color:null,fontFamily:W.text.font.family,fontStyle:W.text.font.italic?"italic":W.text.font.oblique?"oblique":"normal",fontWeight:W.text.font.bold?"bold":"",textAlign:W.text.align}}function F(){var e=H.getViewerTransform(J),t=C(e,W.x,W.y),n=C(e,W.x+W.width,W.y+W.height),i=H.getZoom(J),a=W.width*i,o=W.height*i,r={x:(t.x+n.x-a)/2,y:(t.y+n.y-o)/2},l=H.getPageRotation(J)+W.rotation,s="rotate("+l+"deg)",u={left:Math.round(r.x)+"px",top:Math.round(r.y)+"px",width:a+"px",height:o+"px","max-width":a+"px","max-height":o+"px"},c=0!==l?Atalasoft.Utils.__htmlTransformStyle(s):Atalasoft.Utils.__htmlTransformStyle("");return R.extend(u,c),("textbox"===W.type||"signature"===W.type)&&(u.cursor=l%180===0?"text":"vertical-text"),u.visibility=Atalasoft.Utils.Browser.Explorer8&&l%180!==0?"hidden":"visible",u}function U(e){"textbox"===W.type&&(e||(W.text.value?Z.val()!==W.text.value&&Z.val(W.text.value):Z.val(W.text.defaultvalue)))}function I(){H.highlighted?(Z.addClass("atala-ui-form-highlight"),W.required?Z.addClass("atala-ui-form-required"):Z.removeClass("atala-ui-form-required")):Z.removeClass("atala-ui-form-highlight")}function N(){W.readonly?Z.attr("readonly","readonly"):Z.removeAttr("readonly")}function q(e){e=e||H.getZoom(J),Z.css({fontSize:Math.round((W.text.font.size||12)*e*(H.dpi/96)),borderWidth:W.border?Math.round(W.border.width*e):0}),W.text&&W.text.align&&Z.css({paddingLeft:W.text.leftPadding*e+"px",paddingRight:W.text.rightPadding*e+"px"}),S()}function C(e,t,n){return{x:e.x(t,n),y:e.y(t,n)}}var R=Atalasoft.$,H=t,V=this,j=R({}),M=null,Z=null,D=null,J=n,W={type:"",backgroundcolor:"",color:null,fieldname:"",hidden:!1,isfieldrequired:!1,items:null,locked:!1,norotate:!1,noview:!1,nozoom:!1,readonly:!1,required:!1,x:0,y:0,width:0,height:0,rotation:0,border:{color:"#000",style:"none",radius:{vertical:0,horizontal:0},width:0},text:{value:null,align:"left",font:{bold:!1,italic:!1,strike:!1,underline:!1,color:"black",family:"Arial",size:12,paddingtop:0,linespacing:0},ismultiline:!1,ispassword:!1,isrichtext:!1,scrollable:!1,maxlength:0,maximumfieldheight:-1,preserveoverflow:!1}},L={button:{},checkbox:{checked:!1,group:null},radio:{checked:!1,group:null},textbox:{text:{leftPadding:2,rightPadding:2,preserveoverflow:!1}},signature:{text:{leftPadding:2,rightPadding:2,preserveoverflow:!1}},choice:{multiline:!1}},X={};return i(),a(),V.dispose=r,V.bind=l,V.unbind=s,V.trigger=u,V.set=c,V.get=d,V.setPageIndex=g,V.getClonedData=h,V.getObject=p,V.getEventObject=x,V.getZoom=function(){return H.zoom},V.stringify=b,V.getJSON=b,V.getParentName=z,V.getName=E,V.repaint=B,V.updateView=S,V.zoom=q,V},Atalasoft.Forms.Field.__staticInitOccured=!1;
Atalasoft.Forms.FormController=function(e,i,t){function l(){ti.bind({pagerecycled:h,pageshown:p,zoomchanged:f,pagerotated:F}),li._state.initialized?n():ti.bind({initialized:n})}function n(){ri=!0}function o(){ii=null,ti=null,li=null,oi=null,fi=null,di.fields.length=0,di.multiviewFields=null,di.activepage=null,di.activefield=null}function r(){"Atalasoft.Controls.WebDocumentViewer"===ti.typeOf&&ei.extend(ti,ni)}function f(){}function d(e){if(e instanceof jQuery){e._form=li.createDiv(e),e._form.css({position:"absolute",zIndex:4}),e._form._fields=[],e._form._page=e;var i=function(){w(e)};return e.bind("mousedown",i),Atalasoft.Utils.Browser.Features.Touch&&e.bind("touchstart",i),e.bind({pageresize:function(i){i.page=e,_(i)},pagezoom:function(i){i.page=e,y(i)}}),!0}return!1}function a(e,i,t){if(null==e&&"number"==typeof i&&(i=s(i)),i=i||[],null==t?t=di.fields.length:0>t&&(t=0),t>di.fields.length){var l=di.fields.length;di.fields[t]=i;for(var n=l;n<di.fields.length;++n)di.fields[n]||(di.fields[n]=[])}else di.fields.splice(t,0,i)}function s(e){return e<di.fields.length?di.fields.splice(e,1)[0]:null}function u(e,i){a(null,s(e),i)}function c(e){return e instanceof jQuery?(e._form&&(e._form._fields=null,e._form._page=null,e._form=null),!0):!1}function g(e,i){if(e<di.fields.length&&di.fields[e]&&di.fields[e].length){var t;m(i);for(var l=0;l<di.fields[e].length;l++)t=di.fields[e][l],t.setPageIndex(e),t.repaint(i._form)}}function m(e){e._form&&e._form._fields&&(e._form._fields.length=0,e._form.empty())}function p(e){g(e.index,e.page)}function v(){null!=ci.field&&ci.field.getObject()[0].blur()}function h(e){e.page._form&&m(e.page)}function _(e){b(e.page)}function w(e){di.activepage=e}function y(e){for(var i in e.page._form._fields)e.page._form._fields.hasOwnProperty(i)&&e.page._form._fields[i].zoom(li.getPageScale(e.index))}function F(e){b(e.page)}function b(e){if(e&&di.fields.length&&di.fields[e._index])for(var i=0;i<di.fields[e._index].length;i++)di.fields[e._index][i].updateView()}/**
	* Creates a field on the desired page with the given field data.
	* @param fConfig: object, Key value pairs representing field data.
	* @param pgNum: number, The zero based index of the page the field should be created on.
	* @param callback: function, Function to be called when the operation has completed.
	* @returns object, Key value pairs representing field data.
	*/
function x(e,i,t){var l=B(e,i,t).getClonedData();return ti.trigger({type:gi.fieldcreate,field:l}),l}/**
	* Deletes a field on the given z-index and zero based page index.
	* @param pgNum: number, Zero based page index the field is located on.
	* @param fieldIndex: number, Zero based z-index of the field.
	*/
function A(e,i){V(i,e)}/**
	* Gets an array of field data objects located on the given zero based page index.
	* @param pageNum: number, Zero based page index the fields are located on.
	* @returns array: Array of field data objects on the given page index. 
	*/
function P(e){var i=[];if(0===di.fields.length||"undefined"==typeof di.fields[e])return i;for(var t=0;t<di.fields[e].length;t++)i[t]=di.fields[e][t].getClonedData();return i}/**
	* Inserts a form from the source URL and index into the given page index.
	* @param sourceUrl: string, Url of the desired form.
	* @param sourceIndex: number, Zero based page index the form is copied from.
	* @param index: number, Zero based page index the form is to be inserted into.
	* @param callback: function, Function to be called when the operation has completed.
	*/
function k(e,i,t,l){a(e,i,t),"function"==typeof l&&l(),ti.trigger({type:gi.forminserted,srcurl:e,srcindex:i,index:t}),ti.trigger(gi.formschanged)}/**
	* Removes a form from the given page index.
	* @param index: number, Zero based page index of the form to be removed.
	* @param callback: function, Function to be called when the operation has completed.
	*/
function O(e,i){s(e),"function"==typeof i&&i(),ti.trigger({type:gi.formremoved,index:e}),ti.trigger(gi.formschanged)}/**
	* Moves a form from one page index to another.
	* @param sourceIndex: number, Zero based page index of the form to be moved.
	* @param destIndex: number, Destination zero based page index.
	* @param callback: function, Function to be called when the operation has completed.
	*/
function z(e,i,t){u(e,i),"function"==typeof t&&t(),ti.trigger({type:gi.formmoved,srcindex:e,destindex:i}),ti.trigger(gi.formschanged)}function C(){var e={};return ei.extend(!0,e,{data:di,pages:oi,viewport:fi}),e}function D(e){e&&(null===e._fields?e._fields=di.fields:ei.isArray(e._fields)&&(di.fields=e._fields))}function U(){if(di.fields.length>0){if(di.fields.length=0,oi)for(var e=0;e<oi.length;e++)m(oi[e]);ti.trigger({type:"formscleared"})}}function B(e,i,t){var l={};e&&e.type&&ai[e.type]&&ei.extend(!0,l,ai[e.type]),ei.extend(!0,l,e);var n=new Atalasoft.Forms.Field(l,di,i);return"undefined"==typeof di.fields[i]&&(di.fields[i]=[]),di.fields[i].push(n),li.redrawVisiblePages(),"function"==typeof t&&t(n),W(n),n}function V(e,i){var t=di.fields[i].splice(e,1)[0];di.activepage&&di.activepage._form._fields.splice(e,1),t.dispose(),ti.trigger({type:"fielddeleted",page:i,index:e})}function j(e){e&&(e instanceof jQuery||(e=ei(e)),fi=e)}function T(e,i,t){return si?null:(e&&e.type&&ai[e.type]&&ei.extend(!0,e,ai[e.type]),di.activefield&&null===di.activefield.getObject()&&N(),q(),di.activefield=new Atalasoft.Forms.Field(e,di,di.activepage?di.activepage._index:void 0),di.activefield.bind({drawn:L,cancelled:N}),"function"==typeof i&&(I=i),"function"==typeof t&&(R=t),di.activefield)}function I(){}function R(){}function q(){if(!ui){fi.bind("mousedown",H),Atalasoft.Utils.Browser.Features.Touch&&fi.bind("touchstart",H);for(var e=0;e<oi.length;e++)oi[e]._draw.toFront();ui=!0}}function E(){if(ui){fi.unbind("mousedown",H),Atalasoft.Utils.Browser.Features.Touch&&fi.unbind("touchstart",H);for(var e=0;e<oi.length;e++)oi[e]._draw.reset();ui=!1}}function H(e){si=!0,fi.unbind("mousedown",H),Atalasoft.Utils.Browser.Features.Touch&&fi.unbind("touchstart",H),ti.trigger({type:"fielddrawstart",field:di.activefield.getClonedData()}),di.activefield._pageindex=di.activepage._index,di.activefield.startDraw(e,di.activepage._form,{}),Atalasoft.Utils.Browser.Explorer&&parseInt(Atalasoft.Utils.Browser.Version,10)<8&&di.activepage._draw.height(di.activepage.height())}function L(){J(di.activefield),Q(),Atalasoft.Utils.Browser.Explorer&&parseInt(Atalasoft.Utils.Browser.Version,10)<8&&di.activepage._draw.height("100%")}function N(){di.activefield.dispose(),di.activefield=null,si&&Q(!0)}function Q(e){si=!1,E(),ti.trigger({type:"fielddrawend",field:e?null:di.activefield.getClonedData(),cancelled:e?!0:!1})}function S(e){ci=e,ti.bind("scroll",v)}function G(){ti.unbind("scroll",v)}function J(e){var i=di.activepage,t=i?i._index:0;di.fields[t]?di.fields[t].push(e):di.fields[t]=[e],di.activefield.unbind({}),W(di.activefield),I({field:e}),I=function(){},ti.trigger({type:gi.fieldcreate,field:e.getClonedData()})}function W(e){function i(i){ti.trigger({type:gi[i.type],field:e.getClonedData()})}e.bind({interactstart:function(){di.activepage&&di.activepage._form===e.getObject().form||w(e.getObject().form._page),di.activefield=e},moved:i,resized:i,interactend:i,touchstart:i,touchmove:i,pinchmove:i,click:i,dblclick:i,rightclick:i,mousedown:i,mousedownleft:i,mousedownright:i,mousemove:i,mouseout:i,mouseup:i,mouseover:i,repaint:i,fieldfocusin:S,fieldfocusout:G})}function Z(){var e={},i=!1;for(var t in di.fields)if(di.fields.hasOwnProperty(t)&&di.fields[t].length>0){e[t]=[];for(var l in di.fields[t])di.fields[t].hasOwnProperty(l)&&(i=!0,e[t][l]=di.fields[t][l].get())}return i?JSON.stringify({forms:{fields:e}}):void 0}function $(e){var i=e.getParentName(),t=e.getName();t.indexOf("<~Atala_Unnamed_")>=0&&(di.multiviewFields.hasOwnProperty(i)?di.multiviewFields[i].push(e):di.multiviewFields[i]=[e])}function K(e,i){var t={type:"formdata",serverurl:e,query:"?atalaformdata=",method:"GET",data:{atala_formurl:i},cancel:!1,info:{fields:[],error:void 0}};return t}function M(e,i){function t(e){Y(e),"function"==typeof i&&i.call()}U(),li.makeHandlerRequest(e,t,t)}function X(e,i,t){var l=K(e,i);M(l,t)}function Y(e){if(e){var i={type:"formsloaded"};if(e.dpi&&(di.dpi=e.dpi),e.forms&&e.forms.fields){for(var t in e.forms.fields)if(e.forms.fields.hasOwnProperty(t)){t=parseInt(t,10);var l=isFinite(e.offset)?e.offset+t:t;di.fields[l]&&di.fields[l].length>0?di.fields[l].length=0:di.fields[l]=[];var n=e.forms.fields[t];if(n&&n.length>0)for(var o=0;o<n.length;o++)di.fields[l][o]=new Atalasoft.Forms.Field(n[o],di,l),$(di.fields[l][o]),ti.trigger({type:gi.load,field:di.fields[l][o].getClonedData()}),W(di.fields[l][o])}}else e.error&&(i.error=e.error);ti.trigger(i)}}var ei=Atalasoft.$,ii=this,ti=e,li=i,ni={forms:{events:{/** Triggers when the user uses the mouse to click on a field. Populated keys: e.field */
fieldclicked:null,/** Triggers when the user uses the mouse to create a field. Populated keys: e.field */
fieldcreated:null,/** Triggers when the user uses the mouse to double-click on a field. Populated keys: e.field */
fielddoubleclicked:null,/** Triggers when a field is loaded into the document. Populated keys: e.field */
fieldloaded:null,/** Triggers when the user has depressed a mouse button on a field. Populated keys: e.field */
fieldmousedown:null,/** Triggers when the user has depressed the left mouse button on a field. Populated keys: e.field */
fieldmousedownleft:null,/** Triggers when the user has depressed the right mouse button on a field. Populated keys: e.field */
fieldmousedownright:null,/** Triggers when the user moves the mouse pointer over a field. Populated keys: e.field */
fieldmousemove:null,/** Triggers when the user has moved the mouse pointer out of the bounds of the field. Populated keys: e.field */
fieldmouseout:null,/** Triggers when the user has moved the mouse pointer into the bounds of the field. Populated keys: e.field */
fieldmouseover:null,/** Triggers when the user has released a mouse button on a field. Populated keys: e.field */
fieldmouseup:null,/** Triggers when a field has been moved. Populated keys: e.field */
fieldmoved:null,/** Triggers when a pinch gesture has been detected on a field. Populated keys: e.field */
fieldpinchresize:null,/** Triggers when a field has been repainted. Populated keys: e.field */
fieldrepainted:null,/** Triggers when a field has been resized. Populated keys: e.field */
fieldresized:null,/** Triggers when the user right clicks on a field. Populated keys: e.field */
fieldrightclicked:null,/** Triggers when a touch end event has finished on a field. Populated keys: e.field */
fieldtouchend:null,/** Triggers when a touch move event is happening on a field. Populated keys: e.field */
fieldtouchmove:null,/** Triggers when a touch event has started on a field. Populated keys: e.field */
fieldtouchstart:null},createOnPage:x,deleteFromPage:A,getFromPage:P,insertForm:k,moveForm:z,removeForm:O}};if(Atalasoft.Forms.FormController.__exposedApi=ni.forms,!e)return null;var oi=i._pages,ri=!1,fi=null,di={fields:[],multiviewFields:{},activepage:null,activefield:null,highlighted:!0,readonly:t?!0:!1,getZoom:li.getPageScale,getViewerTransform:li.getViewerTransform,getPageRotation:li.getPageRotation,dpi:96},ai={},si=!1,ui=!1,ci=null,gi={click:"fieldclicked",dblclick:"fielddoubleclicked",touchstart:"fieldtouchstart",interactend:"fieldtouchend",touchmove:"fieldtouchmove",pinchmove:"fieldpinchresize",rightclick:"fieldrightclicked",mousedown:"fieldmousedown",mousedownleft:"fieldmousedownleft",mousedownright:"fieldmousedownright",mousemove:"fieldmousemove",mouseout:"fieldmouseout",mouseup:"fieldmouseup",mouseover:"fieldmouseover",create:"fieldcreated",load:"fieldloaded",moved:"fieldmoved",resized:"fieldresized",repaint:"fieldrepainted"};ii.dispose=o,ii.addFormLayer=d,ii.insertForm=a,ii.removeForm=s,ii.moveForm=u,ii.removeFormLayer=c,ii.showLayer=g,ii.__getDebugInfo=C,ii.__linkForms=D,ii.clear=U,ii.createField=B,ii.deleteFieldOnPage=A,ii.getFieldsFromPage=P,ii.setViewPort=j,ii.drawField=T,ii.stringifyChanges=Z,ii.createHandlerRequest=K,ii.makeHandlerRequest=M,ii.loadFormUrl=X,ii.loadForms=Y,r(),l()};
Atalasoft.Text.TextController=function(e,t,n){function r(){Gt.bind({pagerecycled:x,pageshown:v,zoomchanged:c,documentchanged:w}),Wt.bind({textselectstart:L,textselectmove:O,textselectend:k,textselectcopy:U}),It._state.initialized?o():Gt.bind({initialized:o})}function o(){$t=!0}function i(){Gt.unbind({pagerecycled:x,pageshown:v,zoomchanged:c,documentchanged:w}),Wt.unbind({textselectstart:L,textselectmove:O,textselectend:k}),Et=null,Gt=null,Kt=null,Yt.searchQuery=null,Yt.selectionCache=[],$t=!1,Yt.activepage=null}function a(e){return It._controllers.document.getPageText(e)}function s(){"Atalasoft.Controls.WebDocumentViewer"===Gt.typeOf&&Vt.extend(Gt,Ht)}/**
	* jQuery trigger shortcut
	* @returns object, WebDocumentViewer
	*/
function l(e){return Gt.trigger(e),Et}function u(){return Wt.trigger.apply(Wt,arguments),Et}function g(e,t){Gt.trigger({type:"throwerror",name:e,msg:t})}function c(){}function d(e){return e instanceof jQuery?(e._text&&(e._text._page=null,e._text=null),!0):!1}function h(e){return e instanceof jQuery?(e._text=It.createDOM("canvas",e),e._text.css({width:"100%",height:"100%",position:"absolute",zIndex:0}),e._text.attr("width",e.width()).attr("height",e.height()),e._text._page=e,e.bind(Atalasoft.Utils.Browser.Features.Touch?"touchstart":"mousedown",function(){b(e)}),e.bind({pageresize:function(t){t.page=e,y(t)},pagezoom:function(t){t.page=e,m(t)}}),!0):!1}function f(e,t){if(t._text){p(t);var n=a(e);if(n){var r=yt(t,n);if(r&&n.searchResult&&j(r,n),r&&n.selection)for(var o=n.selection,i=0;i<o.regions.length;i++)for(var s=0;s<o.regions[i].lines.length;s++)for(var l=o.regions[i].lines[s],u=0;l.words&&u<l.words.length;u++){var g=l.words[u];et(r,g.bounds.x,g.bounds.y,g.bounds.width,g.bounds.height,Zt.selection)}}}}function x(e){e.page._form&&p(e.page)}function v(e){f(e.index,e.page)}function p(e){e._text&&D(e._index)}function y(e){e.page._text.attr("width",e.width).attr("height",e.height),e.page._text.width(e.width),e.page._text.height(e.height),f(e.index,e.page)}function b(e){Yt.activepage=e}function m(e){y(e)}function w(){if(Yt.searchQuery&&Yt.searchQuery.iterator){Yt.searchQuery.iterator.dispose(),Yt.searchQuery=null,gt();for(var e=0;e<Xt.length;e++)f(Xt[e]._index,Xt[e])}}/**             
    * Indicates whether page text is loaded.             
    */
function _(e){var t=a(e);return t&&!t.loading}/** Selects all text on the page.
    * @param {number} index, page index (0 based) to select
    * @param {number} region, optional, region index to select
    * @param {number} line, optional, line index to select
    * @param {number} word, optional, word index to select
    * @param success: function that that is called when page text is loaded and selected
    * @param fail: function that that is called when page text load is failed
    * @returns jquery deferred promise
    * @tutorial search result match object could be used to retrieve region line and word indexes of the match starting object.
    */
function P(e,t,n,r,o,i){var a=Vt.Deferred(),s=Array.prototype.slice.call(arguments,1);return s.length>2&&"function"==typeof s[s.length-2]?(i=s.pop(),o=s.pop()):s.length>1&&"function"==typeof s[s.length-1]&&(o=s.pop()),t=s[0],n=s[1],r=s[2],ft(e).done(function(e,i){var s=i.bounds;void 0===t||!i.regions[t]||void 0!==n&&i.regions[t].lines[n]?(t=i.regions[t],void 0!==n&&t.lines[n]&&(n=t.lines[n],s=Z(n.bounds,t),void 0!==r&&n.words[r]&&(s=Z(n.words[r].bounds,t))),W(e,Ft(s.x,s.y),e,Ft(s.right,s.bottom))):I(e,t);var l=function(){Gt.config.mousetool.text.hookcopy&&It._dom.viewport.focus(),a.resolve(),o&&"function"==typeof o&&o()};It.isPageInView(e)?l():Gt.showPage(e,l)}).fail(function(){a.reject(),i&&"function"==typeof i&&i()}),a.promise()}/**
    * Returns whole page text.
    * @param {number} index, page index (0 based) to retrieve text
    * @param success: function that that is called when page text is loaded and formatted
    * @param fail: function that that is called when page text load is failed
    * @returns jquery deferred promise
    */
function T(e,t,n){var r=Vt.Deferred();return ft(e).done(function(){var n="",o=a(e);if(o)for(var i=0;i<o.regions.length;i++){var s=N(o.regions[i]);s&&(n+=s)}r.resolve(n),t&&"function"==typeof t&&t(n)}).fail(function(){r.reject(),n&&"function"==typeof n&&n()}),r.promise()}/**
    * Marks page text data for reload.
    * @param {number} index, optional, page index (0 based) to reset text data. If not specified whole document text data is reset.
    */
function C(e){if(void 0===e||null===e)for(var t=0;t<It._controllers.document.getPageCount();t++)C(t);var n=a(e);n&&(It._controllers.document.updatePageText(e,null),Yt.selectionCache[e]&&(Yt.selectionCache[e]=null,It.findPageFromIndex(e)&&D(e,null)))}/**
    * Forcibly triggers page text load.
    * @param {number} index, page index (0 based) to reset text data.
    * @param callback: function that that is called when page text is loaded
    */
function R(e,t,n){return C(e),ft(e).done(function(){t&&"function"==typeof t&&t(e)}).fail(function(){n&&"function"==typeof n&&n(e)})}function M(){var e={};return Vt.extend(!0,e,{data:Yt,pages:Xt,viewport:Kt}),e}function A(){}function S(){if(Yt.searchQuery=null,Yt.selectionCache=[],It._controllers.document.initDocumentText({pages:[]}),Xt)for(var e=0;e<Xt.length;e++)p(Xt[e])}function z(e){e&&(e instanceof jQuery||(e=Vt(e)),Kt=e)}/**
    * Clears all text selection for the document.
    */
function Q(){for(var e=0;e<It._controllers.document.getPageCount();e++){var t=a(e);t&&t.selection&&(D(e,t,!0),t.selection=null)}Yt.selectionCache.length=0}/** Clears the text selection */
function D(e,t,n){for(var r=0;r<Xt.length;r++)if(!isFinite(e)||Xt[r]._index===e){t=isFinite(e)&&r===e?t:a(Xt[r]._index);var o=yt(Xt[r],t);if(o){var i=It.getSourcePageSize(Xt[r]._index,t?t.rotation:0);o.clearRect(0,0,i.width,i.height),n&&j(o,t)}}}function j(e,t){if(t&&t.searchResult)for(var n=0;n<t.searchResult.length;n++){var r=t.searchResult[n].bounds;et(e,r.x,r.y,r.width,r.height,Zt.highlight)}}function L(e){var t=e.eventData,n=t.page,r=t.point;Q();var o=a(n);o&&(o.selection=st(t.point,t.point),t.interval&&Yt.origin&&Yt.originPage>=0?(W(Yt.originPage,Yt.origin,n,r),t.complete=!0):(t.line||t.word)&&Math.abs(t.point.x-Yt.origin.x)<10&&Math.abs(t.point.y-Yt.origin.y)<10?(E(n,r,t.line,t.word),t.complete=!0):(Yt.origin=t.rectangular?t.viewerPoint:t.point,Yt.originPage=n,Yt.rectangular=t.rectangular)),t.handled=!0}function O(e){var t=e.eventData,n=t.page,r=Yt.rectangular?t.viewerPoint:t.point,o=a(n);if(o)if(o.loading)t.cursor=Atalasoft.Utils.MouseToolCursor.Wait;else{if(0===o.regions.length)return t.handled=!1,!0;var i=It.getPageRotation(n)+o.rotation;if(o.rotatedRegions)for(var s=0;s<o.rotatedRegions.length;s++)if(Dt(t.point,o.rotatedRegions[s].bounds)){i+=o.rotatedRegions[s].rotation;break}t.cursor=i%180===0?Atalasoft.Utils.MouseToolCursor.Text:Atalasoft.Utils.MouseToolCursor.VerticalText,t.selecting&&en(Yt.originPage,Vt.extend({},Yt.origin),n,r,Yt.rectangular)}return t.handled=!0,!1}function k(e){var t=e?e.eventData:{},n=!1;for(var r in Yt.selectionCache)if(Yt.selectionCache.hasOwnProperty(r)&&Yt.selectionCache[r].selection&&Yt.selectionCache[r].selection.regions.length){n=!0;break}n&&l({type:"textselected"}),Yt.rectangular=!1,t.handled=!0}function U(){q()}function q(){var e=It.createDiv();if(e[0]){var t=new Clipboard("wdv-dummy-selection-trigger",{text:function(){return B()}});t.on("success",function(){t.destroy()}),t.on("error",function(){t.destroy(),g("TextCopyError")}),t.onClick({currentTarget:e[0]})}}function B(){for(var e="",t=0;t<Yt.selectionCache.length;t++)if(Yt.selectionCache[t]){var n=Yt.selectionCache[t].selection;if(n&&n.regions&&n.regions.length>0)for(var r=0;r<n.regions.length;r++){var o=N(n.regions[r]);o&&(e+=o)}}return e}function F(e){for(var t="",n=0;e.words&&n<e.words.length;n++)if(Ut(e.words[n],n>=1?e.words[n-1]:null)&&(t+=" "),e.words[n].text)t+=e.words[n].text;else if(e.words[n].glyphs&&e.words[n].glyphs.length)for(var r=0;r<e.words[n].glyphs.length;r++)t+=e.words[n].glyphs[r].text;return t}function N(e){for(var t="",n=0;n<e.lines.length;n++){var r=F(e.lines[n]);r&&(t+=V(r))}return t}function V(e){return e+"\n"}function E(e,t,n,r){var o=a(e);if(o&&(n||r))for(var i=0;i<o.regions.length;i++){var s=o.regions[i];if(Dt(t,s.bounds))for(var l=0;l<s.lines.length;l++){var u=s.lines[l];if(Dt(t,u.bounds)){var g={region:i,line:l,bounds:u.bounds};if(r){for(var c=0;c<u.words.length;c++)if(Dt(t,u.words[c].bounds))return g.word=c,g.bounds=u.words[c].bounds,G(e,g),void 0}else if(n)return G(e,g),void 0}}}}function G(e,t){var n=a(e);if(n&&t&&n.regions[t.region]){Q();var r=n.regions[t.region],o=yt(pt(e),n);if(Vt.isNumeric(t.line)&&r.lines[t.line]){for(var i=r.lines[t.line],s={words:[]},l={lines:[s],bounds:Vt.extend({},r.bounds)},u=Vt.isNumeric(t.word)&&i.words[t.word]?t.word:0,g=Vt.isNumeric(t.endWord)&&i.words[t.endWord]?t.endWord:Vt.isNumeric(t.word)?u:i.words.length-1,c=u;g>=c;++c){var d=i.words[c],h=!!d.glyphs.length;h&&c===u&&Vt.isNumeric(t.glyph)?d=X(d,t.glyph,u===g&&Vt.isNumeric(t.endGlyph)?t.endGlyph:d.glyphs.length-1):h&&c===g&&Vt.isNumeric(t.endGlyph)&&(d=X(d,0,t.endGlyph)),s.words.push(Vt.extend({},d)),o&&et(o,d.bounds.x,d.bounds.y,d.bounds.width,d.bounds.height)}n.selection=st(Ft(t.bounds.x,t.bounds.y),Ft(t.bounds.right,t.bounds.bottom)),at(n.selection.regions,l),Yt.selectionCache[e]=n}else I(e,t.region)}}function I(e,t){Q();var n=a(e);if(n&&n.regions[t]){var r=n.regions[t],o=yt(pt(e),n);n.selection=st(Ft(r.bounds.x,r.bounds.y),Ft(r.bounds.right,r.bounds.bottom),!1);var i=$(o,r,n.selection.origin,n.selection.point);i&&i.lines.length>0&&(at(n.selection.regions,i),Yt.selectionCache[e]=n)}}function W(e,t,n,r,o){var i=Math.min(e,n),a=Math.max(e,n);for(var s in Yt.selectionCache)if(Yt.selectionCache.hasOwnProperty(s)){var l=parseInt(s,10);(i>l||l>a)&&(D(l,Yt.selectionCache[l],!0),Yt.selectionCache[l].selection=null)}for(var u=o?Math.min(t.x,r.x):0,g=Ft(u,0),c=i;a>=c;c++){var d=It.getSourcePageSize(c);o&&(d=Vt.extend({},It.getPageSize(c)),d.width*=It.getPageScale(c),d.height*=It.getPageScale(c));var h,f,x=o?Math.max(t.x,r.x):d.width,v=Ft(x,d.height);i===a?(h=t,f=r):c===e?(h=t,f=c===i?v:g):c===a||c===i?(f=r,h=c===i?v:g):(h=g,f=v);var p=pt(c);o?Y(c,Ft(u,h.y),Ft(x,f.y),p):H(c,h,f,p)}}function H(e,t,n,r){var o=a(e);if(o&&tt(o,t,n,!1)&&o.regions.length>0){r&&r._text&&D(e,o,!0),o.selection=st(t,n,!1);var i=J(o,t,n);if(i&&i.start&&i.end)for(var s=yt(r,o),l=0;l<o.regions.length;l++){var u=o.regions[l],g=null;u===i.start?g=u===i.end?$(s,u,i.startPoint,i.endPoint):$(s,u,i.startPoint,Bt(u)):u===i.end?g=$(s,u,qt(u),i.endPoint):nt(u,i.start,i.end)&&(g=$(s,u,qt(u),Bt(u))),g&&g.lines&&g.lines.length>0&&(at(o.selection.regions,g),Yt.selectionCache[e]=o)}}}function J(e,t,n){for(var r=Ft(Math.min(t.x,n.x),Math.min(t.y,n.y)),o=Ft(Math.max(t.x,n.x),Math.max(t.y,n.y)),i=Mt({x:r.x,y:r.y,width:o.x-r.x,height:o.y-r.y}),a=Mt({x:0,y:r.y,width:e.bounds.width,height:o.y-r.y}),s=t,l=n,u=null,g=null,c=null,d=null,h=0;h<e.regions.length&&(!u||!g);h++){var f=e.regions[h].bounds;jt(a,f)&&(c=!c||it(e.regions[h],c)?e.regions[h]:c),jt(i,f)&&(u=!u&&Dt(s,e.regions[h].bounds)?e.regions[h]:u,g=!g&&Dt(l,e.regions[h].bounds)?e.regions[h]:g,d=!d||rt(e.regions[h],d)?e.regions[h]:d)}if(u&&g){if(it(g,u)){var x=g;g=u,u=x,s=n,l=t}}else if(c&&d){var v;u?(v=ot(l),it(u,v)?(g=d,l=null):(g=u,l=s,u=c,s=null)):g?(v=ot(s),rt(g,v)?(u=c,s=null):(u=g,s=l,g=d,l=null)):(u=c,g=d,l=null,s=null),s=s||qt(u),l=l||Bt(g)}return{start:u,startPoint:s,end:g,endPoint:l}}function $(e,t,n,r){var o={lines:[],bounds:Vt.extend({},t.bounds)},i=a(t.page).bounds;if(0!==t.rotation&&(n=Atalasoft.Utils.rotatePoint(n,i,360-t.rotation),r=Atalasoft.Utils.rotatePoint(r,i,360-t.rotation)),St(n.y,r.y)){var s=n;n=r,r=s}for(var l=0;l<t.lines.length;l++){var u=t.lines[l],g={words:[]},c=Rt(u,i,t.rotation),d=St(c.y,n.y)&&At(c.bottom,r.y),h=!d&&Qt(n.y,c.y,c.bottom),f=!d&&Qt(r.y,c.y,c.bottom);if(h&&l>1){var x=Rt(t.lines[l-1],i,t.rotation);h=!Qt(n.y,x.y,x.bottom),d=!h&&!f}if(f&&l<t.lines.length-1){var v=Rt(t.lines[l+1],i,t.rotation);f=!Qt(r.y,v.y,v.bottom),d=!h&&!f}if(d||h||f){for(var p=0;u.words&&p<u.words.length;p++){var y=u.words[p],b=Rt(y,i,t.rotation),m=y.glyphs&&y.glyphs.length,w=d;if(!w){if(h&&f){if(St(n.x,r.x)){var _=n;n=r,r=_}w=St(m?b.x:b.right,n.x)&&At(m?b.right:b.x,r.x)}else h?w=St(m?b.x:b.right,n.x):f&&(w=At(m?b.right:b.x,r.x));if(!w&&m){var P=null;if(h&&Qt(n.x,b.x,b.right)){var T=f?Math.min(b.right,r.x):b.right;P=K(y,n.x,T)}if(f&&Qt(r.x,b.x,b.right)){var C=h?Math.max(b.x,n.x):b.x;P=K(y,C,r.x)}P&&(y=P,w=!0)}}w&&(g.words.push(Vt.extend({},y)),e&&et(e,y.bounds.x,y.bounds.y,y.bounds.width,y.bounds.height))}g.words.length>0&&o.lines.push(g)}}return o}function K(e,t,n){for(var r=null,o=null,i=0;i<e.glyphs.length;++i){var a=e.glyphs[i].normalizedBounds;if(null===r&&St(a.right,t)&&(r=i),!At(a.x,n))break;o=i}return null!==r&&null!==o?X(e,r,o):null}function X(e,t,n){var r={glyphs:[],text:"",omitSpace:e.omitSpace};if(t>=0&&n>=t&&e.glyphs[n]){r.glyphs=e.glyphs.slice(t,n+1);var o=e.glyphs[t].bounds,i=e.glyphs[n].bounds,a=Math.min(o.x,i.x),s=Math.min(o.y,i.y),l=Math.max(o.right,i.right),u=Math.max(o.bottom,i.bottom);return r.bounds={x:a,y:s,width:Math.abs(l-a),height:Math.abs(u-s)},Mt(r.bounds),r}return null}function Y(e,t,n,r){var o=a(e);if(o&&tt(o,t,n,!0)&&o.regions.length>0){r&&r._text&&D(e,o,!0);var i=kt(e,o,t),s=kt(e,o,n);o.selection=st(t,n,!0);var l=Mt({x:Math.min(i.x,s.x),y:Math.min(i.y,s.y),width:Math.abs(s.x-i.x),height:Math.abs(s.y-i.y)});if(l=Ot(l,o.bounds)){for(var u,g=0;g<o.regions.length;g++)if(jt(l,o.regions[g].bounds)){u=u||yt(r,o);for(var c={lines:[],bounds:Vt.extend({},o.regions[g].bounds)},d=0;d<o.regions[g].lines.length;d++){for(var h=o.regions[g].lines[d],f={words:[]},x=0;h.words&&x<h.words.length;x++){var v=h.words[x];if(jt(l,v.bounds)){var p=Mt(Atalasoft.Utils.rotateRect(l,o.bounds,(360-o.regions[g].rotation)%360)),y=v.normalizedBounds,b=St(y.x,p.x),m=At(y.right,p.right);b&&m||(v=K(v,Math.max(y.x,p.x),Math.min(y.right,p.right))),v&&(f.words.push(Vt.extend({},v)),u&&et(u,v.bounds.x,v.bounds.y,v.bounds.width,v.bounds.height))}}f.words.length>0&&c.lines.push(f)}c.lines.length&&at(o.selection.regions,c)}o.selection.regions.length&&(o.selection.bounds=l,Yt.selectionCache[e]=o)}}}function Z(e,t){if(t){if(t.rotation%180===0){var n=(e.bottom+e.y)/2;return Mt({x:e.x,y:n,width:e.width,height:0})}var r=(e.right+e.x)/2;return Mt({x:r,y:e.y,width:0,height:e.height})}return null}function et(e,t,n,r,o,i){e&&(e.clearRect(t,n,r,o),i=i||Zt.selection,e.fillStyle=i.color,e.globalAlpha=i.alpha,e.fillRect(t,n,r,o))}function tt(e,t,n,r){return r=!!r,!e.selection||!zt(e.selection.origin,t)||!zt(e.selection.point,n)||r!==e.selection.rectangular}function nt(e,t,n){return rt(e,t)&&it(e,n)}function rt(e,t){if(St(e.bounds.bottom,t.bounds.y)){if(Lt(e.bounds,t.bounds))return e.bounds.x>t.bounds.x;var n=Ot(e.bounds,t.bounds);if(n)return n.width/n.height>=1?St(e.bounds.y,t.bounds.y):St(e.bounds.x,t.bounds.x);if(St(e.bounds.y,t.bounds.bottom))return!0;if(At(e.bounds.bottom,t.bounds.y))return!1;if(St(e.bounds.x,t.bounds.x))return!0}return!1}function ot(e){var t=Mt({x:e.x,y:e.y,width:0,height:0});return{lines:[],bounds:t}}function it(e,t){return!rt(e,t)}function at(e,t){for(var n=0;n<e.length&&!it(t,e[n]);n++);Array.prototype.splice.call(e,n,0,t)}function st(e,t,n){return{origin:e,point:t,rectangular:!!n,regions:[]}}/**
     * Searches the text in the document.
     * @param text: string, the text to search for
     * @param [startPage]: int, index of the first page to start search
     * @param callback: function, that that is called when first match is found. Accepts current search iterator and first match info.
     * @returns Iterator object. Matches iteration is not performed until previous search is in progress. 
     * In such case iteration requests are stored into the queue and executed later in the order of calling.
     */
function lt(e,t,n){if("function"==typeof t&&(n=t,t=0),gt(),e&&e.length>2&&n){var r={sourceQuery:e,text:e.toLocaleLowerCase(),start:t};Yt.searchQuery=r;var o=new ut(r,n);return Yt.searchQuery.iterator=o,o}for(var i=0;i<Xt.length;i++)f(Xt[i]._index,Xt[i])}function ut(e,t){function n(){/**
             * Indicates whether search should be wrapped around when first or last document page is match is reached.
             */
z.wrap=!0,Wt.bind("pagetextloaded",m),Gt.bind({pageshown:w}),setTimeout(function(){if(Xt.length&&R>=Xt[0]._index&&R<=Xt[Xt.length-1]._index)for(var n=0;n<Xt.length;n++){var o=a(Xt[n]._index);o&&!o.loading&&(o.searchResult=v(o,e.text),o.searchResult.length&&(f(Xt[n]._index,Xt[n]),Xt[n]._index===R&&(S=o.searchResult.length,M=R)))}r(t)},0)}/**
        * Advances current item to the next query match or adds operation to the queue.
        * @param callback: function that that is called when next match is found. Accepts current search iterator and current match info.
        * @description If match argument is null, no subsequent result is found.
        */
function r(e){D.push({action:s,args:[!0,_(e)]}),i()}/**
        * Advances current item to the previous query match or adds operation to the queue.
        * @param callback: function that that is called when previous match is found. Accepts current search iterator and current match info.
        * @description If match argument is null, no subsequent result is found.
        */
function o(e){D.push({action:s,args:[!1,_(e)]}),i()}function i(){if(!T&&D.length){var e=D.shift();e&&"function"==typeof e.action&&e.action.apply(z,e.args)}}function s(t,n){if(u()){var r=t?1:-1,o=a(M),i=o&&o.searchResult&&o.searchResult.length,l=t?A>=-1&&S-1>A:A>0&&S>=A;if(i&&l){A+=r;var g=o.searchResult[A];j=P(M,g),G(M,g);var c=o?o.rotation:0,h=It.getViewerTransform(M,c),f=Z(g.bounds,o.regions[g.region]),x=Ft(h.x(f.x,f.y),h.y(f.x,f.y));It.showPagePoint(M,x,Atalasoft.Utils.PageSelection.Center,function(){n(z,P(M,g))})}else T=T||d(e.text,M>=0?M+r:R,t).done(function(e,r){u()?e>=0&&r&&(M=e,S=r.searchResult.length,A=t?-1:S,s(t,n)):n(z,null)}).fail(function(){n(z,null)})}else n(z,null)}function l(){return e.sourceQuery}/**
        * Indicates whether this iterator corresponds to the active search.
        * @description If false, next/prev methods are always returning null match.
        */
function u(){var t=Yt.searchQuery===e;return t||b(),t}/**
        * Indicates whether this is executing background search.
        * If true, subsequent next/prev calls are stored into the search queue.
        * @description Method could be used, for example, to determine whether to hide or preserve loading mask within particular callback call.
        */
function g(){return u()&&(T||D.length>0)}/** 
        * Returns the formatted text for the whole line containing current match.
        */
function c(){if(u()&&j&&j.page>=0){var e=a(j.page);if(e&&e.regions[j.region]&&e.regions[j.region].lines[j.line])return F(e.regions[j.region].lines[j.line])}return null}function d(t,n,r,o,i){o=o||Vt.Deferred();var s;return u()&&setTimeout(function(){for(;n>=0&&n<It._controllers.document.getPageCount();n+=r?1:-1){var l=a(n);if(l&&!l.loading){if(l.searchResult=v(l,e.text),l.searchResult.length>0)return o.resolve(n,l),void 0}else{if(l&&l.loading&&l.promise)return h(t,n,r,o,i,l),void 0;if(!l){if(Q[n])continue;return s=!0,x(t,n,r,o),void 0}}}return!z.wrap||s||i?(o.reject(),void 0):(0>n&&!r?n=It._controllers.document.getPageCount()-1:n>=It._controllers.document.getPageCount()&&r&&(n=0),d(t,n,r,o,!0),void 0)},0),o.promise()}function h(e,t,n,r,o,i){i.promise.then(function(){d(e,t,n,r,o)})}function x(e,t,n,r){var o=p(t,n);o.pages.length?y(e,o,C).done(function(t){if(null===t)if(u()){var i=o.pages[o.pages.length-1],s=i.hasOwnProperty("di")?i.di:i.i;d(e,s,n,r)}else r.reject();else{var l=a(t);r.resolve(t,l)}}).fail(function(){r.reject()}):r.reject()}function v(e,t){var n=t.length,r=[];if(e.searchResult)r=e.searchResult;else for(var o=0;o<e.regions.length;o++)for(var i=0;i<e.regions[o].lines.length;i++){for(var a=e.regions[o].lines[i],s=0,l=[],u="",g=0;g<a.words.length;g++){var c=a.words[g],d=c.glyphs&&c.glyphs.length;Ut(c,g>=1?a.words[g-1]:null)&&(u+=" ",++s);for(var h=0;h<(d?c.glyphs.length:c.text.length);h++)l[s++]={bounds:d?c.glyphs[h].bounds:c.bounds,region:o,line:i,word:g,glyph:I?h:-1},u+=(d?c.glyphs[h].text:c.text[h]).toLocaleLowerCase()}var f=0;do if(f=u.indexOf(t,f),f>=0){for(var x=l[f],v=Math.min(f+n-1,l.length);!l[v]&&v>f;)--v;var p=l[v],y=Mt({x:x.bounds.x,y:x.bounds.y,width:Math.abs(p.bounds.right-x.bounds.x),height:Math.abs(p.bounds.bottom-x.bounds.y)});r.push({bounds:y,region:x.region,line:x.line,word:x.word,glyph:x.glyph,endWord:p.word,endGlyph:p.glyph})}while(f++>=0)}return r}function p(e,t){for(var n,r=e,o=[];r>=0&&r<It._controllers.document.getPageCount()&&o.length<=20;r+=t?1:-1){var i=r,s="",l=It._controllers.document.getPageReference(r);if("object"==typeof l?(i=l.index,s=l.uri):"number"==typeof l&&(i=l),n!==s&&r!==e)break;n=s;var u={i:i};i!==r&&(u.di=r),o.push(u);var g=a(r);if(g&&!g.loading)break}var c={textUrl:n||Gt.config.documenturl,pages:o};return c}function y(e,t,n){var r=Vt.Deferred(),o={type:"pagetextsearch",serverurl:Gt.config.serverurl,query:"?pagetextsearch=",method:"POST",data:{atala_query:e,atala_docurl:t.textUrl,atala_maxcount:n||C,atala_pages:JSON.stringify(t.pages)},cancel:!1},i=function(e){if(u()){var t=-1;if(e&&e.length)for(var n=0;n<e.length;n++){var o=e[n],i=o.hasOwnProperty("di")?o.di:o.i,s=a(i);!s&&o.text&&(It._controllers.document.updatePageText(i,o.text),vt(o.text,o.text,i)),o.count<=0&&0>t?s?s.searchResult=[]:Q[i]=[]:0>t&&o.count>0&&(t=i)}r.resolve(t>=0?t:null)}else r.reject()},s=function(){r.reject()};return It.makeHandlerRequest(o,i,s),r.promise()}function b(){Wt.unbind("pagetextloaded",m),Gt.unbind({pageshown:w}),Q=[]}function m(t){var n=t.text,r=t.index;if(u()&&n&&(n.searchResult=v(n,e.text),Q[r]&&Array.prototype.splice.call(Q,r,1),n.searchResult.length)){var o=It.findPageFromIndex(r);o&&f(r,o)}}function w(t){if(u()&&t.page&&t.index>=0){var n=a(t.index);!n||n.loading||n.searchResult||setTimeout(function(){n.searchResult=v(n,e.text),f(t.index,t.page)},0)}}function _(e){return function(){T=null,e&&e.apply(this,arguments),i()}}function P(e,t){return{page:e,region:t?t.region:0,line:t?t.line:0,word:t?t.word:0}}var T,C=3,R=e.start||0,M=-1,A=-1,S=0,z=this,Q=[],D=[],j=P(-1);n(),z.next=r,z.prev=o,/**
         * Gets the query text.
        */
z.getQuery=l,z.isValid=u,z.isSearching=g,z.getCurrentLineText=c,z.dispose=b}function gt(){for(var e=[],t=0;t<It._controllers.document.getPageCount();t++){var n=a(t);n&&n.searchResult&&(n.searchResult.length&&(e[t]=!0),n.searchResult=null)}for(var r=0;r<Xt.length;++r)e[r]&&f(r,Xt[r]);Yt.searchQuery=null}function ct(e,t){var n={type:"textdata",serverurl:e,query:"?atalatextdata=",method:"GET",data:{atala_docurl:t},cancel:!1,info:{ocr:{},error:void 0}};return n}function dt(e,t){function n(e){ht(e),"function"==typeof t&&t.call()}S(),It.makeHandlerRequest(e,n,n)}function ht(e){if(e){if(e.error&&(g("TextLoadError",e.error),S()),e.text.pages)for(var t=0;t<e.text.pages.length;++t)mt(e.text.pages[t],t);It._controllers.document.initDocumentText(e.text),l({type:"textloaded"})}}function ft(e){var t=Vt.Deferred();return setTimeout(function(){var n=a(e);if(n)t.resolve(e,n);else{var r=It._controllers.document.getPageReference(e);n={loading:!0,regions:[],promise:t},It._controllers.document.updatePageText(e,n);var o=null,i=e;"object"==typeof r?(i=r.index,o=r.uri):"number"==typeof r&&(i=r);var s=o||Gt.config.documenturl,l={type:"pagetextdata",serverurl:Gt.config.serverurl,query:"?atalapagetext=",method:"GET",data:{atala_docurl:s,atala_index:i},cancel:!1,info:{page:n,error:void 0}},u=bt(n,e,t);It.makeHandlerRequest(l,u,u)}},0),t.promise()}function xt(e,t,n){var r=ct(e,t);dt(r,n)}function vt(e,t,n,r){if(e)if(t.promise===r&&(t.loading=!1,t.promise=void 0),e.error)g("TextLoadError",e.error),t.regions=[],r&&r.reject&&r.reject(n);else{mt(e,n),t.regions=e.regions?e.regions:[],Vt.extend(t,e);var o={type:"pagetextloaded",index:n,text:t};u(o),l(o),r&&r.resolve&&r.resolve(n,t)}}function pt(e){for(var t=0;t<Xt.length;t++)if(Xt[t]._index===e)return Xt[t];return null}function yt(e,t){if(e&&e._text){var n=e._text[0];if(n.getContext){var r=n.getContext("2d"),o=t?t.rotation:0,i=It.getViewerTransform(e._index,o);return r.setTransform(i.a,i.b,i.c,i.d,i.e,i.f),r}}return null}function bt(e,t,n){return function(r){vt(r,e,t,n)}}function mt(e,t){if(e){Ct(e),e.regions=e.regions||[],e.rotatedRegions=[],e.rotation=e.rotation||0;for(var n=e.regions.length-1;n>=0;--n)e.regions[n].page=t,wt(e.regions[n],e.bounds)?(e.regions[n].index=n,e.regions[n].rotation&&e.rotatedRegions.push(e.regions[n])):Array.prototype.splice.call(e.regions,n,1);e.regions.sort(function(e,t){return it(e,t)?-1:1})}}function wt(e,t){if(!Ct(e))return!1;e.rotation=e.rotation||0,e.lines=e.lines||[];for(var n=e.lines.length,r=e.lines.length-1;r>=0;--r)_t(e.lines[r],t,e.rotation)||Array.prototype.splice.call(e.lines,r,1);return n>0&&0===e.lines.length&&g("TextLoadError","Invalid region data received."),n>0?e.lines.length>0:!0}function _t(e,t,n){if(!Ct(e,t,n))return!1;e.words=e.words||[];for(var r=e.words.length,o=e.words.length-1;o>=0;--o)Pt(e.words[o],t,n)||Array.prototype.splice.call(e.words,o,1);return r>0?e.words.length>0:!0}function Pt(e,t,n){if(!Ct(e,t,n))return!1;e.glyphs=e.glyphs||[],e.text=e.text||"",e.os&&(e.omitSpace=e.os,delete e.os);for(var r=e.glyphs.length-1;r>=0;--r){var o=e.glyphs[r];Tt(o,t,n)||Array.prototype.splice.call(e.glyphs,r,1)}return!0}function Tt(e,t,n){return Ct(e,t,n)?e.text?!0:!1:!1}function Ct(e,t,n){var r=!1;if(e)if(e.b&&"string"==typeof e.b){var o=e.b.split(";");e.bounds={x:parseFloat(o[0]),y:parseFloat(o[1]),width:parseFloat(o[2]),height:parseFloat(o[3])},delete e.b,r=!0}else e.bounds&&e.bounds.hasOwnProperty("x")&&e.bounds.hasOwnProperty("y")&&e.bounds.hasOwnProperty("width")&&e.bounds.hasOwnProperty("height")&&(Mt(e.bounds),r=!0);else e={};return e.bounds||(e.bounds={x:0,y:0,width:0,height:0}),Mt(e.bounds),e.bounds&&(e.normalizedBounds=Rt(e,t,n)),r}function Rt(e,t,n){if(!e.normalizedBounds){if(n%360===0)return e.normalizedBounds=e.bounds,e.normalizedBounds;e.normalizedBounds=Mt(Atalasoft.Utils.rotateRect(e.bounds,t,360-n))}return e.normalizedBounds}function Mt(e){return e.right=e.x+e.width,e.bottom=e.y+e.height,e}function At(e,t){return t+Jt>e}function St(e,t){return e>t-Jt}function zt(e,t){return e&&t&&e.x===t.x&&e.y===t.y}function Qt(e,t,n){return St(e,t)&&At(e,n)}function Dt(e,t){return t?Qt(e.x,t.x,t.right)&&Qt(e.y,t.y,t.bottom):!1}function jt(e,t){if(!e&&!t)return!1;var n=St(e.right,t.x)&&St(t.right,e.x)&&St(e.bottom,t.y)&&St(t.bottom,e.y)||Lt(e,t);return n}function Lt(e,t){if(!e&&!t)return!1;var n=e.width>t.width?e:t;return t=n===e?t:e,At(n.x,t.x)&&St(n.right,t.right)&&At(n.y,t.y)&&St(n.bottom,t.bottom)}function Ot(e,t){if(!jt(e,t))return null;var n={x:Math.max(e.x,t.x),y:Math.max(e.y,t.y),right:Math.min(e.right,t.right),bottom:Math.min(e.bottom,t.bottom)};return n.x<n.right&&n.y<n.bottom?(n.width=Math.abs(n.right-n.x),n.height=Math.abs(n.bottom-n.y),n):null}function kt(e,t,n){var r=It.getViewerTransform(e,t.rotation?t.rotation:0).invert();return Ft(r.x(n.x,n.y),r.y(n.x,n.y))}function Ut(e,t){return e&&t&&!t.omitSpace?!0:!1}function qt(e){return Ft(e.bounds.x,e.bounds.y)}function Bt(e){return Ft(e.bounds.right,e.bounds.bottom)}function Ft(e,t){return{x:e,y:t}}function Nt(e,t){var n,r,o,i,a=0,s=function(){a=(new Date).getTime(),i=null,o=e.apply(n,r),i||(n=r=null)};return function(){var l=(new Date).getTime();a||(a=l-t);var u=t-(l-a);return n=this,r=arguments,0>=u||u>t?(i&&(clearTimeout(i),i=null),a=l,o=e.apply(n,r),i||(n=r=null)):i||(i=setTimeout(s,u)),o}}var Vt=Atalasoft.$,Et=this,Gt=e,It=t,Wt=(t?t._internalEvents:null)||Vt({}),Ht={text:{events:{/** Triggers when page text loaded */
pagetextloaded:null,/** Triggers when the user uses the mouse to select text on the image. Populated keys: e.getText : function */
textselected:null},/**
             * Retrieves formatted selected text.
             */
getSelected:B,/**
             * Copies formatted text to clipboard.
             */
copySelected:q,/** Selects all text on the page.
            * @param {number} index, page index (0 based) to select
            * @param {number} region, optional, region index to select
            * @param {number} line, optional, line index to select
            * @param {number} word, optional, word index to select
            * @param success: function that that is called when page text is loaded and selected
            * @param fail: function that that is called when page text load is failed
            * @returns jquery deferred promise
            * @tutorial search result match object could be used to retrieve region line and word indexes of the match starting object.
            */
selectPageText:P,/**
            * Returns whole page text.
            * @param {number} index, page index (0 based) to retrieve text
            * @param success: function that that is called when page text is loaded and formatted
            * @param fail: function that that is called when page text load is failed
            * @returns jquery deferred promise
            */
getPageText:T,/**
             * Clears all text selection for the document.
             */
clearSelection:Q,/**
            * Marks page text data for reload.
            * @param {number} index, optional, page index (0 based) to reset text data. If not specified whole document text data is reset.
            */
resetPageText:C,/**
            * Forcibly triggers page text load.
            * @param index int, page index (0 based) to reset text data
            * @param success: function that that is called when page text is loaded successfully
            * @param fail: function that that is called when page text load is failed
            * @returns jquery deferred promise
            */
reloadPageText:R,/**             
            * Indicates whether page text is loaded.             
            * @param index int, page index
            */
isPageTextLoaded:_,/**
             * Triggers text search UI behavior.
             * @param text string, text to search for. Is empty, previous search results are dropped
             * @param startPage int, page index (0 based) to start search. If not specified first page is assumed to be the first in search
             * @returns search results iterator that allows navigation over search results
             */
search:lt}};if(Atalasoft.Text.TextController.__exposedApi=Ht.text,!e)return null;var Jt=.1,$t=!1,Kt=null,Xt=t._pages,Yt={activepage:null,origin:Ft(0,0),originPage:-1,rectangular:!1,selectionCache:[],searchQuery:null},Zt={};Vt.extend(Zt,n||{}),Et.dispose=i,Et.removeTextLayer=d,Et.addTextLayer=h,Et.showLayer=f,Et.__getDebugInfo=M,Et.__linkText=A,Et.clear=S,Et.setViewPort=z,Et.search=lt,Et.clearSelection=Q,Et.ensurePageTextLoaded=ft;var en=Nt(W,Gt.config.mousetool.text.throttlingtreshold);Et.createHandlerRequest=ct,Et.makeHandlerRequest=dt,Et.loadText=ht,Et.loadPageText=xt,s(),r()};
Atalasoft.Annotations.TextAnnotationUI=function(t,e,o){function n(){a(),x(),t.bind(j)}function a(){if(null==B&&(B=new Atalasoft.Annotations.FontUI(O.font)),S){var o=S.removed!==!0?S:null;k.unbind(o,{showeditor:d,hideeditor:f})}var n=V;S=e.html(),S.isHtml||(S.renderer=new Atalasoft.Annotations.AnnotationTextRenderer(t.get(),B),w=m),null!=U&&e._page&&(e._page.append(U),e._page.bind(Z)),Raphael.vml&&(t.getObject().node.style.overflow="hidden"),S.transform(v().toTransformString(!0)),k.bind(S,{showeditor:d,hideeditor:f}),n&&d()}function r(){U&&U.remove(),T&&T.remove(),B&&B.dispose(),S&&S.remove(),e&&e._page&&e._page.unbind(Z),t.unbind(j),M=null,k=null,U=null,B=null,T=null,S=null,O=null}function i(t){t&&A.extend(O,t)}function l(t){return t?O[t]:O}function s(){return B}function d(){U||u(),g()}function h(e){e.stopPropagation(),O.value!==U.val()&&(O.value=U.val(),t.set({text:O}))}function u(){U=A("<textarea/>").hide(),e._page&&(e._page.append(U),e._page.bind(Z)),U.bind("change keydown mouseup mousemove mousedown",h),U.bind({blur:f}),t.bind({deselected:f});var o=t.getObject();if(U.css({position:"absolute","overflow-x":"auto","overflow-y":"auto","z-index":99999,border:"0px solid",padding:"0px","background-color":"transparent"}),Atalasoft.Utils.Browser.Mobile.Any()){var n=t.get(),a=Atalasoft.Utils.getSVGOffset(e.canvas,e._page);U.css({left:n.x+a.left+"px",top:n.y+a.top+"px",width:n.width+"px","max-width":n.width+"px",height:n.height+"px","max-height":n.height+"px",border:o.attr("stroke")+" "+o.attr("strokewidth")+"px","background-color":o.attr("fill")})}B.setZoom(t.getZoom()),(Atalasoft.Utils.Browser.Chrome||Atalasoft.Utils.Browser.Safari)&&U.css({resize:"none"}),null!=O.value&&U.val(O.value),O.readonly&&U.prop("readonly","readonly"),B.repaint(U)}function g(){var e=t?t.get("visible"):!0;e&&((U.is(":hidden")||!V)&&(S.hide(),U.prop("readonly",O.readonly?"readonly":""),U.show(),x()),Atalasoft.Utils.Browser.Touch&&U.focus(function(){U[0].setSelectionRange(0,9999)}),Atalasoft.Utils.Browser.Explorer&&7===parseInt(Atalasoft.Utils.Browser.Version,10)||U[0].focus(),V=!0)}function f(){U&&((U.is(":visible")||V)&&(U.hide(),S.show(),x()),U[0].blur(),V=!1)}function p(){var e=t?t.get("visible"):!0;e?V?d():S.show():S.hide(),S.backgroundColor&&S.backgroundColor(t.get("fill").color)}function c(t){t&&(e!==t||S.removed)&&(e=t,null!=T&&(T.remove(),T=null),a(),p())}function x(o){if(c(o),w(),U&&(!U.is(":hidden")||V)){var n=t.get("outline").width/2,a=t.get(),r=t.getZoom(),i=t.getBox(),l=v(),s=y(l,i.x,i.y),d=y(l,i.x+i.width,i.y+i.height),h=i.width*r,u=i.height*r,g={x:(s.x+d.x-h)/2,y:(s.y+d.y-u)/2},f=z*r,p=n*r,x=2*(f+p),m=Math.max(Math.ceil(h-x),R.width),b=Math.max(Math.ceil(u-x),R.height),M=Atalasoft.Utils.getSVGOffset(e.canvas,e._page),k=a.rotation+_.getPageRotation(t._pageindex),T=0!==k?"rotate("+k+"deg)":"",S={left:Math.round(g.x+M.left+p)+"px",top:Math.round(g.y+M.top+p)+"px",width:m+"px",height:b+"px","max-width":m+"px","max-height":b+"px",padding:Math.ceil(f)+"px"};if(A.extend(S,Atalasoft.Utils.__htmlTransformStyle(T)),Atalasoft.Utils.Browser.Explorer8){var Z=t.getObject(),j=Z.attr("strokewidth")||1;U.css({border:"solid "+j+"px "+Z.attr("stroke"),"background-color":Z.attr("fill")})}U.css(S)}B&&(B.set(O.font),B.setZoom(t.getZoom()),B.repaint(U))}function w(){var e=t.get();T||(T=A('<textarea selectable="false"/>'),A(S.innerDom).append(T),T.css({"background-color":"transparent",border:"0px solid","overflow-x":"hidden","overflow-y":"hidden","-moz-user-select":"none","-khtml-user-select":"none","-webkit-user-select":"none","user-select":"none",resize:"none",cursor:"inherit"}),T.attr("readonly","readonly"),T.bind({focus:function(){return this.blur(),!1}}),T[0].raphaelParent=!0),T.val(O.value);var o=t.get("outline").width/2,n=Math.max(Math.ceil(e.width-2*(o+z)),1),a=Math.max(Math.ceil(e.height-2*(o+z)),1);B&&(B.set(O.font),B.repaint(T,1,!0)),T.css({width:n+"px",height:a+"px","max-width":n+"px","max-height":a+"px",padding:z+"px"}),S.attr({x:Math.round(o+e.x),y:Math.round(o+e.y),width:e.width,height:e.height}),S.transform(v().toTransformString(!0))}function m(){var e=t.get("outline").width/2,o=t.get(),n=Math.ceil(o.width-2*(e+z)),a=Math.ceil(o.height-2*(e+z));B&&B.set(O.font),S.attr({x:Math.round(e+z+o.x),y:Math.round(e+z+o.y),width:n,height:a}),S.renderer&&S.renderer.renderToSVGImage(S[0],{width:n,height:a}),S.transform(v().toTransformString(!0))}function v(){var e=Raphael.matrix();return e.add(_.getViewerTransform(t._pageindex)),e.add(t.getTransform()),e}function b(){S&&x()}function y(t,e,o){return{x:t.x(e,o),y:t.y(e,o)}}var A=Atalasoft.$,M=this,_=o,k=t.getEventObject(),U=null,T=null,B=null,S=null,O=t.get("text"),V=!1,z=3,R=Atalasoft.Utils.Browser.Mobile.Any()?{width:200,height:200}:{width:1,height:1},Z={},j={moving:b,resized:b,moved:b,rotated:b};n(),M.dispose=r,M.set=i,M.get=l,M.getFont=s,M.updateView=p,M.changepaper=c,M.repaint=x};
Atalasoft.Utils.getMousePosition=function(t,e,o){return e||(e={x:0,y:0}),Atalasoft.Utils.Browser.Explorer?(null==t&&(t=event),"CSS1Compat"===document.compatMode?(e.x=t.x+document.documentElement.scrollLeft,e.y=t.y+document.documentElement.scrollTop):(e.x=t.x+document.body.scrollLeft,e.y=t.y+document.body.scrollTop)):(e.x=t.pageX,e.y=t.pageY),o&&(e.x-=o.offsetLeft,e.y-=o.offsetTop),e},Atalasoft.Utils.getMousePositionJquery=function(t,e,o){e||(e={x:0,y:0});var a=Atalasoft.Utils.Browser.Explorer&&Atalasoft.Utils.Browser.Version<=9;if(!t.offsetX&&!t.offsetY||a)if(Atalasoft.Utils.Browser.Explorer&&!a)e.x=t.originalEvent.x,e.y=t.originalEvent.y;else{var r=null,i=t.originalEvent.touches&&1===t.originalEvent.touches.length,n=i?document.elementFromPoint(t.originalEvent.touches[0].clientX,t.originalEvent.touches[0].clientY):t.target;n=Atalasoft.$(n);var s=Atalasoft.Utils.Browser.Features.Touch?t.originalEvent.touches[0]:t.originalEvent;s.pageX||s.pageY||(s.pageX=t.pageX,s.pageY=t.pageY),t.target.raphael?r=n.parents("div:eq(0)").offset():(t.target.raphaelParent||n.parents("svg").length>0)&&(r=n.parents("svg").parents("div:eq(0)").offset()),r||(r=n.offset()),e.x=s.pageX-r.left,e.y=s.pageY-r.top}else if(Atalasoft.Utils.Browser.Firefox){var l;l=t.target.raphaelParent?Atalasoft.$(t.target).parents("svg").offset():Atalasoft.$(t.target.offsetParent||t.target.parentNode).offset(),e.x=t.pageX-l.left,e.y=t.pageY-l.top}else if(t.originalEvent.currentTarget===t.originalEvent.target||o)Atalasoft.Utils.Browser.Explorer&&Atalasoft.Utils.Browser.Version<10?(e.x=t.originalEvent.x,e.y=t.originalEvent.y):(e.x=t.offsetX,e.y=t.offsetY);else if(t.originalEvent.currentTarget.offsetLeft||t.originalEvent.currentTarget.offsetTop||!t.originalEvent.currentTarget.ownerSVGElement)e.x=t.originalEvent.currentTarget.offsetLeft+t.offsetX,e.y=t.originalEvent.currentTarget.offsetTop+t.offsetY;else{var f=Atalasoft.Utils.Browser.Explorer?t.originalEvent.currentTarget.ownerSVGElement.getBBox():t.originalEvent.currentTarget.getBBox();e.x=Math.round(f.x),e.y=Math.round(f.y)}return e},/**
* Gets the normalized offsetLeft and offsetTop from an SVG element
* with respect to its parent jQuery object
* @param objSVG: object, svg object from the dom
* @param parent: object, jQuery object representing the parent DOM node
*/
Atalasoft.Utils.getSVGOffset=function(t,e){var o={left:0,top:0};if("offsetLeft"in t)o.left=t.offsetLeft,o.top=t.offsetTop;else{var a=Atalasoft.$(t).offset(),r=e.offset();o.left=a.left-r.left,o.top=a.top-r.top}return o},Atalasoft.Utils.getJSPath=function(t){var e=Atalasoft.$('script[src*="'+t+'"]');return e.length>0?e.attr("src").replace(t,""):""},Atalasoft.Utils.CalcDistance=function(t,e,o,a,r){var i=Math.max(t,o),n=Math.min(t,o),s=Math.max(e,a),l=Math.min(e,a);return{x:i-n,y:s-l,dx:r?r.left-n:0,dy:r?r.top-l:0,left:n,right:i,top:l,bottom:s}},/**
 * Creates a rectangle object. 
 */
Atalasoft.Utils.makeRect=function(t,e,o,a){return{x:t,y:e,width:o,height:a}},/**
 * Calculates rectangle bounds for the clockwise page rotation to the specified angle.
 * @param angle positive number, must be exactly divisible by 90.
 */
Atalasoft.Utils.rotateRect=function(t,e,o){if(0===o)return t;o=(o-o%90)%360;var a=t.x,r=t.y;switch(o){case 90:a=e.height-t.y-t.height,r=t.x;break;case 180:a=e.width-t.x-t.width,r=e.height-t.y-t.height;break;case 270:a=t.y,r=e.width-t.x-t.width}return Atalasoft.Utils.makeRect(a,r,90===o||270===o?t.height:t.width,90===o||270===o?t.width:t.height)},/**
 * Calculates new point coordinates for the clockwise page rotation to the specified angle.
 * @param angle positive number, must be exactly divisible by 90.
 */
Atalasoft.Utils.rotatePoint=function(t,e,o){return Atalasoft.Utils.rotateRect({x:t.x,y:t.y,width:0,height:0},e,o)},Atalasoft.Utils.__atalaNull=function(){this.typeOf=null},Atalasoft.Utils.__rf=function(){return!1},Atalasoft.Utils.__ef=function(){},Atalasoft.Utils.__sp=function(t){t.stopPropagation()},/**
 * creates a function that wraps multiple functions into one
 * @param arr: array of functions
 * @param arguments to pass to called functions
 */
Atalasoft.Utils.__functionFromArray=function(t){return function(){for(;t.length;)t.shift().apply(this,arguments)}},Atalasoft.Utils.__supportsVML=function(){var t;if("undefined"==typeof t){var e=Atalasoft.$("<div/>").appendTo("body"),o=Atalasoft.$('<v:shape id="vml_flag1" adj="1" />').appendTo(e);o.css("behavior","url(#default#VML)"),t=o[0]?"object"==typeof o[0].adj:!0,e.remove()}return t},Atalasoft.Utils.__htmlTransformStyle=function(t){return{" transform":t,"-moz-transform":t,"-webkit-transform":t,"-o-transform":t,"-ms-transform":t}},Atalasoft.Utils.__calcPathBounds=function(t,e){var o={x:0,y:0,width:0,height:0};if(!t||!t.length)return o;e=e||Raphael.matrix(),o.x=e.x(t[0].x,t[0].y),o.y=e.y(t[0].x,t[0].y);for(var a=0;a<t.length;a++){var r={x:e.x(t[a].x,t[a].y),y:e.y(t[a].x,t[a].y)};o.x=r.x<o.x?r.x:o.x,o.y=r.y<o.y?r.y:o.y,o.width=r.x>o.width?r.x:o.width,o.height=r.y>o.height?r.y:o.height}return o.width-=o.x,o.height-=o.y,o},Atalasoft.Utils.__loadDependencies=function(t,e,o){function a(){var t="undefined"!=typeof $.easing,a="undefined"!=typeof $.ui,r=!e||"undefined"!=typeof Raphael;if(t&&a&&r)Atalasoft.Utils._scriptLoader&&Atalasoft.Utils._scriptLoader===s&&(delete Atalasoft.Utils._scriptsLoading,delete Atalasoft.Utils._scriptLoader),l("scriptsloaded");else{if(Atalasoft.Utils._scriptLoader&&Atalasoft.Utils._scriptsLoading)for(var i in Atalasoft.Utils._scriptsLoading)if(Atalasoft.Utils._scriptsLoading.hasOwnProperty(i)){var n=Atalasoft.Utils._scriptsLoading[i];n.indexOf("easing")>=0&&(t=!0),n.indexOf("ui")>=0&&(a=!0),!r&&n.indexOf("raphael")>=0&&(r=!0)}if(!t||!a||!r){var f=t?"":" jQuery.easing";f+=a?"":" jQuery.ui",f+=r?"":" Raphael",o("InitError","Unable to find dependencies:"+f)}}}function r(){0===i.length?a():$.getScript(u+i.shift(),r)}o=o||Atalasoft.Utils.__ef;var i=[],n="1.8.14",s=$({}),l=function(){s.trigger.apply(s,arguments)};if("undefined"==typeof $.easing&&i.push("jquery.easing.1.3.js"),"undefined"==typeof $.ui&&i.push("jquery-ui-"+n+".custom.min.js"),e&&"undefined"==typeof Raphael&&i.push("raphael-min.js"),i.length>0){if(Atalasoft.Utils._scriptsLoading&&Atalasoft.Utils._scriptLoader)for(Atalasoft.Utils._scriptLoader.bind({scriptsloaded:a});i.length>0;){var f=i.shift();-1===$.inArray(f,Atalasoft.Utils._scriptsLoading)&&Atalasoft.Utils._scriptsLoading.push(f)}else{var u=t||Atalasoft.Utils.getJSPath("jquery-"+$().jquery+".min.js");if(""===u)return o("InitError",'Unable to find dependencies, use config option "scripturl" to define root script url.'),void 0;Atalasoft.Utils._scriptsLoading=i.slice(0),Atalasoft.Utils._scriptLoader=s}return r(),Atalasoft.Utils._scriptLoader}return null},/** Browser sniffing enumeration */
Atalasoft.Utils.Browser={Explorer:navigator.userAgent.indexOf("MSIE")>=0||navigator.userAgent.indexOf("Trident")>=0,Firefox:navigator.userAgent.indexOf("Firefox")>=0||navigator.userAgent.indexOf("Minefield")>=0,Safari:navigator.userAgent.indexOf("Safari")>=0&&navigator.userAgent.indexOf("Chrome")<0,Opera:navigator.userAgent.indexOf("Opera")>=0,Chrome:navigator.userAgent.indexOf("Safari")>=0&&navigator.userAgent.indexOf("Chrome")>=0,Features:{SVG:!(!window.SVGAngle&&!document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")),Touch:!!("ontouchstart"in window),VML:Atalasoft.Utils.__supportsVML(),foreignObject:document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Extensibility","1.1"),Compatibility:"undefined"!=typeof document.documentMode&&7===document.documentMode,FlexBox:"flex"in document.documentElement.style||"WebkitFlex"in document.documentElement.style||"msFlex"in document.documentElement.style},Layout:{Gecko:!!navigator.userAgent.match(/(Gecko)/i),Presto:!!navigator.userAgent.match(/(Presto)/i),Trident:!!navigator.userAgent.match(/(Trident)/i),Webkit:!!navigator.userAgent.match(/(WebKit)/i),Version:(Atalasoft.Utils.__blv=navigator.userAgent.match(/(?:Gecko|Presto|Trident|WebKit).[\d\.]*/))?Atalasoft.Utils.__blv[0].replace(/\D*/,""):null},Mobile:{iOS:!!navigator.userAgent.match(/(iPad|iPhone|iPod)/i),Android:!!navigator.userAgent.match(/(Android)/i),IEMobile:!!navigator.userAgent.match(/(IEMobile)/i),Any:function(){return this.iOS||this.Android||this.IEMobile}},Version:(Atalasoft.Utils.__bv=navigator.userAgent.match(/(?:MSIE|Firefox|Chrome|Safari|Opera| rv).[\d\.]*/))?Atalasoft.Utils.__bv[0].replace(/\D*/,""):null},Atalasoft.Utils.Browser.Explorer8=Atalasoft.Utils.Browser.Explorer&&8===parseInt(Atalasoft.Utils.Browser.Version,10),/** Specifies the behavior of the mouse from within the WebDocumentViewer. */
Atalasoft.Utils.MouseToolType={/** Specify no mouse behavior at all. */
None:0,/** Clicking and dragging the mouse will scroll the image. */
Pan:1,/** Clicking will zoom in. */
ZoomIn:2,/** Clicking will zoom out. */
ZoomOut:3,/** Shows a context menu for the clicked object (where applicable). */
ContextMenu:4,/** Allows mouse events to pass through the DOM without any handling. */
PassThrough:5,/** Mouse will be set to crosshairs and can be used to drag and modify a selection rectangle on the image. */
Selection:6,/** Zoom in on a specified area defined by dragging a rectangle onto the image. */
ZoomArea:7,/** Input actions are interpreted as text selection */
Text:8},/** Specifies the cursor used with the mouse tool. */
Atalasoft.Utils.MouseToolCursor={/** Automatically determined by the browser. */
Auto:"",/** An arrow pointer. */
Arrow:"default",/** A crosshair usually used in drawing a box. */
Crosshair:"crosshair",/** A grabbing cursor. Usually changes to gabbed while the mouse button is down. */
Grab:Atalasoft.Utils.Browser.Firefox?"-moz-grab":"hand",/** A hand with a finger pointing. Usually what the browser uses for clicking hyperlinks. */
Hand:"pointer",/** A crosshair pointer with arrowheads on the ends indicating movement. */
Move:"move",/** A magnifying glass with a plus sign in it. */
ZoomIn:Atalasoft.Utils.Browser.Firefox?"-moz-zoom-in":'url("%1ZoomIn.cur"pointer), pointer',/** A magnifying glass with a minus sign in it. */
ZoomOut:Atalasoft.Utils.Browser.Firefox?"-moz-zoom-out":'url("%1ZoomOut.cur"), pointer',/** A selection editing cursor. */
Text:"text",/** A vertical text editing cursor. */
VerticalText:"vertical-text",/** A wait cursor. */
Wait:"wait",/** A custom CSS cursor string provided by the user. */
Custom:"%2"},/** Specifies the direction of scrolling */
Atalasoft.Utils.ScrollDirection={/** Scrolls horizontally. */
Horizontal:"horizontal",/** Scrolls vertically. */
Vertical:"vertical"},/** Specifies the fitting options */
Atalasoft.Utils.Fitting={/** No fitting will be applied to the image */
None:0,/** Finds the best option between width or height based fitting. */
Best:1,/** Fits the image to the available width. */
Width:2,/** Fits the image to the available height. */
Height:3},/** Specifies the page selection method */
Atalasoft.Utils.PageSelection={/** Selects the page under the top left corner of the viewer  */
TopLeft:{x:0,y:0},/** Selects the page under the middle left of the viewer  */
MiddleLeft:{x:0,y:.5},/** Selects the page under the bottom left corner of the viewer  */
BottomLeft:{x:0,y:1},/** Selects the page under the center location of viewer  */
Center:{x:.5,y:.5}},/** Specifies the size of the viewport area that triggers document scroll when text selection enters it */
Atalasoft.Utils.ScrollArea={/** Text selection scrolling is disabled */
None:0,/** Normal scroll area. Around 10% of the corresponding viewport dimension */
Normal:.1,/** Normal scroll area. Around 20% of the corresponding viewport dimension */
Large:.2};
var JSON;JSON||(JSON={}),function(){"use strict";function f(t){return 10>t?"0"+t:t}function quote(t){return escapable.lastIndex=0,escapable.test(t)?'"'+t.replace(escapable,function(t){var e=meta[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function str(t,e){var r,n,o,f,u,i=gap,p=e[t];switch(p&&"object"==typeof p&&"function"==typeof p.toJSON&&(p=p.toJSON(t)),"function"==typeof rep&&(p=rep.call(e,t,p)),typeof p){case"string":return quote(p);case"number":return isFinite(p)?String(p):"null";case"boolean":case"null":return String(p);case"object":if(!p)return"null";if(gap+=indent,u=[],"[object Array]"===Object.prototype.toString.apply(p)){for(f=p.length,r=0;f>r;r+=1)u[r]=str(r,p)||"null";return o=0===u.length?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+i+"]":"["+u.join(",")+"]",gap=i,o}if(rep&&"object"==typeof rep)for(f=rep.length,r=0;f>r;r+=1)"string"==typeof rep[r]&&(n=rep[r],o=str(n,p),o&&u.push(quote(n)+(gap?": ":":")+o));else for(n in p)Object.prototype.hasOwnProperty.call(p,n)&&(o=str(n,p),o&&u.push(quote(n)+(gap?": ":":")+o));return o=0===u.length?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+i+"}":"{"+u.join(",")+"}",gap=i,o}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(t,e,r){var n;if(gap="",indent="","number"==typeof r)for(n=0;r>n;n+=1)indent+=" ";else"string"==typeof r&&(indent=r);if(rep=e,e&&"function"!=typeof e&&("object"!=typeof e||"number"!=typeof e.length))throw new Error("JSON.stringify");return str("",{"":t})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(t,e){var r,n,o=t[e];if(o&&"object"==typeof o)for(r in o)Object.prototype.hasOwnProperty.call(o,r)&&(n=walk(o,r),void 0!==n?o[r]=n:delete o[r]);return reviver.call(t,e,o)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}();
Atalasoft.Controls.WebDocumentThumbnailer=function(e){function t(){vt&&(_t=vt.__getViewerLink(bt,xt),vt.bind({beforehandlerrequest:J,documentloaded:O,scroll:Y,pagerotated:$,pageinserted:H,pageremoved:W,pagemoved:X}),Pt.allowannotations&&vt.bind({annotationresized:G,annotationmoved:G,annotationrotated:G,annotationcreated:B,annotationdeleted:Z}),bt.bind({statusmessage:ut})),bt.bind({annotationsloaded:K,formsloaded:N,contextmenu:Q,documentloaded:R,pageshown:ct,pageresize:dt,scroll:lt,zoomchanged:gt,zoomstarted:pt,zoomfinished:ft,pagesizechanged:ht}),a(),wt={click:nt,touchstart:it,touchmove:st,touchend:rt,mouseenter:tt,mouseleave:ot},o()}function o(){}function n(){s=xt.__createDiv,i=xt.__createDOM}function a(){var e=["annotations","document","text","getCurrentPageIndex","getZoom","next","previous","save","showPage","setMouseTool"];h=bt.empty,b=bt.openUrl,r=bt.getCurrentPageIndex,l=bt.__getDebugInfo,g=bt.next,u=bt.previous,d=bt.showPage;for(var t=0;t<e.length;t++)vt?bt[e[t]]=vt[e[t]]:delete bt[e[t]];bt.empty=f,bt.openUrl=bt.OpenUrl=m,bt.__getDebugInfo=c,bt.scrollToThumb=d,bt.zoom=function(){},delete bt.fit}function i(){}function s(){}function r(){}function l(){}function c(){if(Pt.debug){var e=l();return mt.extend(!0,e,{thumbnailer:{config:Pt,index:zt,links:{viewer:_t,self:xt},page:Ft,thumb:Mt,state:Ct}}),e}return null}/**
	* Scrolls the viewer to the given page number and executes the callback when finished
	* @param i: int, page number (1 based)
	* @param callback: function to execute after this operation is done
	* @returns undefined
	*/
function d(){}function u(){}function g(){}/**
	* Gets the current selected thumbnail index
	* @returns number indicating the zero based page index
	*/
function p(){return zt}/**
	* Resets the thumbnailer to its default state
	* @param callback function to execute when the empty process is finished
	*/
function f(e){var t=1,o=function(){t--,0>=t&&"function"==typeof e&&e.call()};Pt.documenturl="",Pt.annotationsurl="",Pt.texturl="",vt&&(t++,vt.empty(o)),h(o)}function h(){}/**
	* Opens the document at the given urls in all associated controls
	* @param surl string: url of the document file with respect to the config.serverurl
	* @param aurl string: url of the annotation xmp file with respect to the config.serverurl
	* @param furl string: url of the form file with respect to the config.serverurl 
	* @param texturl string: url of the text data file with respect to the config.serverurl 
	* @param callback function to execute when the open operation is finished
	* @returns undefined
	*/
function m(e,t,o,n){S(),null==n&&("function"==typeof t?(n=t,t=null):"function"==typeof o&&(n=o,o=null));var a=function(){v(),et(n)};Pt.documenturl=e,Pt.annotationsurl=t,b(e,t,o,a)}function b(){}function v(){bt.scrollTo(0,0,!1)}/**
	* Highlights the thumbnail at the given index, and scrolls to it in the linked viewer, if possible.
	* @param i number indicating the zero based thumb index
	* @returns undefined
	*/
function z(e){if(!Ct.scrolling){if(zt=e,Ct.base&&mt.each(Ct.base.dom.pageDivs,function(t,o){o._index===e?o.addClass(bt.domclasses.atala_active_thumb):o.removeClass(bt.domclasses.atala_active_thumb),y(o)}),vt){var t=vt.getCurrentPageIndex();t>=0&&zt!==t&&(Ct.scrolling=!0,zt===t-1?vt.previous(1,j):zt===t+1?vt.next(1,j):vt.showPage(zt,j))}bt.trigger({type:"thumbselected",index:e})}}function w(){if(Ct.base){if(Ct.initialized&&Ct.base.dom.pageDivs.length>0&&null!=Ct.base.dom.pageDivs[0]._img&&!Ct.base.dom.pageDivs[0]._img._size.isEmpty()){var e=Ct.base.dom.pageDivs[0]._img._size;Mt.scale=e.width>e.height?Mt.size/e.width:Mt.size/e.height}else{var t=Ct.base.page.size.width/Ct.base.page.size.height<1,o=Math.ceil(Ct.base.page.size.height*Ct.base.config.zoom),n=Math.ceil(Ct.base.page.size.width*Ct.base.config.zoom),a=Mt.size;Pt.direction===Dt.Vertical?Mt.divsize=Math.ceil(Ct.base.page.size.width*Ct.base.config.zoom):Pt.direction===Dt.Horizontal&&(Mt.divsize=Math.ceil(Ct.base.page.size.height*Ct.base.config.zoom)),Pt.tabular&&Pt.columns>1&&Pt.direction===Dt.Vertical&&Pt.thumbsize&&P(),a=0>=a?Mt.divsize-2*Pt.thumbpadding:a,A(a),Mt.scale=Ct.base.config.zoom*(Mt.size/(t?o:n)),Mt.zoomfull=Mt.scale,Pt.minwidth>Ct.base.page.size.width*Mt.scale&&(Pt.minwidth=Ct.base.page.size.width*Mt.scale),Ct.initialized=!0}var i=Pt.showpageborder?2*Pt.pageborderwidth:0;if(bt.trigger({type:"pagedivsresized",height:Mt.size+2*Pt.thumbpadding-i,width:Mt.size+2*Pt.thumbpadding-i,fullzoom:Mt.zoomfull,minwidth:Pt.minwidth}),Pt.allowdragdrop){var s=Math.round(Mt.size/2);Ct.base.dom.content.sortable({containment:"parent",cursorAt:{left:s,top:s},delay:Pt.dragdelay,distance:4,helper:"clone",opacity:.65,scroll:!0,scrollSensitivity:s,scrollSpeed:10,start:D,stop:F,tolerance:"pointer",update:C,zIndex:100})}mt.each(Ct.base.dom.pageDivs,function(e,t){t.bind(wt),t.width(Mt.size),t.height(Mt.size),t.thumbInitialized?_(t._img,t._paper):(t.css({padding:Pt.thumbpadding,"background-color":Pt.backcolor,cursor:"pointer","margin-bottom":Pt.pagespacing+"px","text-align":"center",position:"relative"}),Pt.tabular?t.css({"margin-right":Pt.pagespacing+"px"}):Pt.direction===Dt.Horizontal&&t.css({"margin-right":Pt.pagespacing+"px","margin-bottom":"0px"}),t._paper&&Atalasoft.Utils.Browser.Explorer&&(t._paper.canvas.style.top="",t._paper.canvas.style.width="",t._paper.canvas.style.height=""),t._grips&&(t._grips.push=function(){}),t.thumbInitialized=!0)})}}function _(e,t,o,n){if(Ct.base){var a=n||e.getScaledSize(o),i=a.width,s=a.height,r=Mt.size*(Ct.base.config.zoom/Mt.zoomfull);if(i>r||s>r){var l=1>i/s,c=o*(r/(l?s:i));i=Math.round(e._size.width*c),s=Math.round(e._size.height*c),o=c}var d=e.getDomElement();d[0].style.left="50%",d[0].style.top="50%",d[0].style.position="absolute",d[0].style.marginLeft=-Math.round(i/2)+"px",d[0].style.marginTop=-Math.round(s/2)+"px",t&&(t.canvas.style.left="50%",t.canvas.style.top="50%",t.canvas.style.marginLeft=-Math.round(i/2)+"px",t.canvas.style.marginTop=-Math.round(s/2)+"px",t.canvas.style.zIndex=1),e.trigger({type:"pagezoom",index:e._page._index,height:Math.round(s),width:Math.round(i),prevzoom:Ct.base.config.zoom,zoom:o})}}function x(e,t,o){var n=e.data("selected")?t:o;e.css("background-color",n)}function y(e){var t=e._index===zt,o=t?Pt.selectedcolor:Pt.backcolor;e.data("selected",t),e.css("background-color",o)}function D(e,t){Ct.drag.dragging=!0,Ct.drag.start=M(t.item),Ct.drag.end=Ct.drag.start,Ct.base.controllers.mouseTool.pauseTool(),bt.trigger({type:"thumbdragstart",dragindex:Ct.drag.start})}function F(){Ct.drag.dragging=!1,Ct.base.controllers.mouseTool.resumeTool(),bt.trigger({type:"thumbdragend",dropindex:Ct.drag.end}),_t._controllers.document.movePage(Ct.drag.start,Ct.drag.end),z(Ct.drag.end)}function C(e,t){Ct.drag.end=Ct.base.dom.pageDivs[0]._index+t.item.index(),bt.trigger({type:"thumbsreordered",dragindex:Ct.drag.start,dropindex:Ct.drag.end})}function q(e,t){var o=[];for(var n in e)if(e.hasOwnProperty(n)){var a=[],i=t?{}:a;t&&(i[t]=a);for(var s in e[n])e[n].hasOwnProperty(s)&&(a[s]=e[n][s].get(),a[s].multiview=!0);o[n]=i}return o}function M(e){for(var t=0;t<Ct.base.dom.pageDivs.length;t++)if(Ct.base.dom.pageDivs[t][0]===e[0])return Ct.base.dom.pageDivs[t]._index;return-1}function P(){if(Pt.tabular){var e;if(Pt.columns>1)e=(Mt.size+2*Pt.thumbpadding+Pt.pagespacing)*Pt.columns;else if(Pt.rows>1){var t=Math.ceil(k()/Pt.rows);e=(Mt.size+2*Pt.thumbpadding+Pt.pagespacing)*t}e&&Ct.base.dom.content.width(e)}}function k(){return Ct.base.controllers.document.getPageCount()}function I(e){for(var t=0;t<Ct.base.dom.pageDivs.length;t++)if(Ct.base.dom.pageDivs[t]._index===e)return!0;return!1}function T(){var e=Ct.base.dom.pageDivs[0]._index;Ct.base.dom.pageDivs.sort(function(e,t){return e.index()-t.index()});for(var t=0;t<Ct.base.dom.pageDivs.length;t++){var o=Ct.base.dom.pageDivs[t];o._index=e+t,null!=o._num&&o._num.text(o._index+1)}}function A(e){Mt.size=e,Ct.base&&Ct.base.config.forcepagesize&&(Ct.base.config.forcepagesize.width=e,Ct.base.config.forcepagesize.height=e)}function V(){Pt.allowdragdrop=Pt.allowdragdrop?!0:!1,Pt.selectedindex=L(Pt.selectedindex)?parseInt(Pt.selectedindex,10):0,Pt.thumbpadding=L(Pt.thumbpadding)?parseInt(Pt.thumbpadding,10):8,Pt.backcolor=E(Pt.backcolor,"#DCDCDC"),Pt.hovercolor=E(Pt.hovercolor,"#667F9F"),Pt.selectedcolor=E(Pt.selectedcolor,"#E0872D"),Pt.selectedhovercolor=E(Pt.selectedhovercolor,"#FFC060")}function E(e,t){var o={hex:"#FFFFFF",hexs:"#FFF",name:"white",rgb:"rgb(255, 255, 255)"},n=s(null,"dummy");return n.css("backgroundColor",o.name),n.css("backgroundColor",e),n.css("backgroundColor")===o.rgb&&(e=e.toLowerCase(),e!==o.name&&e!==o.hex&&e!==o.hexs&&e!==o.rgb&&(e=t)),e}function L(e,t){return t?isFinite(parseFloat(e)):isFinite(parseInt(e,10))}function S(){Ct.base&&mt.each(Ct.base.dom.pageDivs,function(e,t){t.unbind(wt)})}function O(){}function U(){w(),xt.__redrawVisiblePages(!0),xt.__adjustVisiblePages()}function H(e){Ct.base&&(Ct.base.controllers.annotations&&Ct.base.controllers.annotations.insertLayer(null,null,e.destindex),Ct.base.controllers.forms&&Ct.base.controllers.forms.insertForm(null,null,e.destindex),U())}function W(e){Ct.base&&(Ct.base.controllers.annotations&&Ct.base.controllers.annotations.removeLayer(e.index),Ct.base.controllers.forms&&Ct.base.controllers.forms.removeForm(e.index),U())}function X(e){Ct.base&&(Ct.base.controllers.annotations&&Ct.base.controllers.annotations.moveLayer(e.srcindex,e.destindex),Ct.base.controllers.forms&&Ct.base.controllers.forms.moveForm(e.srcindex,e.destindex),T(),U())}function Y(){var e=vt.getCurrentPageIndex();zt!==e&&z(e)}function j(){Ct.scrolling=!1}function B(e){if(Ct.base){var t=_t._annos[e.page]||null,o=null,n=null;t&&(o=t[t.length-1],n=o.get()),n&&n.type===e.anno.type&&(n.multiview=!0,Ct.base.controllers.annotations.createAnnotation(n,e.page))}}function Z(e){Ct.base&&Ct.base.controllers.annotations.deleteAnnoOnPage(e.page,e.index)}function $(){Ct.base&&U()}function G(e){if(Ct.base&&I(zt))for(var t=Ct.base.controllers.annotations.getAnnosFromPage(zt),o=0;o<t.length;o++)t[o].type===e.anno.type&&t[o].update(!0)}function J(e){if(("docinfo"===e.request.type||"annodata"===e.request.type||"formdata"===e.request.type)&&Ct.base){if(e.request.cancel=!0,"docinfo"===e.request.type&&(e.request.info.pagewidth=Ft.size.width,e.request.info.pageheight=Ft.size.height,e.request.info.pagecount=Ft.count,e.request.info.dpi=Ft.dpi,e.request.info.colordepth=Ct.base.controllers.memory.getColorDepth(),e.request.info.vector=Ft.vector),Pt.allowannotations&&("annodata"===e.request.type||e.request.data.atala_annurl)){var t=Ct.base.controllers.annotations.__getDebugInfo().data;e.request.info.offset=0,e.request.info.layers=q(t.annos,"items")}if(Pt.allowforms&&("formdata"===e.request.type||e.request.data.atala_formurl)){var o=Ct.base.controllers.forms.__getDebugInfo().data;e.request.info.forms={fields:q(o.fields)}}vt.trigger({type:"handlerreturned",request:e.request})}}function K(){}function N(){}function Q(e,t,o){for(var n in o)o.hasOwnProperty(n)&&delete o[n]}function R(){Ct.base={config:xt._config,controllers:xt._controllers,dom:xt._dom,page:xt._page}}function et(e){Ft.size.width=Ct.base.page.size.width,Ft.size.height=Ct.base.page.size.height,Ft.count=Ct.base.page.count,Ft.dpi=Ct.base.page.dpi,Ft.vector=Ct.base.page.vector,Pt.direction===Dt.Vertical&&Ct.base.dom.scrollH?Ct.base.dom.scrollH._tray.hide():Pt.direction===Dt.Horizontal&&Ct.base.dom.scrollV&&Ct.base.dom.scrollV._tray.hide(),w();var t=function(){z(Pt.selectedindex),e&&"function"==typeof e&&e()};vt?vt.openUrl(Pt.documenturl,Pt.annotationsurl,t):t()}function tt(){x(mt(this),Pt.selectedhovercolor,Pt.hovercolor)}function ot(){x(mt(this),Pt.selectedcolor,Pt.backcolor)}function nt(e){var t=e.currentTarget;mt.each(Ct.base.dom.pageDivs,function(e,o){o[0]===t&&z(o._index)})}function at(e,t,o){if(!(e.originalEvent.touches.length>1)){e.preventDefault();var n=e.originalEvent.changedTouches[0],a=document.createEvent("MouseEvents");a.initMouseEvent(t,!0,!0,window,1,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,o,null),e.target.dispatchEvent(a)}}function it(e){qt.moves=0,at(e,"mouseover",0),at(e,"mousedown",0)}function st(e){qt.moves++,at(e,"mousemove",0)}function rt(e){at(e,"mouseup",0),qt.moves>0?qt.moves=0:at(e,"click",0),at(e,"mouseout",0)}function lt(){}function ct(e){if(Pt.showthumbcaption){if(!e.page._caption){var t=mt("<div/>");t.css({left:"3%",bottom:"16px",width:"94%",position:"absolute",zIndex:1,textAlign:"center",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}),t.addClass(bt.domclasses.atala_thumb_caption),e.page._caption=t,e.page.append(t)}var o=e.page._index+1+"";xt._page.caption&&(o=xt._page.caption.replace("{0}",o),e.page.attr("title",o)),e.page._caption.text(o)}y(e.page)}function dt(e){e.image&&(e.image._loaded?_(e.image,e.page._paper,Mt.scale,{width:e.width,height:e.height}):e.image.css({position:"absolute"}))}function ut(e){_t&&_t.__status&&_t.__status(e.message)}function gt(){if(Ct.base){var e=Ct.base.page.size.width/Ct.base.page.size.height<1,t=Math.ceil(Ct.base.page.size.height*Ct.base.config.zoom),o=Math.ceil(Ct.base.page.size.width*Ct.base.config.zoom),n=Math.max(t,o),a=Ct.base.config.zoom*(n/(e?t:o));Mt.zoom=Ct.base.config.zoom/Mt.zoomfull,Mt.scale=a,mt.each(Ct.base.dom.pageDivs,function(e,t){t.width(n),t.height(n)})}}function pt(){}function ft(){}function ht(e){_t.__updatePageSize(e)}var mt=Atalasoft.$,bt=null,vt=e.viewer||null,zt=-1,wt=null,_t=null,xt=null,yt=Atalasoft.Utils.Fitting,Dt=Atalasoft.Utils.ScrollDirection,Ft={size:{width:0,height:0},sizes:[{width:0,height:0}],count:0,number:-1,dpi:96,vector:!1},Ct={base:null,loading:!1,initialized:!1,scrolling:!1,drag:{dragging:!1,start:-1,end:-1}},qt={moves:0},Mt={divsize:-1,scale:1,size:-1,zoom:1,zoomfull:1},Pt={direction:Dt.Vertical,maxwidth:300,minwidth:80,pageborderwidth:1,pagespacing:2,parent:null,showpagenumber:!1,showthumbcaption:!1,toolbarparent:null,allowdragdrop:!1,dragdelay:250,selectedindex:0,thumbpadding:8,backcolor:"#DCDCDC",hovercolor:"#667F9F",selectedcolor:"#E0872D",selectedhovercolor:"#FFC060"},kt={type:"Atalasoft.Controls.WebDocumentThumbnailer",debug:!0,showpageborder:!0,forcepagefit:!0,toolbarparent:mt("<div/>")};return e&&("thumbsize"in e&&isFinite(e.thumbsize)&&e.thumbsize>=30&&(A(e.thumbsize),kt.forcepagesize={width:e.thumbsize,height:e.thumbsize}),mt.extend(Pt,e),mt.extend(Pt,kt),Pt.showpagenumber=Pt.showpagenumber&&!Pt.showthumbcaption,"fitting"in e||(Pt.fitting=Pt.direction===Dt.Vertical?yt.Width:yt.Height),vt&&vt.config&&(Pt.allowtext=vt.config.allowtext)),bt=Atalasoft.Controls.WebDocumentViewer.call(this,Pt,et),xt=bt.__getViewerLink(bt),n(),V(),bt.getSelectedPageIndex=p,bt.selectThumb=z,t(),bt};
/*!
 * clipboard.js v1.5.10
 * https://zenorocha.github.io/clipboard.js
 *
 * Licensed MIT © Zeno Rocha
 */
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.Clipboard=t()}}(function(){var t,e,n;return function t(e,n,o){function i(c,a){if(!n[c]){if(!e[c]){var s="function"==typeof require&&require;if(!a&&s)return s(c,!0);if(r)return r(c,!0);var l=new Error("Cannot find module '"+c+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[c]={exports:{}};e[c][0].call(u.exports,function(t){var n=e[c][1][t];return i(n?n:t)},u,u.exports,t,e,n,o)}return n[c].exports}for(var r="function"==typeof require&&require,c=0;c<o.length;c++)i(o[c]);return i}({1:[function(t,e,n){var o=t("matches-selector");e.exports=function(t,e,n){for(var i=n?t:t.parentNode;i&&i!==document;){if(o(i,e))return i;i=i.parentNode}}},{"matches-selector":5}],2:[function(t,e,n){function o(t,e,n,o,r){var c=i.apply(this,arguments);return t.addEventListener(n,c,r),{destroy:function(){t.removeEventListener(n,c,r)}}}function i(t,e,n,o){return function(n){n.delegateTarget=r(n.target,e,!0),n.delegateTarget&&o.call(t,n)}}var r=t("closest");e.exports=o},{closest:1}],3:[function(t,e,n){n.node=function(t){return void 0!==t&&t instanceof HTMLElement&&1===t.nodeType},n.nodeList=function(t){var e=Object.prototype.toString.call(t);return void 0!==t&&("[object NodeList]"===e||"[object HTMLCollection]"===e)&&"length"in t&&(0===t.length||n.node(t[0]))},n.string=function(t){return"string"==typeof t||t instanceof String},n.fn=function(t){var e=Object.prototype.toString.call(t);return"[object Function]"===e}},{}],4:[function(t,e,n){function o(t,e,n){if(!t&&!e&&!n)throw new Error("Missing required arguments");if(!a.string(e))throw new TypeError("Second argument must be a String");if(!a.fn(n))throw new TypeError("Third argument must be a Function");if(a.node(t))return i(t,e,n);if(a.nodeList(t))return r(t,e,n);if(a.string(t))return c(t,e,n);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}function i(t,e,n){return t.addEventListener(e,n),{destroy:function(){t.removeEventListener(e,n)}}}function r(t,e,n){return Array.prototype.forEach.call(t,function(t){t.addEventListener(e,n)}),{destroy:function(){Array.prototype.forEach.call(t,function(t){t.removeEventListener(e,n)})}}}function c(t,e,n){return s(document.body,t,e,n)}var a=t("./is"),s=t("delegate");e.exports=o},{"./is":3,delegate:2}],5:[function(t,e,n){function o(t,e){if(r)return r.call(t,e);for(var n=t.parentNode.querySelectorAll(e),o=0;o<n.length;++o)if(n[o]==t)return!0;return!1}var i=Element.prototype,r=i.matchesSelector||i.webkitMatchesSelector||i.mozMatchesSelector||i.msMatchesSelector||i.oMatchesSelector;e.exports=o},{}],6:[function(t,e,n){function o(t){var e;if("INPUT"===t.nodeName||"TEXTAREA"===t.nodeName)t.focus(),t.setSelectionRange(0,t.value.length),e=t.value;else{t.hasAttribute("contenteditable")&&t.focus();var n=window.getSelection(),o=document.createRange();o.selectNodeContents(t),n.removeAllRanges(),n.addRange(o),e=n.toString()}return e}e.exports=o},{}],7:[function(t,e,n){function o(){}o.prototype={on:function(t,e,n){var o=this.e||(this.e={});return(o[t]||(o[t]=[])).push({fn:e,ctx:n}),this},once:function(t,e,n){function o(){i.off(t,o),e.apply(n,arguments)}var i=this;return o._=e,this.on(t,o,n)},emit:function(t){var e=[].slice.call(arguments,1),n=((this.e||(this.e={}))[t]||[]).slice(),o=0,i=n.length;for(o;i>o;o++)n[o].fn.apply(n[o].ctx,e);return this},off:function(t,e){var n=this.e||(this.e={}),o=n[t],i=[];if(o&&e)for(var r=0,c=o.length;c>r;r++)o[r].fn!==e&&o[r].fn._!==e&&i.push(o[r]);return i.length?n[t]=i:delete n[t],this}},e.exports=o},{}],8:[function(e,n,o){!function(i,r){if("function"==typeof t&&t.amd)t(["module","select"],r);else if("undefined"!=typeof o)r(n,e("select"));else{var c={exports:{}};r(c,i.select),i.clipboardAction=c.exports}}(this,function(t,e){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var i=n(e),r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},c=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),a=function(){function t(e){o(this,t),this.resolveOptions(e),this.initSelection()}return t.prototype.resolveOptions=function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.action=e.action,this.emitter=e.emitter,this.target=e.target,this.text=e.text,this.trigger=e.trigger,this.selectedText=""},t.prototype.initSelection=function t(){this.text?this.selectFake():this.target&&this.selectTarget()},t.prototype.selectFake=function t(){var e=this,n="rtl"==document.documentElement.getAttribute("dir");this.removeFake(),this.fakeHandler=document.body.addEventListener("click",function(){return e.removeFake()}),this.fakeElem=document.createElement("textarea"),this.fakeElem.style.fontSize="12pt",this.fakeElem.style.border="0",this.fakeElem.style.padding="0",this.fakeElem.style.margin="0",this.fakeElem.style.position="fixed",this.fakeElem.style[n?"right":"left"]="-9999px",this.fakeElem.style.top=(window.pageYOffset||document.documentElement.scrollTop)+"px",this.fakeElem.setAttribute("readonly",""),this.fakeElem.value=this.text,document.body.appendChild(this.fakeElem),this.selectedText=(0,i.default)(this.fakeElem),this.copyText()},t.prototype.removeFake=function t(){this.fakeHandler&&(document.body.removeEventListener("click"),this.fakeHandler=null),this.fakeElem&&(document.body.removeChild(this.fakeElem),this.fakeElem=null)},t.prototype.selectTarget=function t(){this.selectedText=(0,i.default)(this.target),this.copyText()},t.prototype.copyText=function t(){var e=void 0;try{e=document.execCommand(this.action)}catch(n){e=!1}this.handleResult(e)},t.prototype.handleResult=function t(e){e?this.emitter.emit("success",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)}):this.emitter.emit("error",{action:this.action,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})},t.prototype.clearSelection=function t(){this.target&&this.target.blur(),window.getSelection().removeAllRanges()},t.prototype.destroy=function t(){this.removeFake()},c(t,[{key:"action",set:function t(){var e=arguments.length<=0||void 0===arguments[0]?"copy":arguments[0];if(this._action=e,"copy"!==this._action&&"cut"!==this._action)throw new Error('Invalid "action" value, use either "copy" or "cut"')},get:function t(){return this._action}},{key:"target",set:function t(e){if(void 0!==e){if(!e||"object"!==("undefined"==typeof e?"undefined":r(e))||1!==e.nodeType)throw new Error('Invalid "target" value, use a valid Element');if("copy"===this.action&&e.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if("cut"===this.action&&(e.hasAttribute("readonly")||e.hasAttribute("disabled")))throw new Error('Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes');this._target=e}},get:function t(){return this._target}}]),t}();t.exports=a})},{select:6}],9:[function(e,n,o){!function(i,r){if("function"==typeof t&&t.amd)t(["module","./clipboard-action","tiny-emitter","good-listener"],r);else if("undefined"!=typeof o)r(n,e("./clipboard-action"),e("tiny-emitter"),e("good-listener"));else{var c={exports:{}};r(c,i.clipboardAction,i.tinyEmitter,i.goodListener),i.clipboard=c.exports}}(this,function(t,e,n,o){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t,e){var n="data-clipboard-"+t;if(e.hasAttribute(n))return e.getAttribute(n)}var l=i(e),u=i(n),f=i(o),d=function(t){function e(n,o){r(this,e);var i=c(this,t.call(this));return i.resolveOptions(o),i.listenClick(n),i}return a(e,t),e.prototype.resolveOptions=function t(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.action="function"==typeof e.action?e.action:this.defaultAction,this.target="function"==typeof e.target?e.target:this.defaultTarget,this.text="function"==typeof e.text?e.text:this.defaultText},e.prototype.listenClick=function t(e){var n=this;this.listener=(0,f.default)(e,"click",function(t){return n.onClick(t)})},e.prototype.onClick=function t(e){var n=e.delegateTarget||e.currentTarget;this.clipboardAction&&(this.clipboardAction=null),this.clipboardAction=new l.default({action:this.action(n),target:this.target(n),text:this.text(n),trigger:n,emitter:this})},e.prototype.defaultAction=function t(e){return s("action",e)},e.prototype.defaultTarget=function t(e){var n=s("target",e);return n?document.querySelector(n):void 0},e.prototype.defaultText=function t(e){return s("text",e)},e.prototype.destroy=function t(){this.listener.destroy(),this.clipboardAction&&(this.clipboardAction.destroy(),this.clipboardAction=null)},e}(u.default);t.exports=d})},{"./clipboard-action":8,"good-listener":4,"tiny-emitter":7}]},{},[9])(9)});